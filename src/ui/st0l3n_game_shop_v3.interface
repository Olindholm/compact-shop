<?xml version="1.0" encoding="UTF-8"?>
<interface name="st0l3n_game_shop_v3">
	<include file="ui_items.package"/>

	<include file="tooltip_item.package"/>
	<include file="tooltip_item_short.package"/>
	<include file="tooltip_ability_simple.package"/>
	<include file="tooltip_ability_levelup_simple.package"/>
	<include file="tooltip_ability.package"/>
	<include file="tooltip_ability_hero.package"/>
	<include file="tooltip_ability_levelup.package"/>
	<include file="tooltip_ability_info.package"/>
	<include file="tooltip_attack.package"/>
	<include file="tooltip_defense.package"/>
	<include file="tooltip_movement.package"/>
	<include file="tooltip_unit.package"/>
	<include file="tooltip_attribute.package"/>
	<include file="tooltip_attribute2.package"/>
	<include file="tooltip_health.package"/>
	<include file="tooltip_mana.package"/>
	<include file="tooltip_experience.package"/>
	<include file="tooltip_attack_info.package"/>
	<include file="tooltip_defense_info.package"/>
	<include file="tooltip_attribute_info.package"/>
	<include file="tooltip_health_info.package"/>
	<include file="tooltip_mana_info.package"/>
	<include file="tooltip_movement_info.package"/>
	<include file="tooltip_unit_info.package"/>
	<include file="tooltip_experience_info.package"/>
	<include file="tooltip_hero_unit.package"/>
	<include file="tooltip_hero_health.package"/>
	<include file="tooltip_hero_mana.package"/>
	<include file="tooltip_hero_experience.package"/>
	<include file="tooltip_hero.package"/>
	<include file="tooltip_team_colors.package"/>
	<include file="tooltip_team_share.package"/>
	<include file="tooltip_scoreboard.package"/>
	<include file="/ui/fe2/confirmations.package"/>

	<include file="guides_form.package"/>
	
	<trigger name="recipeCompDisplay0"/>
	<trigger name="recipeCompDisplay1"/>
	<trigger name="recipeCompDisplay2"/>
	<trigger name="recipeCompDisplay3"/>
	<trigger name="recipeCompDisplay4"/>
	<trigger name="recipeCompDisplay5"/>
	<trigger name="recipeCompDisplay6"/>
	<trigger name="recipeCompDisplay7"/>
	<trigger name="recipeCompDisplay8"/>
	<trigger name="recipeCompDisplay9"/>
	<trigger name="recipeCompDisplay10"/>
	<trigger name="recipeCompDisplay11"/>
	<trigger name="recipeCompDisplay12"/>
	<trigger name="recipeCompDisplay13"/>
	<trigger name="recipeCompDisplay14"/>
	<trigger name="recipeCompDisplay15"/>
	<trigger name="recipeCompDisplay16"/>
	<trigger name="recipeCompDisplay17"/>
	<trigger name="recipeCompDisplay18"/>
	<trigger name="recipeCompDisplay19"/>
	<trigger name="recipeCompDisplay20"/>
	<trigger name="recipeCompDisplay21"/>
	<trigger name="recipeCompDisplay22"/>
	<trigger name="recipeCompDisplay23"/>
	<trigger name="recipeCompDisplay24"/>
	<trigger name="recipeCompDisplay25"/>
	<trigger name="recipeCompDisplay26"/>
	<trigger name="recipeCompDisplay27"/>
	<trigger name="recipeCompDisplay28"/>
	<trigger name="recipeCompDisplay29"/>
	<trigger name="recipeCompDisplay30"/>
	<trigger name="recipeCompDisplay31"/>
	<trigger name="recipeCompDisplay32"/>
	<trigger name="recipeCompDisplay33"/>
	<trigger name="recipeCompDisplay34"/>
	<trigger name="recipeCompDisplay35"/>
	<trigger name="recipeCompDisplay36"/>
	<trigger name="recipeCompDisplay37"/>
	<trigger name="recipeCompDisplay38"/>
	<trigger name="recipeCompDisplay39"/>
	<trigger name="recipeCompDisplay40"/>
	<trigger name="recipeCompDisplay41"/>
	<trigger name="recipeCompDisplay42"/>
	<trigger name="recipeCompDisplay43"/>
	<trigger name="recipeCompDisplay44"/>
	<trigger name="recipeCompDisplay45"/>
	<trigger name="recipeCompDisplay46"/>
	<trigger name="recipeCompDisplay47"/>
	<trigger name="recipeCompDisplay48"/>
	<trigger name="recipeCompDisplay49"/>
	<trigger name="recipeCompDisplay50"/>
	<trigger name="recipeCompDisplay51"/>
	<trigger name="recipeCompDisplay52"/>
	<trigger name="recipeCompDisplay53"/>
	<trigger name="recipeCompDisplay54"/>
	<trigger name="recipeCompDisplay55"/>
	<trigger name="recipeCompDisplay56"/>
	<trigger name="recipeCompDisplay57"/>
	<trigger name="recipeCompDisplay58"/>
	<trigger name="recipeCompDisplay59"/>
	<trigger name="recipeCompDisplay60"/>
	<trigger name="recipeCompDisplay61"/>
	<trigger name="recipeCompDisplay62"/>
	<trigger name="recipeCompDisplay63"/>
	<trigger name="recipeCompDisplay64"/>
	<trigger name="recipeCompDisplay65"/>
	<trigger name="recipeCompDisplay66"/>
	<trigger name="recipeCompDisplay67"/>
	<trigger name="recipeCompDisplay68"/>
	<trigger name="recipeCompDisplay69"/>
	<trigger name="recipeCompDisplay70"/>
	<trigger name="recipeCompDisplay71"/>
	<trigger name="recipeCompDisplay72"/>
	<trigger name="recipeCompDisplay73"/>
	<trigger name="recipeCompDisplay74"/>
	<trigger name="recipeCompDisplay75"/>
	<trigger name="recipeCompDisplay76"/>
	<trigger name="recipeCompDisplay77"/>
	<trigger name="recipeCompDisplay78"/>
	<trigger name="recipeCompDisplay79"/>
		
	<!-- These are used for the boot view items -->
	<trigger name="recipeCompDisplay272"/>
	<trigger name="recipeCompDisplay273"/>
	<trigger name="recipeCompDisplay274"/>
	<trigger name="recipeCompDisplay275"/>
	<trigger name="recipeCompDisplay276"/>
	<trigger name="recipeCompDisplay277"/>
	<trigger name="recipeCompDisplay278"/>
	<trigger name="recipeCompDisplay279"/>
	
	<trigger name="recipeCompDisplay80"/>
	<trigger name="recipeCompDisplay81"/>
	<trigger name="recipeCompDisplay82"/>
	<trigger name="recipeCompDisplay83"/>
	<trigger name="recipeCompDisplay84"/>
	<trigger name="recipeCompDisplay85"/>
	<trigger name="recipeCompDisplay86"/>
	<trigger name="recipeCompDisplay87"/>
	<trigger name="recipeCompDisplay88"/>
	<trigger name="recipeCompDisplay89"/>
	<trigger name="recipeCompDisplay90"/>
	<trigger name="recipeCompDisplay91"/>
	<trigger name="recipeCompDisplay92"/>
	<trigger name="recipeCompDisplay93"/>
	<trigger name="recipeCompDisplay94"/>
	<trigger name="recipeCompDisplay95"/>
	<trigger name="recipeCompDisplay96"/>
	<trigger name="recipeCompDisplay97"/>
	<trigger name="recipeCompDisplay98"/>
	<trigger name="recipeCompDisplay99"/>
	<trigger name="recipeCompDisplay100"/>
	<trigger name="recipeCompDisplay101"/>
	<trigger name="recipeCompDisplay102"/>
	<trigger name="recipeCompDisplay103"/>
	<trigger name="recipeCompDisplay104"/>
	<trigger name="recipeCompDisplay105"/>
	<trigger name="recipeCompDisplay106"/>
	<trigger name="recipeCompDisplay107"/>
	<trigger name="recipeCompDisplay108"/>
	<trigger name="recipeCompDisplay109"/>
	<trigger name="recipeCompDisplay110"/>
	<trigger name="recipeCompDisplay111"/>
	<trigger name="recipeCompDisplay112"/>
	<trigger name="recipeCompDisplay113"/>
	<trigger name="recipeCompDisplay114"/>
	<trigger name="recipeCompDisplay115"/>
	<trigger name="recipeCompDisplay116"/>
	<trigger name="recipeCompDisplay117"/>
	<trigger name="recipeCompDisplay118"/>
	<trigger name="recipeCompDisplay119"/>
	<trigger name="recipeCompDisplay120"/>
	<trigger name="recipeCompDisplay121"/>
	<trigger name="recipeCompDisplay122"/>
	<trigger name="recipeCompDisplay123"/>
	<trigger name="recipeCompDisplay124"/>
	<trigger name="recipeCompDisplay125"/>
	<trigger name="recipeCompDisplay126"/>
	<trigger name="recipeCompDisplay127"/>
	<trigger name="recipeCompDisplay128"/>
	<trigger name="recipeCompDisplay129"/>
	<trigger name="recipeCompDisplay130"/>
	<trigger name="recipeCompDisplay131"/>
	<trigger name="recipeCompDisplay132"/>
	<trigger name="recipeCompDisplay133"/>
	<trigger name="recipeCompDisplay134"/>
	<trigger name="recipeCompDisplay135"/>
	<trigger name="recipeCompDisplay136"/>
	<trigger name="recipeCompDisplay137"/>
	<trigger name="recipeCompDisplay138"/>
	<trigger name="recipeCompDisplay139"/>
	
	<trigger name="updateShopItem0"/>
	<trigger name="updateShopItem1"/>
	<trigger name="updateShopItem2"/>
	<trigger name="updateShopItem3"/>
	<trigger name="updateShopItem4"/>
	<trigger name="updateShopItem5"/>
	<trigger name="updateShopItem6"/>
	<trigger name="updateShopItem7"/>
	<trigger name="updateShopItem8"/>
	<trigger name="updateShopItem9"/>
	<trigger name="updateShopItem10"/>
	<trigger name="updateShopItem11"/>
	<trigger name="updateShopItem12"/>
	<trigger name="updateShopItem13"/>
	<trigger name="updateShopItem14"/>
	<trigger name="updateShopItem15"/>
	<trigger name="updateShopItem16"/>
	<trigger name="updateShopItem17"/>
	<trigger name="updateShopItem18"/>
	<trigger name="updateShopItem19"/>
	<trigger name="updateShopItem20"/>
	<trigger name="updateShopItem21"/>
	<trigger name="updateShopItem22"/>
	<trigger name="updateShopItem23"/>
	<trigger name="updateShopItem24"/>
	<trigger name="updateShopItem25"/>
	<trigger name="updateShopItem26"/>
	<trigger name="updateShopItem27"/>
	<trigger name="updateShopItem28"/>
	<trigger name="updateShopItem29"/>
	<trigger name="updateShopItem30"/>
	<trigger name="updateShopItem31"/>
	<trigger name="updateShopItem32"/>
	<trigger name="updateShopItem33"/>
	<trigger name="updateShopItem34"/>
	<trigger name="updateShopItem35"/>
	<trigger name="updateShopItem36"/>
	<trigger name="updateShopItem37"/>
	<trigger name="updateShopItem38"/>
	<trigger name="updateShopItem39"/>
	<trigger name="updateShopItem40"/>
	<trigger name="updateShopItem41"/>
	<trigger name="updateShopItem42"/>
	<trigger name="updateShopItem43"/>
	<trigger name="updateShopItem44"/>
	<trigger name="updateShopItem45"/>
	<trigger name="updateShopItem46"/>
	<trigger name="updateShopItem47"/>
	<trigger name="updateShopItem48"/>
	<trigger name="updateShopItem49"/>
	<trigger name="updateShopItem50"/>
	<trigger name="updateShopItem51"/>
	<trigger name="updateShopItem52"/>
	<trigger name="updateShopItem53"/>
	<trigger name="updateShopItem54"/>
	<trigger name="updateShopItem55"/>
	<trigger name="updateShopItem56"/>
	<trigger name="updateShopItem57"/>
	<trigger name="updateShopItem58"/>
	<trigger name="updateShopItem59"/>
	
	<trigger name="updateShopItemSimple0"/>
	<trigger name="updateShopItemSimple1"/>
	<trigger name="updateShopItemSimple2"/>
	<trigger name="updateShopItemSimple3"/>
	<trigger name="updateShopItemSimple4"/>
	<trigger name="updateShopItemSimple5"/>
	<trigger name="updateShopItemSimple6"/>
	<trigger name="updateShopItemSimple7"/>
	<trigger name="updateShopItemSimple8"/>
	<trigger name="updateShopItemSimple9"/>
	<trigger name="updateShopItemSimple10"/>
	<trigger name="updateShopItemSimple11"/>
	<trigger name="updateShopItemSimple12"/>
	<trigger name="updateShopItemSimple13"/>
	<trigger name="updateShopItemSimple14"/>
	<trigger name="updateShopItemSimple15"/>
	<trigger name="updateShopItemSimple16"/>
	<trigger name="updateShopItemSimple17"/>
	<trigger name="updateShopItemSimple18"/>
	<trigger name="updateShopItemSimple19"/>
	<trigger name="updateShopItemSimple20"/>
	<trigger name="updateShopItemSimple21"/>
	<trigger name="updateShopItemSimple22"/>
	<trigger name="updateShopItemSimple23"/>
	<trigger name="updateShopItemSimple24"/>
	<trigger name="updateShopItemSimple25"/>
	<trigger name="updateShopItemSimple26"/>
	<trigger name="updateShopItemSimple27"/>
	<trigger name="updateShopItemSimple28"/>
	<trigger name="updateShopItemSimple29"/>
	<trigger name="updateShopItemSimple30"/>
	<trigger name="updateShopItemSimple31"/>
	<trigger name="updateShopItemSimple32"/>
	<trigger name="updateShopItemSimple33"/>
	<trigger name="updateShopItemSimple34"/>
	<trigger name="updateShopItemSimple35"/>
	<trigger name="updateShopItemSimple36"/>
	<trigger name="updateShopItemSimple37"/>
	<trigger name="updateShopItemSimple38"/>
	<trigger name="updateShopItemSimple39"/>
	<trigger name="updateShopItemSimple40"/>
	<trigger name="updateShopItemSimple41"/>
	<trigger name="updateShopItemSimple42"/>
	<trigger name="updateShopItemSimple43"/>
	<trigger name="updateShopItemSimple44"/>
	<trigger name="updateShopItemSimple45"/>
	<trigger name="updateShopItemSimple46"/>
	<trigger name="updateShopItemSimple47"/>
	<trigger name="updateShopItemSimple48"/>
	<trigger name="updateShopItemSimple49"/>
	<trigger name="updateShopItemSimple50"/>
	<trigger name="updateShopItemSimple51"/>
	<trigger name="updateShopItemSimple52"/>
	<trigger name="updateShopItemSimple53"/>
	<trigger name="updateShopItemSimple54"/>
	<trigger name="updateShopItemSimple55"/>
	<trigger name="updateShopItemSimple56"/>
	<trigger name="updateShopItemSimple57"/>
	<trigger name="updateShopItemSimple58"/>
	<trigger name="updateShopItemSimple59"/>
	
	<trigger name="updateShopItemAlpha0"/>
	<trigger name="updateShopItemAlpha1"/>
	<trigger name="updateShopItemAlpha2"/>
	<trigger name="updateShopItemAlpha3"/>
	<trigger name="updateShopItemAlpha4"/>
	<trigger name="updateShopItemAlpha5"/>
	<trigger name="updateShopItemAlpha6"/>
	<trigger name="updateShopItemAlpha7"/>
	<trigger name="updateShopItemAlpha8"/>
	<trigger name="updateShopItemAlpha9"/>
	<trigger name="updateShopItemAlpha10"/>
	<trigger name="updateShopItemAlpha11"/>
	<trigger name="updateShopItemAlpha12"/>
	<trigger name="updateShopItemAlpha13"/>
	<trigger name="updateShopItemAlpha14"/>
	<trigger name="updateShopItemAlpha15"/>
	<trigger name="updateShopItemAlpha16"/>
	<trigger name="updateShopItemAlpha17"/>
	<trigger name="updateShopItemAlpha18"/>
	<trigger name="updateShopItemAlpha19"/>
	<trigger name="updateShopItemAlpha20"/>
	<trigger name="updateShopItemAlpha21"/>
	<trigger name="updateShopItemAlpha22"/>
	<trigger name="updateShopItemAlpha23"/>
	<trigger name="updateShopItemAlpha24"/>
	<trigger name="updateShopItemAlpha25"/>
	<trigger name="updateShopItemAlpha26"/>
	<trigger name="updateShopItemAlpha27"/>
	<trigger name="updateShopItemAlpha28"/>
	<trigger name="updateShopItemAlpha29"/>
	<trigger name="updateShopItemAlpha30"/>
	<trigger name="updateShopItemAlpha31"/>
	<trigger name="updateShopItemAlpha32"/>
	<trigger name="updateShopItemAlpha33"/>
	<trigger name="updateShopItemAlpha34"/>
	<trigger name="updateShopItemAlpha35"/>
	<trigger name="updateShopItemAlpha36"/>
	<trigger name="updateShopItemAlpha37"/>
	<trigger name="updateShopItemAlpha38"/>
	<trigger name="updateShopItemAlpha39"/>
	<trigger name="updateShopItemAlpha40"/>
	<trigger name="updateShopItemAlpha41"/>
	<trigger name="updateShopItemAlpha42"/>
	<trigger name="updateShopItemAlpha43"/>
	<trigger name="updateShopItemAlpha44"/>
	<trigger name="updateShopItemAlpha45"/>
	<trigger name="updateShopItemAlpha46"/>
	<trigger name="updateShopItemAlpha47"/>
	<trigger name="updateShopItemAlpha48"/>
	<trigger name="updateShopItemAlpha49"/>
	<trigger name="updateShopItemAlpha50"/>
	<trigger name="updateShopItemAlpha51"/>
	<trigger name="updateShopItemAlpha52"/>
	<trigger name="updateShopItemAlpha53"/>
	<trigger name="updateShopItemAlpha54"/>
	<trigger name="updateShopItemAlpha55"/>
	<trigger name="updateShopItemAlpha56"/>
	<trigger name="updateShopItemAlpha57"/>
	<trigger name="updateShopItemAlpha58"/>
	<trigger name="updateShopItemAlpha59"/>
	
	<trigger name="updateShopItemAlphaSimple0"/>
	<trigger name="updateShopItemAlphaSimple1"/>
	<trigger name="updateShopItemAlphaSimple2"/>
	<trigger name="updateShopItemAlphaSimple3"/>
	<trigger name="updateShopItemAlphaSimple4"/>
	<trigger name="updateShopItemAlphaSimple5"/>
	<trigger name="updateShopItemAlphaSimple6"/>
	<trigger name="updateShopItemAlphaSimple7"/>
	<trigger name="updateShopItemAlphaSimple8"/>
	<trigger name="updateShopItemAlphaSimple9"/>
	<trigger name="updateShopItemAlphaSimple10"/>
	<trigger name="updateShopItemAlphaSimple11"/>
	<trigger name="updateShopItemAlphaSimple12"/>
	<trigger name="updateShopItemAlphaSimple13"/>
	<trigger name="updateShopItemAlphaSimple14"/>
	<trigger name="updateShopItemAlphaSimple15"/>
	<trigger name="updateShopItemAlphaSimple16"/>
	<trigger name="updateShopItemAlphaSimple17"/>
	<trigger name="updateShopItemAlphaSimple18"/>
	<trigger name="updateShopItemAlphaSimple19"/>
	<trigger name="updateShopItemAlphaSimple20"/>
	<trigger name="updateShopItemAlphaSimple21"/>
	<trigger name="updateShopItemAlphaSimple22"/>
	<trigger name="updateShopItemAlphaSimple23"/>
	<trigger name="updateShopItemAlphaSimple24"/>
	<trigger name="updateShopItemAlphaSimple25"/>
	<trigger name="updateShopItemAlphaSimple26"/>
	<trigger name="updateShopItemAlphaSimple27"/>
	<trigger name="updateShopItemAlphaSimple28"/>
	<trigger name="updateShopItemAlphaSimple29"/>
	<trigger name="updateShopItemAlphaSimple30"/>
	<trigger name="updateShopItemAlphaSimple31"/>
	<trigger name="updateShopItemAlphaSimple32"/>
	<trigger name="updateShopItemAlphaSimple33"/>
	<trigger name="updateShopItemAlphaSimple34"/>
	<trigger name="updateShopItemAlphaSimple35"/>
	<trigger name="updateShopItemAlphaSimple36"/>
	<trigger name="updateShopItemAlphaSimple37"/>
	<trigger name="updateShopItemAlphaSimple38"/>
	<trigger name="updateShopItemAlphaSimple39"/>
	<trigger name="updateShopItemAlphaSimple40"/>
	<trigger name="updateShopItemAlphaSimple41"/>
	<trigger name="updateShopItemAlphaSimple42"/>
	<trigger name="updateShopItemAlphaSimple43"/>
	<trigger name="updateShopItemAlphaSimple44"/>
	<trigger name="updateShopItemAlphaSimple45"/>
	<trigger name="updateShopItemAlphaSimple46"/>
	<trigger name="updateShopItemAlphaSimple47"/>
	<trigger name="updateShopItemAlphaSimple48"/>
	<trigger name="updateShopItemAlphaSimple49"/>
	<trigger name="updateShopItemAlphaSimple50"/>
	<trigger name="updateShopItemAlphaSimple51"/>
	<trigger name="updateShopItemAlphaSimple52"/>
	<trigger name="updateShopItemAlphaSimple53"/>
	<trigger name="updateShopItemAlphaSimple54"/>
	<trigger name="updateShopItemAlphaSimple55"/>
	<trigger name="updateShopItemAlphaSimple56"/>
	<trigger name="updateShopItemAlphaSimple57"/>
	<trigger name="updateShopItemAlphaSimple58"/>
	<trigger name="updateShopItemAlphaSimple59"/>
	
	<trigger name="shopComponentAnimStep0"/>
	<trigger name="shopComponentAnimStep1"/>

	<trigger name="SetShopDisplay"/>
	<trigger name="componentReadTree"/>
	<trigger name="componentApplyTreeAnim"/>
	<trigger name="componentSlotVis"/>
	<trigger name="updateRecipeDisplay"/>
	<trigger name="componentPreMatchFound"/>
	<trigger name="recipeFindMatch"/>
	<trigger name="InstantiateRecipeIconTrans"/>
	<trigger name="recipeCheckComponentMatch"/>
	<trigger name="setRecipeViewStyle"/>
	<trigger name="setExtendedRecipeTreeTexture"/>
	<trigger name="shopGlobalItemTooltipUpdate"/>
	<trigger name="shopGlobalItemTooltipIcon"/>
	<trigger name="shopBuyRemainingInfo"/>
	<trigger name="cleanRecommendedItemString"/>
	<trigger name="buildGuideErrorString"/>
	<trigger name="storeAlphaUpdate"/>	
	
	<trigger name="instantiateRecipeTransition"/>
	<!--
		 The actual transition object needs both source and destination information:
			0 - Source Index
			1 - Source X
			2 - Source Y
			3 - Source Width
			4 - Source Height
			5 - Destination Index
			6 - Destination X
			7 - Destination Y			// This has to calculate its Y position based on its container and eventual (post-slide) position
			8 - Destination Width
			9 - Destination Height
	-->
	
	<childinterface file="game_shop_shared.interface" />
<!--	<include file="stolen_autobuy.package" /> -->

	
 <instance name="menu_items_autobuyslot" />
	

	
	<!-- Quick Item Holder -->
	<template name="quickitem_holder">
		<panel
			grow="true"
			width="100%"
			noclick="true"
		>
			<panel x="-0.5h" grow="true" width="19.0h" align="right" noclick="true">
				<panel width="-0.6h" height="-0.6h" align="center" valign="center" color="#181b19" noclick="true"
					watch="storeAlphaUpdate"
					ontrigger="
						SetColor('0.093 0.105 0.097 ' # (0.35 + (param * 0.0065)));
					"
				/>
				<panel y="0.7h" grow="true" width="-1.4h" align="center" float="bottom" padding="0.2h">
					<instance name="{menu_items}"/>
					<panel width="100%" height="0.5h" noclick="true" />
				</panel>
				<frame texture="/ui/common/new_shop_interface/cat_holder2.tga" borderthickness="1.8h" color="#52646e" blockinput="false" noclick="true"
					watch="storeAlphaUpdate"
					ontrigger="
						SetColor('0.32 0.39 0.43 ' # (param / 100));
						SetBorderColor('0.32 0.39 0.43 ' # (param / 100));
					"
				/>
			</panel>
		</panel>
	</template>

	<template name="shopdescription_tooltip">
		<floater
			name="{tip_id}"
			x="2.2h" y="2.2h"
			width="25.0h"
			valign="top"
			color="invisible"
			visible="{visible=0}"
			passivechildren="true"
			grow="true"
		>
			<frame texture="/ui/frames/tooltip_bg.tga" color="0 0 0 .8" borderthickness=".6h" />
			<frame texture="/ui/frames/roundframe.tga" color="#A0A0A0" borderthickness=".6h" />

				<panel y="0.7h" width="-1.6h" align="center" color="invisible" noclick="true" grow="true">
					<label
						textvalign="top"
						textalign="left"
						align="center"
						font="dyn_10"
						noclick="1"
						color="white"
						shadow="1"
						wrap="1"
						fity="true"
						fitxpadding="0"
						fitypadding="0.8h"

					>{label}</label>
				</panel>
		</floater>
	</template>

	<template name="shop_cats_button">
		<panel height="6.5h" color="invisible" noclick="1">
			<panel width="5.4h" height="5.4h" align="center">
				<image texture="/items/shops/{iconfile}.tga" />
				<button 
					texture="/ui/elements/button_bevel_sml.tga"
					onmouseover="PlaySound('/shared/sounds/ui/button_over_03.wav'); showWidget('shop_cat_tip{slot}');"
					onmouseout="hideWidget('shop_cat_tip{slot}');"
					onclick="PlaySound('/shared/sounds/ui/button_click_03.wav'); SetActiveShop('{shopname}');"
					interactive="false"
					name="shop_category_button_{slot}"
				/>
				<label x="0.5h" y="0.2h" width="100%" height="100%" textalign="left" textvalign="top" color="white" shadow="true" font="dyn_12" noclick="true" watch="ShopKey{slot}" ontrigger="SetText(Translate(param));" content="{slot}" />
				<frame
					borderthickness="3"
					bordercolor="yellow"
					color="invisible"
					visible="true"
					watch="ShopType"
					interactive="false"
					ontrigger="SetVisible(StringEquals(param, '{shopname}'));"
					noclick="true"
					passivechildren="true"
				>
					<image x="3" y="3" width="-6" height="-6" color="yellow" texture="/ui/fps/selected.tga" rendermode="additive"/>
				</frame>
			</panel>
		</panel>
	</template>

	<template name="shop_item_button">
		<panel width="20%" color="invisible" noclick="1" watch="ShopItem{index}" ontrigger="SetVisible(param0); ">
			<panel width="5.4h" height="5.4h" align="center" valign="top" noclick="1">
				<image
					watch="ShopItem{index}"
					ontrigger="SetTexture(param3); If(param6 and !(param8 and param17 and !param18) and param25, SetRenderMode('normal'), SetRenderMode('grayscale'));"
				/>

				<!-- Recipe Scroll -->
				<panel color="black" watch="ShopItem{index}" ontrigger="SetVisible(param8 and !param17 and !param18);" noclick="1">
					<image
						width="55%" height="55%"
						align="center" valign="center"
						watch="ShopItem{index}"
						ontrigger="SetTexture(param3);
							If(param6, SetRenderMode('normal'), SetRenderMode('grayscale'));
							If(param8 and param12, SetRenderMode('normal'));"
					/>
					<image
						texture="/ui/elements/shop/scroll_overlay.tga"
						watch="ShopItem{index}"
						ontrigger="If(param6, SetRenderMode('normal'), SetRenderMode('grayscale'));
							If(param8 and param12, SetRenderMode('normal'));"
					/>
				</panel>

				<image
					width="50%" height="50%"
					align="right" valign="top"
					texture="/ui/elements/shop/new.tga"
					watch="ShopItem{index}"
					ontrigger="SetVisible(param23);"
					noclick="true"
				/>

				<image
					width="50%" height="50%" x="0.5h" y="-0.5h"
					align="left" valign="bottom"
					texture="/ui/elements/shop/good.tga"
					watch="ShopItem{index}"
					ontrigger="SetVisible(param24);"
					noclick="true"
				/>

				<button
					texture="/ui/elements/button_bevel_sml.tga"
					onmouseout="HideWidget('shop_item_tooltip{index}'); HideWidget('shop_item_tooltip_short{index}');"
					onclick="PlaySound('/shared/sounds/ui/button_click_02.wav'); Purchase('{index}');"
					watch="ShopItem{index}"
					onmouseover="PlaySound('/shared/sounds/ui/button_over_03.wav');
							ShowWidget('shop_item_tooltip{index}'); ShowWidget('shop_item_tooltip_short{index}');"
					interactive="false"
					name="shop_item_{index}"
				/>
				<image
					texture="$white"
					rendermode="overlay"
					watch="ShopItem{index}"
					ontrigger="SetVisible(true);
						If(!(param6 and !(param8 and param17 and !param18)) or !param25,
							SetColor('#404040'),
							SetVisible(false)
						);"
					noclick="true"
				/>

				<!-- Cooldown -->
				<piegraph start="270" end="-90" square="true" color="#000000cc" watch="ShopItem{index}" ontrigger="SetVisible(param21 gt 0); SetValue(param20);" noclick="true"/>

				<!-- HotKey used to select this item -->
				<label x="0.5h" y="0.2h" width="100%" height="100%" textalign="left" textvalign="top" color="white" shadow="true" font="dyn_12" noclick="true" watch="ShopItem{index}" ontrigger="SetText(Translate(param13));" content="{index}" />

				<label x="-0.5h" y="0.2h" width="100%" height="100%" textalign="right" textvalign="top" color="white" shadow="true" font="dyn_12" noclick="true" watch="ShopItem{index}" ontrigger="SetText(param19);"/>

				<frame
					borderthickness="4"
					bordercolor="yellow"
					color="invisible"
					visible="true"
					watch="RecipeItemType ShopItemType{index}"
					ontrigger="SetVisible(StringEquals(RecipeItemType, ShopItemType{index}));"
					noclick="true"
					passivechildren="true"
				>
					<image x="3" y="3" width="-6" height="-6" color="yellow" texture="/ui/fps/selected.tga" rendermode="additive"/>
				</frame>

				<image
					texture="/ui/common/new_shop_interface/stash.tga"
					x="10%"
					y="10%"
					height="40%"
					width="40%"
					align="right"
					valign="bottom"
					watch="ShopItem{index}"
					ontrigger="SetVisible(param15 and !param16 and !param17 and !param18);"
					noclick="true"
				/>

				<image
					texture="/ui/common/new_shop_interface/magnify.tga"
					x="10%"
					y="10%"
					height="40%"
					width="40%"
					align="right"
					valign="bottom"
					watch="ShopItem{index}"
					ontrigger="SetVisible(!param16 and param18);"
					noclick="true"
				/>

				<!-- Cooldown timer -->
				<label noclick="1" valign="center" align="center" textvalign="center" textalign="center" color="#87CEEB" shadow="1" font="dyn_12" watch="ShopItem{index}" ontrigger="SetVisible(param21 gt 0); SetText(FtoT(param21, 1, 0, '-'));" />
			</panel>
			<!-- Cost -->
			<label y="5.2h" height="1.0h" align="center" valign="top" textalign="center" textvalign="top" color="white" shadow="1" noclick="1" font="dyn_9" watch="{watch}{index}" ontrigger="SetText(param4);" />
		</panel>
	</template>

	<template name="shop_item_component">
		<panel width="{width=25%}" color="invisible" noclick="1" watch="{watch}{index}" ontrigger="SetVisible(param0);">
			<panel width="5.4h" height="5.4h" align="center" valign="top" noclick="1">
				<image
					watch="{watch}{index}"
					ontrigger="SetTexture(param3);
						If(param6 and !(param8 and param17 and !param18), SetRenderMode('normal'), SetRenderMode('grayscale'));"
				/>

				<!-- Recipe Scroll -->
				<panel color="black" watch="{watch}{index}" ontrigger="SetVisible(param8 and !param17 and !param18 and !(param12 and param18));" noclick="1">
					<image
						width="55%" height="55%"
						align="center" valign="center"
						watch="{watch}{index}"
						ontrigger="SetTexture(param3);
							If(param6, SetRenderMode('normal'), SetRenderMode('grayscale'));
							If(param8 and param12, SetRenderMode('normal'));"
					/>
					<image texture="/ui/elements/shop/scroll_overlay.tga"/>
				</panel>

				<button
					texture="/ui/elements/button_bevel_sml.tga"
					onmouseover="PlaySound('/shared/sounds/ui/button_over_03.wav'); Trigger('shopGlobalItemTooltipIcon', _storeRecipeCurTexture); ShowWidget('{tooltip}{index}'); ShowWidget('{tooltip}_short{index}');"
					onmouseout="HideWidget('{tooltip}{index}'); HideWidget('{tooltip}_short{index}');"
					onclick="PlaySound('/shared/sounds/ui/button_click_02.wav');
						{cmd}('{index}');"
					interactive="false"
					name="shop_component_{usedin}{index}"
				/><!-- The 'usedin' bit is just so that it has a unique name for things such as highlighting this exact icon in the tutorial - Merc -->
				<image
					texture="$white"
					rendermode="overlay"
					watch="{watch}{index}"
					ontrigger="SetVisible(true);
						If(!(param6 and !(param8 and param17 and !param18)),
							SetColor('#404040'),
							SetVisible(false)
						);"
					noclick="true"
				/>

				<!-- Cooldown -->
				<piegraph start="270" end="-90" square="true" color="#000000cc" watch="{watch}{index}" ontrigger="SetVisible(param21 gt 0); SetValue(param20);" noclick="true"/>

				<!-- Stock -->
				<label x="-0.5h" y="0.2h" width="100%" height="100%" textalign="right" textvalign="top" color="white" shadow="true" font="dyn_12" noclick="true" watch="{watch}{index}" ontrigger="SetText(param19);"/>

				<!-- Owned Item Indicator -->
				<frame
					borderthickness="0.2h"
					color="invisible"
					watch="{watch}{index}"
					ontrigger="
					If(
						param11 or param26,
						If(
							param11,
							SetBorderColor('#16e124'),
							SetBorderColor('#ddbb24')
						),
						SetBorderColor('invisible'));
					"
					noclick="1"
				/>

				<image
					texture="/ui/common/new_shop_interface/stash.tga"
					x="10%"
					y="10%"
					height="40%"
					width="40%"
					align="right"
					valign="bottom"
					watch="{watch}{index}"
					ontrigger="SetVisible(param15 and !param17 and !param18);"
					noclick="true"
				/>
				<image
					texture="/ui/common/new_shop_interface/magnify.tga"
					x="10%"
					y="10%"
					height="40%"
					width="40%"
					align="right"
					valign="bottom"
					watch="{watch}{index}"
					ontrigger="SetVisible(param18);"
					noclick="true"
				/>

				<!-- Hot Key -->
				<label x="0.5h" y="0.2h" width="100%" height="100%" textalign="left" textvalign="top" color="white" shadow="true" font="dyn_11" noclick="true" watch="{watch}{index}" ontrigger="SetText(Translate(param13));" />

				<!-- Cooldown timer -->
				<label noclick="1" valign="center" align="center" textvalign="center" textalign="center" color="#87CEEB" shadow="1" font="dyn_12" watch="{watch}{index}" ontrigger="SetVisible(param21 gt 0); SetText(FtoT(param21, 1, 0, '-'));" />
			</panel>
			<!-- Cost -->
			<label y="5.4h" height="1.0h" align="center" valign="top" textalign="center" textvalign="top" color="white" shadow="1" font="dyn_9" watch="{watch}{index}" ontrigger="SetVisible(param8 and !param12); SetText(param4);" />
			<label y="5.4h" height="1.0h" align="center" valign="top" textalign="center" textvalign="top" color="white" shadow="1" font="dyn_9" watch="{watch}{index}" ontrigger="SetVisible(param12); SetText(param5);" />
		</panel>
	</template>



	<template name="shop">
		<panel
			name="item_shop"
			x="9.5h"
			y="6h"
			width="16.8h"
			height="42.9h"
			color="invisible"
			visible="0"
			watch="PlayerCanShop"
			ontrigger="PlaySound('/shared/sounds/ui/shop_show.wav'); If(param, SetDefaultActiveShop());"
			onshow=""
			watch0="ShopActive"
			ontrigger0="SetVisible(param and !cg_useNewShop2);"
			hotkey="ESC"
			onhotkey="PlaySound('/shared/sounds/ui/button_close_01.wav'); CloseShop();"
			cangrab="true"
		>

			<!-- Recipe Display -->
			<panel
				name="recipe_display"
				y="-0.1h"
				x="15.2h"
				width="52.0h" height="52.0h"
				color="invisible"
				noclick="true"
				float="bottom"
				watch="RecipeItemType" ontrigger="
					if(!StringEmpty(param), SlideX(48.6h, 250), SlideX(18.0h, 250));
					if(!StringEmpty(param), Call('recipe_gear', 'Rotate(270, 250);'), Call('recipe_gear', 'Rotate(-270, 250);'));

					"
				watch1="ShopType"
				ontrigger1="SetVisible(!StringEquals(param, ''));"
			>

				<!-- Recipe Icon -->
				<panel x="3.8h" y="14.6h" width="5.8h" height="5.8h" noclick="1">
					<image
						watch="RecipeItem"
						ontrigger="SetTexture(param3); If(param6, SetRenderMode('normal'), SetRenderMode('grayscale'));"
						onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav');
							ShowWidget('recipe_item_tooltip'); ShowWidget('recipe_item_tooltip_short');"
						onmouseout="HideWidget('recipe_item_tooltip'); HideWidget('recipe_item_tooltip_short');"
					/>
					<image
						texture="$white"
						rendermode="overlay"
						watch="RecipeItem"
						ontrigger="SetVisible(true);
							If(!param6,
								SetColor('#404040'),
								SetVisible(false)
							);"
						noclick="1"
					/>
				</panel>

				<!-- Buy All Button -->
				<instance
					name="button2"
					x="12.0h" y="19.1h"
					width="14.8h" height="2.5h"
					valign="top" align="left"
					label="game_shop_label_buyremaining"
					onclick="PurchaseRemainingComponents(GetActiveRecipe()));"
					enabled="true"
				/>

				<!-- Buy All Tooltip -->
				<panel x="28.3h" y="19.1h" width="2.4h" height="2.4h" valign="top" align="left" color="invisible" noclick="1">
					<button
						color="invisible"
						onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav'); showwidget('shop_recipe_buyall_tip');"
						onmouseout="hidewidget('shop_recipe_buyall_tip');"
						interactive="false"
					>
						<widgetstate statename="up">
							<image width="100%" height="100%" valign="center" align="center" texture="/ui/elements/tip_mark_up.tga" />
						</widgetstate>
						<widgetstate statename="over">
							<image width="100%" height="100%" valign="center" align="center" texture="/ui/elements/tip_mark_over.tga" />
						</widgetstate>
					</button>
				</panel>

				<!-- Recipe Minimize
				<button
					name="shop_min_btn"
					x="30.2h" y="13.8h"
					width="1.9h" height="1.9h"
					valign="top" align="left"
					color="invisible"
					onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav'); showWidget('shop_min');"
					onmouseout="hideWidget('shop_min');"
					onclick="PlaySound('/shared/sounds/ui/shop_hide.wav'); SetActiveRecipe('');"
				>
					<widgetstate statename="up">
						<image width="100%" height="100%" valign="center" align="center" texture="/ui/common/new_shop_interface/recipe_in_up.tga" />
					</widgetstate>
					<widgetstate statename="over">
						<image width="100%" height="100%" valign="center" align="center" texture="/ui/common/new_shop_interface/recipe_in_over.tga" />
					</widgetstate>
				</button>
				-->

				<button
					name="shop_min_btn"
					x="30.2h" y="13.8h"
					width="1.9h" height="1.9h"
					valign="top" align="left"
					color="invisible"
					onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav'); showWidget('shop_min');"
					onmouseout="hideWidget('shop_min');"
					onclick="PlaySound('/shared/sounds/ui/shop_hide.wav'); SetActiveRecipe('');"
					interactive="false"
				>
					<widgetstate statename="up">
						<image width="100%" height="100%" valign="center" align="center" texture="/ui/common/new_shop_interface/recipe_in_up.tga" />
					</widgetstate>
					<widgetstate statename="over">
						<image width="100%" height="100%" valign="center" align="center" texture="/ui/common/new_shop_interface/recipe_in_over.tga" />
					</widgetstate>
				</button>

				<!-- Shop Close -->
				<button
					name="shop_close_btn"
					x="33.0h" y="26.5h"
					width="3.3h" height="3.3h"
					valign="top" align="left"
					color="invisible"
					onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav');"
					onclick="PlaySound('/shared/sounds/ui/button_close_01.wav'); CloseShop();"
					interactive="false"
				>
					<widgetstate statename="up">
						<image width="100%" height="100%" valign="center" align="center" texture="/ui/common/new_shop_interface/close_shops_up.tga" />
					</widgetstate>
					<widgetstate statename="over">
						<image width="100%" height="100%" valign="center" align="center" texture="/ui/common/new_shop_interface/close_shops_over.tga" />
					</widgetstate>
				</button>

				<!-- Background Image -->
				<image y="13.3h" texture="/ui/common/new_shop_interface/recipe_panel.tga" noclick="1" watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # param / 100);"/>


				<!-- Recipe Text -->
				<panel x="11.2h" y="14.6h" width="18.0h" height="3.8h" valign="top" float="bottom" color="invisible" noclick="1">
					<label fity="true" fitypadding="0.2h" width="100%" textalign="left" textvalign="center" font="dyn_10" color="white" shadow="1" noclick="1" watch="RecipeItem" ontrigger="SetText(param1);" />
					<panel color="invisible" float="right" noclick="1" grow="true">
						<label fity="true" fitx="true" fitxpadding="0.5h" textalign="left" textvalign="center" color="white" shadow="1" noclick="1" font="dyn_10">game_shop_label_total_cost</label>
						<label fity="true" fitx="true" textalign="left" textvalign="center" color="yellow" shadow="1" font="dyn_10" noclick="1" watch="RecipeItem" ontrigger="SetText(param5);" />
					</panel>
				</panel>

				<!-- Recipe Items -->
				<panel x="2.8h" y="22.8h" width="28.7h" height="18.8h" color="invisible" noclick="1">
					<panel width="-1.0h" align="center" valign="top" float="bottom" color="invisible" noclick="1">
						<!-- Requires -->
						<panel height="2.5h" width="100%" color="invisible" noclick="1">
							<label height="100%" width="-1.8h" align="center" font="dyn_12" textalign="left" textvalign="center" color="yellow" shadow="1" sticky="true" stickytoinvis="false" watch="RecipeComponent0" ontrigger="SetVisible(param0);">game_shop_label_requires</label>
						</panel>
						<panel height="7.0h" width="100%" float="right" color="invisible" noclick="1">
							<instance name="shop_item_component" watch="RecipeComponent" index="0" cmd="PurchaseComponent" description="recipe_component_description" tooltip="recipe_component_tooltip" width="25%" />
							<instance name="shop_item_component" watch="RecipeComponent" index="1" cmd="PurchaseComponent" description="recipe_component_description" tooltip="recipe_component_tooltip" width="25%" />
							<instance name="shop_item_component" watch="RecipeComponent" index="2" cmd="PurchaseComponent" description="recipe_component_description" tooltip="recipe_component_tooltip" width="25%" />
							<instance name="shop_item_component" watch="RecipeComponent" index="3" cmd="PurchaseComponent" description="recipe_component_description" tooltip="recipe_component_tooltip" width="25%" />
							<!-- Optional Fifth Recipe Component  Item
							<instance name="shop_item_component" watch="RecipeComponent" index="4" cmd="PurchaseComponent" description="recipe_component_description" tooltip="recipe_component_tooltip" width="25%" />
							-->
						</panel>
						<!-- Used In -->
						<panel height="2.3h" width="100%" color="invisible" noclick="1">
							<label height="100%" width="-1.8h" align="center" font="dyn_12" textalign="left" textvalign="center" color="yellow" shadow="1" sticky="true" stickytoinvis="false" watch="RecipeUsedIn0" ontrigger="SetVisible(param0);">game_shop_label_used_in</label>
						</panel>
						<panel height="33.3%" width="100%" float="right" color="invisible" noclick="1">
							<instance name="shop_item_component" usedin="usedin_" watch="RecipeUsedIn" index="0" cmd="PurchaseUsedIn" description="recipe_usedin_description" tooltip="recipe_usedin_tooltip" width="25%" />
							<instance name="shop_item_component" usedin="usedin_" watch="RecipeUsedIn" index="1" cmd="PurchaseUsedIn" description="recipe_usedin_description" tooltip="recipe_usedin_tooltip" width="25%" />
							<instance name="shop_item_component" usedin="usedin_" watch="RecipeUsedIn" index="2" cmd="PurchaseUsedIn" description="recipe_usedin_description" tooltip="recipe_usedin_tooltip" width="25%" />
							<instance name="shop_item_component" usedin="usedin_" watch="RecipeUsedIn" index="3" cmd="PurchaseUsedIn" description="recipe_usedin_description" tooltip="recipe_usedin_tooltip" width="25%" />
							<!-- Optional Fifth Used In Item
							<instance name="shop_item_component" watch="RecipeUsedIn" index="4" cmd="PurchaseUsedIn" description="recipe_usedin_description" tooltip="recipe_usedin_tooltip"  width="25%"/>
							-->
						</panel>
					</panel>
				</panel>

				<!-- Item catcher -->
				<panel
					x="3.0h" y="23.0h"
					width="28.5h" height="18.5h"
					color="invisible"
					texture="/ui/info/drop.tga"
					watch="ItemCursorVisible PlayerCanShop"
					ontrigger="SetVisible(ItemCursorVisible and PlayerCanShop); RefreshCursor();"
					onmouseover="SetColor('1 1 1 .6');"
					onmouseout="SetColor('invisible');"
					onclick="Sell();"
					onrightclick="Sell();"
				/>

			</panel>

			<!-- Main Store Background -->
			<image
				width="26.0h"
				height="52.0h"
				texture="/ui/common/new_shop_interface/shops_panel.tga"
				noclick="1"
			/>

			<panel
				x="6.1h"
				width="6.5h"
				height="26.0h"
				valign="center"
				align="right"
				color="invisible"
				noclick="1"
			>
				<image texture="/ui/common/new_shop_interface/shops_panel_close.tga" noclick="1"/>

				<button
					name="main_shop_close_btn"
					y="0.2h" x="-0.1h"
					width="3.4h" height="3.4h"
					valign="center" align="left"
					color="invisible"
					onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav');"
					onclick="PlaySound('/shared/sounds/ui/button_close_01.wav'); CloseShop();"
					interactive="false"
				>
					<widgetstate statename="up">
						<image width="100%" height="100%" valign="center" align="center" texture="/ui/common/new_shop_interface/close_shops_up.tga" />
					</widgetstate>
					<widgetstate statename="over">
						<image width="100%" height="100%" valign="center" align="center" texture="/ui/common/new_shop_interface/close_shops_over.tga" />
					</widgetstate>
				</button>

			</panel>

			<!-- Shop Default -->
			<panel
				color="invisible"
				noclick="1"
				float="right"
			>
				<!-- Shop Keeper Images -->
				<panel x="0" y="0" name="shop" width="17.2h" height="43.0h" float="right" color="invisible" noclick="1">

					<!-- Items Col -->
					<panel x="1.5h" width="40%" color="invisible" noclick="1">
						<panel y="2.5h" height="100%" valign="top" align="center" float="bottom" padding=".1h" color="invisible" noclick="1">
							<instance name="shop_cats_button" iconfile="shop_supplies" label="game_shop_label_supplies" shopname="Shop_Supplies" slot="3" />
							<instance name="shop_cats_button" iconfile="shop_accessories" label="game_shop_label_accessories" shopname="Shop_Accessories" slot="0" />
							<instance name="shop_cats_button" iconfile="shop_weapons" label="game_shop_label_weapons" shopname="Shop_Weapons" slot="1" />
							<instance name="shop_cats_button" iconfile="shop_relics" label="game_shop_label_relics" shopname="Shop_Relics" slot="2" />
							<instance name="shop_cats_button" iconfile="shop_secret" label="game_shop_label_secret" shopname="Shop_Secret" slot="4" />
							<instance name="shop_cats_button" iconfile="shop_outpost" label="game_shop_label_recipe_outpost" shopname="Shop_Outpost" slot="10" />
						</panel>
					</panel>
					<!-- Recipes Col -->
					<panel width="40%" color="invisible" noclick="1">
						<panel x="-0.2h" y="2.5h" height="100%" valign="top" align="center" float="bottom" padding=".1h" color="invisible" noclick="1">
							<instance name="shop_cats_button" iconfile="shop_recommended" label="game_shop_label_recommended" shopname="Shop_Recommended" slot="11" />
							<instance name="shop_cats_button" iconfile="shop_recipes1" label="game_shop_label_recipe_one" shopname="Shop_Recipes1" slot="5" />
							<instance name="shop_cats_button" iconfile="shop_recipes2" label="game_shop_label_recipe_two" shopname="Shop_Recipes2" slot="6" />
							<instance name="shop_cats_button" iconfile="shop_recipes3" label="game_shop_label_recipe_three" shopname="Shop_Recipes3" slot="7" />
							<instance name="shop_cats_button" iconfile="shop_recipes4" label="game_shop_label_recipe_four" shopname="Shop_Recipes4" slot="8" />
							<instance name="shop_cats_button" iconfile="shop_recipes5" label="game_shop_label_recipe_five" shopname="Shop_Recipes5" slot="9" />
						</panel>
					</panel>

					<!-- Item catcher -->
					<panel
						x="6%" y="1%"
						width="84%"
						height="96%"
						color="invisible"
						texture="/ui/info/drop.tga"
						watch="ItemCursorVisible PlayerCanShop"
						ontrigger="SetVisible(ItemCursorVisible and PlayerCanShop); RefreshCursor();"
						onmouseover="
							SetColor('1 1 1 ' # (0.3 + (shopAlphaValue * 0.003)));
						"
						onmouseout="
							SetColor('invisible');
						"
						onclick="Sell();"
						onrightclick="Sell();"
					/>
				</panel>

				<!-- Shop Items -->
				<panel
					width="33.0h"
					watch="ShopType"
					ontrigger="SetVisible(!StringEquals(param, ''));"
					noclick="true"
					color="invisible"
				>
					<!-- Item BG -->
					<image
						x="-14.2h"
						width="52.0h"
						height="52.0h"
						texture="/ui/common/new_shop_interface/shop_items_panel.tga"
						noclick="1"
					/>

					<panel group="shop" width="100%" color="invisible" noclick="1">

						<panel width="100%" height="31.0h" valign="bottom" color="invisible" noclick="1">

							<!-- Shop name -->
							<label height="2.5h" font="dyn_12" align="center" textalign="center" textvalign="center" shadow="true" shadowoffset="2" color="white" noclick="1" watch="ShopName" ontrigger="SetText(param);" />

							<panel x="-0.3h" y="2.7h" width="-1.2h" height="27.5h" align="center" valign="top" float="bottom" color="invisible" noclick="1">
								<!-- Row 1 -->
								<panel height="25%" width="100%" float="right" color="invisible" noclick="1">
									<instance name="shop_item_button" watch="ShopItem" index="0" />
									<instance name="shop_item_button" watch="ShopItem" index="1" />
									<instance name="shop_item_button" watch="ShopItem" index="2" />
									<instance name="shop_item_button" watch="ShopItem" index="3" />
									<instance name="shop_item_button" watch="ShopItem" index="4" />
								</panel>
								<!-- Row 2 -->
								<panel height="25%" width="100%" float="right" color="invisible" noclick="1">
									<instance name="shop_item_button" watch="ShopItem" index="5" />
									<instance name="shop_item_button" watch="ShopItem" index="6" />
									<instance name="shop_item_button" watch="ShopItem" index="7" />
									<instance name="shop_item_button" watch="ShopItem" index="8" />
									<instance name="shop_item_button" watch="ShopItem" index="9" />
								</panel>
								<!-- Row 3 -->
								<panel height="25%" width="100%" float="right" color="invisible" noclick="1">
									<instance name="shop_item_button" watch="ShopItem" index="10" />
									<instance name="shop_item_button" watch="ShopItem" index="11" />
									<instance name="shop_item_button" watch="ShopItem" index="12" />
									<instance name="shop_item_button" watch="ShopItem" index="13" />
									<instance name="shop_item_button" watch="ShopItem" index="14" />
								</panel>
								<!-- Row 4 -->
								<panel height="25%" width="100%" float="right" color="invisible" noclick="1">
									<instance name="shop_item_button" watch="ShopItem" index="15" />
									<instance name="shop_item_button" watch="ShopItem" index="16" />
									<instance name="shop_item_button" watch="ShopItem" index="17" />
									<instance name="shop_item_button" watch="ShopItem" index="18" />
									<instance name="shop_item_button" watch="ShopItem" index="19" />
								</panel>
							</panel>

							<!-- Item catcher -->
							<panel
								x="0"
								width="98%"
								height="96%"
								align="center"
								color="invisible"
								texture="/ui/info/drop.tga"
								watch="ItemCursorVisible PlayerCanShop"
								ontrigger="SetVisible(ItemCursorVisible and PlayerCanShop); RefreshCursor();"
								onmouseover="SetColor('1 1 1 .6');"
								onmouseout="SetColor('invisible');"
								onclick="Sell();"
								onrightclick="Sell();"
							/>

							<!-- Shopkeeper Image -->
							<image x="0" y="-21.5h" width="32.0h" height="25.6h" valign="bottom" align="left" texture="" noclick="1" watch="ShopHeader" ontrigger="SetTexture(param);"/>
						</panel>
					</panel>
				</panel>

			</panel>

			<!-- Recipe Gear -->
			<image
				name="recipe_gear"
				x="48.2h" y="42.5h"
				width="3.3h" height="3.3h"
				texture="/ui/common/new_shop_interface/gear.tga"
				watch="ShopType"
				ontrigger="SetVisible(!StringEquals(param, ''));"
			/>

		</panel>

		<!-- Floating Tooltips -->
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip0" title="game_shop_label_accessories" label="Shop_Accessories_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip1" title="game_shop_label_weapons" label="Shop_Weapons_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip2" title="game_shop_label_relics" label="Shop_Relics_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip3" title="game_shop_label_supplies" label="Shop_Supplies_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip4" title="game_shop_label_legendary" label="Shop_Legendary_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip5" title="game_shop_label_recipe_one" label="Shop_Recipes1_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip6" title="game_shop_label_recipe_two" label="Shop_Recipes2_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip7" title="game_shop_label_recipe_three" label="Shop_Recipes3_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip8" title="game_shop_label_recipe_four" label="Shop_Recipes4_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip9" title="game_shop_label_recipe_five" label="Shop_Recipes5_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip10" title="game_shop_label_recipe_outpost" label="Shop_Outpost_description" />				
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip11" title="game_shop_label_recommended" label="Shop_Recommended_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip12" title="game_shop_label_consumables" label="Shop_Filter_Consumables_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip13" title="game_shop_label_mobility" label="Shop_Filter_Mobility_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip14" title="game_shop_label_attack_speed" label="Shop_Filter_AttackSpeed_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip15" title="game_shop_label_damage" label="Shop_Filter_Damage_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip16" title="game_shop_label_armor" label="Shop_Filter_Armor_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip17" title="game_shop_label_regeneration" label="Shop_Filter_Regeneration_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip18" title="game_shop_label_agi" label="Shop_Filter_AGI_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip19" title="game_shop_label_str" label="Shop_Filter_STR_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip20" title="game_shop_label_int" label="Shop_Filter_INT_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip21" title="game_shop_label_booster" label="Shop_Filter_Booster_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip22" title="game_shop_label_activatable" label="Shop_Filter_Activatable_description" />
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip23" title="game_shop_label_modifier" label="Shop_Filter_Modifier_description" />		
		<instance name="shopdescription_tooltip" tip_id="shop_cat_tip24" title="game_shop_label_modifier" label="Shop_Observatory_description" />
		<instance name="simple_tooltip_floater" tip_id="shop_recipe_buyall_tip" label="game_shop_label_total_cost_tip" align="right" x="0" />
		
		<instance name="simple_tooltip_floater" tip_id="shop_guide_btn_tip" label="game_shop_guide_btn_tip" align="left" x="25" width="19.0h" />
		<instance name="simple_tooltip_floater" tip_id="shop_cat_filter" label="game_shop_cat_filter_tip" align="left" x="25" width="19.0h" />
		<instance name="simple_tooltip_nowrap" tip_id="shop_clear_search" label="game_shop_clear_search_tip"  />
		<instance name="simple_tooltip_nowrap" tip_id="shop_close_shop" label="game_shop_close_shop_tip"  />
		<instance name="simple_tooltip_nowrap" tip_id="shop_collapse_tree" label="game_shop_close_tree_tip"  />
		
		<instance name="generic_tooltip_floater" tip_id="shop_guide_reco_1_tip" title="game_guide_reco_1" label="game_guide_reco_1_tip" align="right" x="0" />
		<instance name="generic_tooltip_floater" tip_id="shop_guide_reco_2_tip" title="game_guide_reco_2" label="game_guide_reco_2_tip" align="right" x="0" />
		<instance name="generic_tooltip_floater" tip_id="shop_guide_reco_3_tip" title="game_guide_reco_3" label="game_guide_reco_3_tip" align="right" x="0" />
		<instance name="generic_tooltip_floater" tip_id="shop_guide_reco_4_tip" title="game_guide_reco_4" label="game_guide_reco_4_tip" align="right" x="0" />
		<instance name="simple_tooltip_nowrap" tip_id="guide_report_tip" align="center" valign="bottom" y="10" label="game_guide_report_title"  />
		
		<instance name="generic_tooltip_floater" tip_id="shop_guide_auto_level" title="game_guide_auto_level" label="game_guide_auto_level_tip" align="right" valign="bottom" x="0" y="10" />
		<instance name="simple_tooltip_floater" tip_id="shop_buyremaining_dontaxe" label="game_shop_label_buyremaining_dontaxe_tip" align="center" valign="bottom" y="10" />
		<instance name="generic_tooltip_floater" tip_id="shop_simple_view" title="game_shop_label_shopview" label="Dont get used to it... the checkbox vanishes in the next patch ;)" align="left" valign="top" x="20" y="10" />

		<instance name="generic_tooltip_floater" tip_id="shop_trans_tip" title="game_shop_trans" label="game_shop_trans_tip" align="left" valign="bottom" x="10" y="10" />

		<panel x="-1.0h" y="-26h" align="right"	valign="bottom" width="0" height="0" noclick="true" passivechildren="true">
			<instance name="item_tooltip" id="shop_item_tooltip0" watch="ShopItemTooltip0" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip1" watch="ShopItemTooltip1" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip2" watch="ShopItemTooltip2" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip3" watch="ShopItemTooltip3" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip4" watch="ShopItemTooltip4" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip5" watch="ShopItemTooltip5" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip6" watch="ShopItemTooltip6" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip7" watch="ShopItemTooltip7" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip8" watch="ShopItemTooltip8" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip9" watch="ShopItemTooltip9" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip10" watch="ShopItemTooltip10" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip11" watch="ShopItemTooltip11" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip12" watch="ShopItemTooltip12" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip13" watch="ShopItemTooltip13" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip14" watch="ShopItemTooltip14" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip15" watch="ShopItemTooltip15" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip16" watch="ShopItemTooltip16" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip17" watch="ShopItemTooltip17" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip18" watch="ShopItemTooltip18" help="true" />
			<instance name="item_tooltip" id="shop_item_tooltip19" watch="ShopItemTooltip19" help="true" />

			<instance name="item_tooltip" id="recipe_item_tooltip" watch="RecipeItemTooltip" help="true" />

			<instance name="item_tooltip" id="recipe_component_tooltip0" watch="RecipeComponentTooltip0" help="true" />
			<instance name="item_tooltip" id="recipe_component_tooltip1" watch="RecipeComponentTooltip1" help="true" />
			<instance name="item_tooltip" id="recipe_component_tooltip2" watch="RecipeComponentTooltip2" help="true" />
			<instance name="item_tooltip" id="recipe_component_tooltip3" watch="RecipeComponentTooltip3" help="true" />

			<instance name="item_tooltip" id="recipe_usedin_tooltip0" watch="RecipeUsedInTooltip0" help="true" />
			<instance name="item_tooltip" id="recipe_usedin_tooltip1" watch="RecipeUsedInTooltip1" help="true" />
			<instance name="item_tooltip" id="recipe_usedin_tooltip2" watch="RecipeUsedInTooltip2" help="true" />
			<instance name="item_tooltip" id="recipe_usedin_tooltip3" watch="RecipeUsedInTooltip3" help="true" />
			
			<!-- New store global tooltip -->
			<instance name="item_tooltip" id="shopGlobalItemTooltip" watch="shopGlobalItemTooltipUpdate" help="true" />
		</panel>

		<instance name="item_tooltip_short" id="shop_item_tooltip_short0" watch="ShopItemTooltip0" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short1" watch="ShopItemTooltip1" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short2" watch="ShopItemTooltip2" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short3" watch="ShopItemTooltip3" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short4" watch="ShopItemTooltip4" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short5" watch="ShopItemTooltip5" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short6" watch="ShopItemTooltip6" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short7" watch="ShopItemTooltip7" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short8" watch="ShopItemTooltip8" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short9" watch="ShopItemTooltip9" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short10" watch="ShopItemTooltip10" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short11" watch="ShopItemTooltip11" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short12" watch="ShopItemTooltip12" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short13" watch="ShopItemTooltip13" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short14" watch="ShopItemTooltip14" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short15" watch="ShopItemTooltip15" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short16" watch="ShopItemTooltip16" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short17" watch="ShopItemTooltip17" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short18" watch="ShopItemTooltip18" help="true" />
		<instance name="item_tooltip_short" id="shop_item_tooltip_short19" watch="ShopItemTooltip19" help="true" />

		<instance name="item_tooltip_short" id="recipe_item_tooltip_short" watch="RecipeItemTooltip" help="true" />

		<instance name="item_tooltip_short" id="recipe_component_tooltip_short0" watch="RecipeComponentTooltip0" help="true" />
		<instance name="item_tooltip_short" id="recipe_component_tooltip_short1" watch="RecipeComponentTooltip1" help="true" />
		<instance name="item_tooltip_short" id="recipe_component_tooltip_short2" watch="RecipeComponentTooltip2" help="true" />
		<instance name="item_tooltip_short" id="recipe_component_tooltip_short3" watch="RecipeComponentTooltip3" help="true" />

		<instance name="item_tooltip_short" id="recipe_usedin_tooltip_short0" watch="RecipeUsedInTooltip0" help="true" />
		<instance name="item_tooltip_short" id="recipe_usedin_tooltip_short1" watch="RecipeUsedInTooltip1" help="true" />
		<instance name="item_tooltip_short" id="recipe_usedin_tooltip_short2" watch="RecipeUsedInTooltip2" help="true" />
		<instance name="item_tooltip_short" id="recipe_usedin_tooltip_short3" watch="RecipeUsedInTooltip3" help="true" />

	</template>

	<!-- Newest Shop -->
	<style name="item_header" color="#058F31" />
	<style name="recipe_header" color="#056490" />

	<!-- Menu Item -->

	<template name="menu_item_widgetstate">
		<widgetstate statename="{statename}" x="{x}" y="{y}">
			<image texture="/ui/common/new_shop_interface/listing_bg.tga" color="{bgColor}" />
			<frame color="invisible" borderthickness="1" bordercolor="{bordercolor}" noclick="true"/>
			<image x="0.6h" texture="{icon}" width="76@" height="76%" valign="center"/>
			
			<label x="110@" font="dyn_10" textvalign="center" color="1 1 1 1" shadow="true" content="{label}"
				watch="ShopKey{slot}"
				ontrigger="
					##If(
						!StringEmpty(param),
						SetText(Translate('{label}') # ' (^960' # Translate(param) # '^*)'),##
						SetText(Translate('{label}'));
					##);##
				"
			/>
			<panel x="-0.5h" y="0" width="1.9h" height="1.9h" valign="center" align="right" visible="0" watch="ShopKey{slot}" ontrigger="SetVisible(!StringEmpty(param));" >
				<frame texture="/ui/frames/key.tga" width="100%" height="100%" borderthickness="33@" align="center" />
				<label y="-1" width="100%" height="100%" font="dyn_10" align="center" textalign="center" textvalign="center" color=".1 .1 .1 1" shadow="true" shadowcolor=".8 .8 .8 1"
					content="{slot}" watch0="ShopKey{slot}" ontrigger0="SetText(Translate(param));"
				/>
			</panel>				
			<panel noclick="true" x="-.5h" width="1.7h" height="1.7h" align="right"	valign="center" visible="{showClose=false}">
				<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.5h" color="{closeColor=#910000}" blockinput="false" noclick="true"/>
				<frame texture="/ui/frames/roundframe.tga" color="0 0 0 1" borderthickness="0.5h" blockinput="false" noclick="true"/>
				<image width="1.3h" height="1.3h" align="center" valign="center" color=".75 .75 .75 1" texture="/ui/elements/closex.tga" noclick="true" />
			</panel>
		</widgetstate>
	</template>

	<template name="menu_item">
		<panel
			width="100%" height="{height=3.0h}"
			align="center"
			name="menu_item_{shopname}{filterName}"
		>
			<!-- The additional panel makes facilitating the animations and whatnot much easier without interfering with grow/etc. -->
			<panel noclick="true"
				group="{group}"
				onevent0="
					SleepWidget(
						25 * {slideIndex=0} * _shopFlag_animSpeedMult,
						'
							SlideX(0, 125 * _shopFlag_animSpeedMult);
							FadeIn(125 * _shopFlag_animSpeedMult);
						'
					);
				"
				onevent1="
					SleepWidget(
						25 * {slideIndex=0} * _shopFlag_animSpeedMult,
						'
							SlideX(\'110%\', 125 * _shopFlag_animSpeedMult);
							FadeOut(125 * _shopFlag_animSpeedMult);
						'
					);
				"
				onevent2="
					SetX(0);
					SetVisible(true);
				"
				onevent3="
					SetX('110%');
					SetVisible(false);
				"
				visible="{visible=true}"
				x="{x}"
			>
				<!-- Menu Button -->
				<button
					width="100%"
					height="100%"
					color="invisible"
					numstates="2"
					group="menu_item_group"
					interactive="false"
					name="menu_button_{shopname}{filterName}"
					onclick="
						PlaySound('/shared/sounds/ui/button_click_03.wav');

						
						Set('_executeShopSearch', false);
						Call(
							'shop_search_entry',
							'
								If(
									!StringEmpty(this),
									EraseInputLine()									
								);
								Set(\'_lastShopSearch\', \'\');
								CallEvent(\'shop_search_label\', 0);
								
							'
						);
						
						If(
							!{filter=false},
							Set('_activeShopFilters', '')
						);
						
						If(
							{filter=false},
							DoEvent(0),
							If(
								StringEquals(_lastActiveShop, '{shopname}'),
								Trigger('SetShopDisplay', ''),
								Trigger('SetShopDisplay', '{shopname}')
							)
						);
					"
					onrightclick="
						If(
							{filter=false},
							Split(
								Set('_executeShopSearch', false),
								Call(
									'shop_search_entry',
									'
										If(
											!StringEmpty(this),
											EraseInputLine()									
										);
										Set(\'_lastShopSearch\', \'\');
										CallEvent(\'shop_search_label\', 0);
										
									'
								),
								GroupCall(
									'menu_item_group',
									'DoEvent(3);'
								),
								SetButtonState(1),
								Set('_lastActiveShop', ''),
								PlaySound('/shared/sounds/ui/button_click_03.wav')
							)
						);
						
						Set('_activeShopFilters', '');
						
						If(
							{filter=false},
							GroupCall(
								'menu_item_group',
								'DoEvent(1);'
							)
						);
						
						If(
							{filter=false},
							Trigger('SetShopDisplay', '')
						);
					"
					onevent="
						If(
							!StringEmpty('{shopname}'),
							If(
								StringEquals(_lastActiveShop, '{shopname}'),
								SetButtonState(1),
								SetButtonState(0)
							),
							SetButtonState(0)

						);
					"
					onmouseover="
						If(
							!StringEmpty('{tip_id}'),
							If(
								WidgetExists('{tip_id}'),
								ShowWidget('{tip_id}')
							)
						);
					"
					onmouseout="
						If(
							!StringEmpty('{tip_id}'),
							If(
								WidgetExists('{tip_id}'),
								HideWidget('{tip_id}')
							)
						);
					"
					onevent0="
						Set('_activeShopFilters', '');
						GroupCall(
							'menu_item_group',
							'DoEvent(1);'
						);
						Trigger('SetShopDisplay', '');						
					"
					onevent1="
						If(
							!StringEmpty('{filterName}'),
							If(
								GetButtonState(),
								Set('_activeShopFilters', _activeShopFilters # If(!StringEmpty(_activeShopFilters), ',', '') # '{filterName}')
							)
						);
					"
					onevent3="
						SetButtonState(0);
					"
				>
					<instance name="menu_item_widgetstate" icon="{icon}" label="{label}" slot="{slot}" statename="up" bgColor="{bgColor=.15 .15 .15 1}" bordercolor="{bordercolor=.2 .2 .2 1}"/>
					<instance name="menu_item_widgetstate" icon="{icon}" label="{label}" slot="{slot}" statename="over" closeColor="#dc0000" bgColor="{bgHover=.25 .25 .25 1}" bordercolor="{bordercolor=.2 .2 .2 1}"/>
					<instance name="menu_item_widgetstate" icon="{icon}" label="{label}" slot="{slot}" statename="down" x="1" y="1" bgColor="{bgHover=.25 .25 .25 1}" bordercolor="{bordercolor=.2 .2 .2 1}" />
					<instance name="menu_item_widgetstate" icon="{icon}" label="{label}" slot="{slot}" statename="disabled" rendermode="greyscale"/>
					
					<instance name="menu_item_widgetstate" icon="{icon}" label="{label}" slot="{slot}" statename="up2" showClose="{showClose=false}" bgColor="{bgHover=.25 .25 .25 1}" bordercolor="{bordercolor2=.3 .3 .3 1}"/>
					<instance name="menu_item_widgetstate" icon="{icon}" label="{label}" slot="{slot}" statename="over2" showClose="{showClose=false}" closeColor="#dc0000" bgColor="{bgHover=.25 .25 .25 1}" bordercolor="{bordercolor2=.3 .3 .3 1}"/>
					<instance name="menu_item_widgetstate" icon="{icon}" label="{label}" slot="{slot}" statename="down2" showClose="{showClose=false}" x="1" y="1" bgColor="{bgHover=.25 .25 .25 1}" bordercolor="{bordercolor2=.3 .3 .3 1}"/>
					<instance name="menu_item_widgetstate" icon="{icon}" label="{label}" slot="{slot}" statename="disabled2" showClose="{showClose=false}" rendermode="greyscale"/>

				</button>
			</panel>
		</panel>
	</template>

	<template name="tree_component_base">
		<panel y="{y}" width="200@" height="22.5%" align="right" noclick="true" group="tree_component_bases"
			onload="
				If(
					!VarExists('component_branch_height'),
					CreateInt('component_branch_height', GetHeight())
				);
				
				CreateBool('_componentGroupValid{rowIndex}', false);
				CreateBool('_componentGroupValidOld{rowIndex}', false);
				CreateString('_componentGroupTargY{rowIndex}', '0');
				CreateInt('_storeCompCurRowIndex{slotInit}', {rowIndex});
				CreateInt('_storeCompCurRowIndex{slotSubA}', {rowIndex});
				CreateInt('_storeCompCurRowIndex{slotSubB}', {rowIndex});
				CreateInt('_storeCompCurRowIndex{slotSubC}', {rowIndex});
				CreateInt('_storeCompCurRowIndex{slotSubD}', {rowIndex});
			"
			watch="componentReadTree"
			ontrigger="
				Set('_componentGroupValidOld{rowIndex}', _componentGroupValid{rowIndex});
				Set(
					'_componentGroupValid{rowIndex}',
					(_storeCompCurValid{slotInit} or _storeCompCurValid{slotSubA} or _storeCompCurValid{slotSubB} or _storeCompCurValid{slotSubC} or _storeCompCurValid{slotSubD})
				);
			"
			watch1="componentApplyTreeAnim"
			ontrigger1="
				If(
					_componentGroupValid{rowIndex},
					Trigger('componentSlotVis', 0, {rowIndex}, true),
					Trigger('componentSlotVis', 0, {rowIndex}, false)
				);
			"
			onevent2="
				If(
					_componentGroupValid{rowIndex},
					SetVisible(true),
					SetVisible(false)
				);
			"
			watch2="componentApplyTreeAnim"
			ontrigger2="
				If(
					_componentGroupValid{rowIndex},
					If(
						_componentGroupValid3,
						Set('_componentGroupTargY{rowIndex}', '{itemY4=0}'),
						If(
							_componentGroupValid2,
							Set('_componentGroupTargY{rowIndex}', '{itemY3=0}'),
							If(
								_componentGroupValid1,
								Set('_componentGroupTargY{rowIndex}', '{itemY2=0}'),
								Set('_componentGroupTargY{rowIndex}', '{itemY1=0}')
							)
						)
					)
				);
				
				If(
					_componentGroupValid{rowIndex},
					SlideY(_componentGroupTargY{rowIndex}, 200 * _shopFlag_animSpeedMult)
				);
			"
		>

			<!-- Sub-component -->
			<panel x="-10%" width="100%" height="100%" valign="center" align="right" noclick="true">

				<!-- 4 -->
				<panel x="-420@" width="100@" height="100%" align="right" noclick="true">
					<panel x="-65@" width="115@" align="right" valign="center" noclick="true">
						<instance name="recipe_component_item_icon" index="{slotSubD}"/>
					</panel>
					<image width="330@" height="165%" align="right" valign="center" texture="/ui/common/new_shop_interface/sub_base_left.tga" noclick="true" 
						watch="componentSlotVis"
						ontrigger="
							If(
								param0 == 0 and param1 == {rowIndex},
								If(
									param2 and _storeCompCurValid{slotSubD},
									Split(
										FadeIn(200 * _shopFlag_animSpeedMult),
										SlideX(0, 200 * _shopFlag_animSpeedMult)
									),
									Split(
										FadeOut(200 * _shopFlag_animSpeedMult),
										SlideX('19.85h', 200 * _shopFlag_animSpeedMult)
									)
								)
							);
						"
					/>
				</panel>
				
				<!-- 3 -->
				<panel x="-280@" width="100@" height="100%" align="right" noclick="true">
					<image width="330@" height="165%" align="right" valign="center" texture="/ui/common/new_shop_interface/sub_base_left.tga" noclick="true"
						watch="componentSlotVis"
						ontrigger="
							If(
								param0 == 0 and param1 == {rowIndex},
								If(
									param2 and _storeCompCurValid{slotSubC},
									Split(
										FadeIn(200 * _shopFlag_animSpeedMult),
										SlideX(0, 200 * _shopFlag_animSpeedMult)
									),
									Split(
										FadeOut(200 * _shopFlag_animSpeedMult),
										SlideX('15.28h', 200 * _shopFlag_animSpeedMult)
									)
								)
							);
						"
					/>
					<panel x="-65@" width="115@" height="115%" align="right" valign="center" noclick="true">
						<instance name="recipe_component_item_icon" index="{slotSubC}"/>
					</panel>
				</panel>
				
				<!-- 2 -->
				<panel x="-140@" width="100@" height="100%" align="right" noclick="true">
					<image width="330@" height="165%" align="right" valign="center" texture="/ui/common/new_shop_interface/sub_base_left.tga" noclick="true"
						watch="componentSlotVis"
						ontrigger="
							If(
								param0 == 0 and param1 == {rowIndex},
								If(
									param2 and _storeCompCurValid{slotSubB},
									Split(
										FadeIn(200 * _shopFlag_animSpeedMult),
										SlideX(0, 200 * _shopFlag_animSpeedMult)
									),
									Split(
										FadeOut(200 * _shopFlag_animSpeedMult),
										SlideX('10.99h', 200 * _shopFlag_animSpeedMult)
									)
								)
							);
						"
					/>
					<panel x="-65@" width="115@" height="115%" align="right" valign="center" noclick="true">
						<instance name="recipe_component_item_icon" index="{slotSubB}"/>
					</panel>
				</panel>

				<!-- 1 -->
				<panel x="0" width="100@" height="100%"  align="right" noclick="true">
					<image width="330@" height="165%" align="right" valign="center" texture="/ui/common/new_shop_interface/sub_base_left.tga" noclick="true"
						watch="componentSlotVis"
						ontrigger="
							If(
								param0 == 0 and param1 == {rowIndex},
								If(
									param2 and _storeCompCurValid{slotSubA},
									Split(
										FadeIn(200 * _shopFlag_animSpeedMult),
										SlideX(0, 200 * _shopFlag_animSpeedMult)
									),
									Split(
										FadeOut(200 * _shopFlag_animSpeedMult),
										SlideX('6.24h', 200 * _shopFlag_animSpeedMult)
									)
								)
							);
						"
					/>
					<panel x="-65@" width="115@" height="115%" align="right" valign="center" noclick="true">
						<instance name="recipe_component_item_icon" index="{slotSubA}"/>
					</panel>
				</panel>
				
			</panel>			
			
			<!-- Initial Component -->
			<panel width="100@" height="100%" valign="center" align="right" noclick="true">
				<image noclick="true" texture="/ui/common/new_shop_interface/left_circle_frame_black.tga" x="0" y="0" width="160%" height="160%" valign="center" align="center"
					watch="componentSlotVis"
					ontrigger="
						If(
							param0 == 0 and param1 == {rowIndex},
							If(
								param2 and _storeCompCurValid{slotInit},
								FadeIn(200 * _shopFlag_animSpeedMult),
								FadeOut(200 * _shopFlag_animSpeedMult)
							)
						);
					"
				/>
				<instance name="recipe_component_item_icon" index="{slotInit}"/>
			</panel>			
			
		</panel>
	</template>

	<template name="tree_buildup_base">
		<panel y="{y}" width="200@" height="22.5%" align="left" noclick="true" group="tree_buildup_bases"
			onload="
				CreateBool('_buildupGroupValid{rowIndex}', false);
				CreateBool('_buildupGroupValidOld{rowIndex}', false);
				CreateString('_buildupGroupTargY{rowIndex}', '0');
				CreateInt('_storeCompCurRowIndex{slotInit}', {rowIndex});
				CreateInt('_storeCompCurRowIndex{slotSubA}', {rowIndex});
				CreateInt('_storeCompCurRowIndex{slotSubB}', {rowIndex});
				CreateInt('_storeCompCurRowIndex{slotSubC}', {rowIndex});
				CreateInt('_storeCompCurRowIndex{slotSubD}', {rowIndex});
			"
			watch="componentReadTree"
			ontrigger="
				Set('_buildupGroupValidOld{rowIndex}', _buildupGroupValid{rowIndex});
				Set(
					'_buildupGroupValid{rowIndex}',
					(_storeCompCurValid{slotInit} or _storeCompCurValid{slotSubA} or _storeCompCurValid{slotSubB} or _storeCompCurValid{slotSubC} or _storeCompCurValid{slotSubD})
				);
			"
			watch1="componentApplyTreeAnim"
			ontrigger1="
				If(
					_buildupGroupValid{rowIndex},
					Trigger('componentSlotVis', 1, {rowIndex}, true),
					Trigger('componentSlotVis', 1, {rowIndex}, false)
				);
			"

			onevent2="
				If(
					_buildupGroupValid{rowIndex},
					SetVisible(true),
					SetVisible(false)
				);
			"
			watch2="componentApplyTreeAnim"
			ontrigger2="
				If(
					_buildupGroupValid{rowIndex},
					If(
						_buildupGroupValid3,
						Set('_buildupGroupTargY{rowIndex}', '{itemY4=0}'),
						If(
							_buildupGroupValid2,
							Set('_buildupGroupTargY{rowIndex}', '{itemY3=0}'),
							If(
								_buildupGroupValid1,
								Set('_buildupGroupTargY{rowIndex}', '{itemY2=0}'),
								Set('_buildupGroupTargY{rowIndex}', '{itemY1=0}')
							)
						)
					)
				);
				
				If(
					_buildupGroupValid{rowIndex},
					SlideY(_buildupGroupTargY{rowIndex}, 200 * _shopFlag_animSpeedMult)
				);
			"
		>
			
			<!-- Second Tier Buildups -->
			<panel x="10%" width="100%" height="100%" valign="center" align="left" noclick="true">

				<!-- 4 -->
				<panel x="420@" width="100@" height="100%" align="left" noclick="true">
					<image width="330@" height="165%" align="left" valign="center" texture="/ui/common/new_shop_interface/sub_base_right.tga" noclick="true"
						watch="componentSlotVis"
						ontrigger="
							If(
								param0 == 1 and param1 == {rowIndex},
								If(
									param2 and _storeCompCurValid{slotSubD},
									Split(
										FadeIn(200 * _shopFlag_animSpeedMult),
										SlideX(0, 200 * _shopFlag_animSpeedMult)
									),
									Split(
										FadeOut(200 * _shopFlag_animSpeedMult),
										SlideX('-19.85h', 200 * _shopFlag_animSpeedMult)
									)
								)
							);
						"
					/>
					<panel x="65@" width="115@" height="115%" align="left" valign="center" noclick="true">
						<instance name="recipe_component_item_icon" index="{slotSubD}"/>
					</panel>
				</panel>

				<!-- 3 -->
				<panel x="280@" width="100@" height="100%" align="left" noclick="true">
					<image width="330@" height="165%" align="left" valign="center" texture="/ui/common/new_shop_interface/sub_base_right.tga" noclick="true"
						watch="componentSlotVis"
						ontrigger="
							If(
								param0 == 1 and param1 == {rowIndex},
								If(
									param2 and _storeCompCurValid{slotSubC},
									Split(
										FadeIn(200 * _shopFlag_animSpeedMult),
										SlideX(0, 200 * _shopFlag_animSpeedMult)
									),
									Split(
										FadeOut(200 * _shopFlag_animSpeedMult),
										SlideX('-15.28h', 200 * _shopFlag_animSpeedMult)
									)
								)
							);
						"
					/>
					<panel x="65@" width="115@" height="115%" align="left" valign="center" noclick="true">
						<instance name="recipe_component_item_icon" index="{slotSubC}"/>
					</panel>
				</panel>
	
				<!-- 2 -->
				<panel x="140@" width="100@" height="100%" align="left" noclick="true">
					<image width="330@" height="165%" align="left" valign="center" texture="/ui/common/new_shop_interface/sub_base_right.tga" noclick="true"
						watch="componentSlotVis"
						ontrigger="
							If(
								param0 == 1 and param1 == {rowIndex},
								If(
									param2 and _storeCompCurValid{slotSubB},
									Split(
										FadeIn(200 * _shopFlag_animSpeedMult),
										SlideX(0, 200 * _shopFlag_animSpeedMult)
									),
									Split(
										FadeOut(200 * _shopFlag_animSpeedMult),
										SlideX('-10.99h', 200 * _shopFlag_animSpeedMult)
									)
								)
							);
						"
					/>
					<panel x="65@" width="115@" height="115%" align="left" valign="center" noclick="true">
						<instance name="recipe_component_item_icon" index="{slotSubB}"/>
					</panel>
				</panel>
	
				<!-- 1 -->
				<panel x="0" width="100@" height="100%" align="left" noclick="true">
					<image width="330@" height="165%" align="left" valign="center" texture="/ui/common/new_shop_interface/sub_base_right.tga" noclick="true"
						watch="componentSlotVis"
						ontrigger="
							If(
								param0 == 1 and param1 == {rowIndex},
								If(
									param2 and _storeCompCurValid{slotSubA},
									Split(
										FadeIn(200 * _shopFlag_animSpeedMult),
										SlideX(0, 200 * _shopFlag_animSpeedMult)
									),
									Split(
										FadeOut(200 * _shopFlag_animSpeedMult),
										SlideX('-6.24h', 200 * _shopFlag_animSpeedMult)
									)
								)
							);
						"
					/>
					<panel x="65@" width="115@" height="115%" align="left" valign="center" noclick="true">
						<instance name="recipe_component_item_icon" index="{slotSubA}"/>
					</panel>
				</panel>
				
				
			
				
			</panel>


			<!-- Initial Buildup -->
			<panel width="90@" height="90%" valign="center" align="left" noclick="true">
				<image noclick="true" texture="/ui/common/new_shop_interface/right_circle_frame_black.tga" x="0" y="0" width="160%" height="160%" valign="center" align="center"
					watch="componentSlotVis"
					ontrigger="
						If(
							param0 == 1 and param1 == {rowIndex},
							If(
								param2 and _storeCompCurValid{slotInit},
								FadeIn(200 * _shopFlag_animSpeedMult),
								FadeOut(200 * _shopFlag_animSpeedMult)
							)
						);
					"
				/>
				<instance name="recipe_component_item_icon" index="{slotInit}"/>
			</panel>


		</panel>
	</template>
	
	<template name="componentIconPlaceholder">
		<panel noclick="true" color="invisible" visible="false" width="{width}" height="{height}"
			oninstantiate="
				SetX({x} - GetParentAbsoluteX());
				SetY({y} - GetParentAbsoluteY());
				FadeIn(200 * _shopFlag_animSpeedMult);
				SlideY(
					(
						GetYFromString(
							*(
								If(
									{sourceIndex} gt 71,
									'_buildupGroupTargY',
									'_componentGroupTargY'
								)
								# _storeCompCurRowIndex{sourceIndex}
							)
						) +
						(
							( component_branch_height - GetHeight() ) / 2
						)
					), 200 * _shopFlag_animSpeedMult
				);
				SleepWidget(200 * _shopFlag_animSpeedMult, 'DoEvent(0);');
			"
			onevent0="
				Slide(
					{targX} - GetParentAbsoluteX(),
					{targY} - GetParentAbsoluteY(),
					200 * _shopFlag_animSpeedMult
				);
				SleepWidget(200 * _shopFlag_animSpeedMult, 'DoEvent(1);');
			"
			onevent1="
				FadeOut(200 * _shopFlag_animSpeedMult);
				SleepWidget(200 * _shopFlag_animSpeedMult, 'DestroyWidget();');
			"
			watch="RecipeItem"
			ontrigger="DestroyWidget();"
		>
			
			<panel
				oninstantiate="
					SleepWidget(200 * _shopFlag_animSpeedMult, 'DoEvent();');
				"
				onevent="
					Scale({targWidth}, {targHeight}, 200 * _shopFlag_animSpeedMult);
				"
				color="invisible" noclick="true"	
			>
			
			
				<image noclick="true" oninstantiate="SetTexture(_storeCompCurTexture{targIndex}); If(_storeCompCurAvailable{targIndex}, SetRenderMode('normal'), SetRenderMode('grayscale'));" />
				<piegraph start="270" visible="false" end="-90" square="true" color="#000000cc" watch="RecipeExpandedComponents{targIndex}" ontrigger="SetVisible(param21 gt 0); SetValue(param20);" noclick="true"/> 
				<frame color="invisible" borderthickness="1" bordercolor="0 0 0 1" noclick="true"/>
				<!-- Owned Item Indicator -->
				<frame
					width="-2" height="-2" x="1" y="1"
					borderthickness="0.2h"
					color="invisible"
					oninstantiate="
					If(
						_storeCompCurOwnLocal{targIndex} or _storeCompCurOwnRemote{targIndex},
						If(
							_storeCompCurOwnLocal{targIndex},
							SetBorderColor('#16e124'),
							SetBorderColor('#ddbb24')
						),
						SetBorderColor('invisible'));
					"
					noclick="1"
				/>
				<panel color="0 0 0 0.6" oninstantiate="SetVisible(!_storeCompCurAvailable{targIndex});" visible="false" noclick="true"/>
	
				<panel
					oninstantiate="
						SetVisible(_storeCompCurRecipeOverlay{targIndex});
					"
				>
					<image align="center" valign="center" width="-45%" height="-45%" oninstantiate="SetTexture(_storeCompCurTexture{targIndex});"	/>
					<image texture="/ui/elements/shop/scroll_overlay.tga"/>
					<frame color="invisible" borderthickness="1" bordercolor=".5 .5 .5 1" />
				</panel>

				<image texture="/ui/common/new_shop_interface/stash.tga" x="0.5h" y="0.5h" width="2.2h" height="2.2h" align="right" valign="bottom" noclick="true" visible="false" oninstantiate="SetVisible(_storeCompCurToStash{targIndex});" />
				<image texture="/ui/elements/star.tga" x="-10%" y="-10%" width="15%" height="15%" align="left" valign="top" noclick="true" visible="true" color="1 1 0 1" />
				
				<!--

					<label textalign="center" textvalign="center" width="1.5h" height="1.5h" align="right" font="dyn_10" shadow="true" color="white" watch="RecipeExpandedComponents{targIndex}" ontrigger="SetText(param19);" noclick="true" />
					<label noclick="1" valign="center" align="center" textvalign="center" textalign="center" color="#87CEEB" shadow="1" font="dyn_11" watch="RecipeExpandedComponents{targIndex}" ontrigger="SetVisible(param21 gt 0); SetText(FtoT(param21, 1, 0, '-'));"/>
				-->
				

			</panel>
		</panel>
	</template>
	
	<!-- This one handles to/from the central icon -->
	<template name="recipeIconPlaceholder">
		<panel noclick="true" color="invisible" visible="false" width="{width}" height="{height}"
			oninstantiate="
				SetX({x} - GetParentAbsoluteX());
				SetY({y} - GetParentAbsoluteY());
				FadeIn(200 * _shopFlag_animSpeedMult);
				If(
					StringEquals('{sourceWatch}', 'RecipeExpandedComponents'),
					DoEvent(2)
				);
				
				SleepWidget(200 * _shopFlag_animSpeedMult, 'DoEvent(0);');
			"
			onevent0="
				Slide(
					{targX} - GetParentAbsoluteX(),
					{targY} - GetParentAbsoluteY(),
					200 * _shopFlag_animSpeedMult
				);
				SleepWidget(200 * _shopFlag_animSpeedMult, 'DoEvent(1);');
			"
			onevent1="
				FadeOut(200 * _shopFlag_animSpeedMult);
				SleepWidget(200 * _shopFlag_animSpeedMult, 'DestroyWidget();');
			"
			onevent2="
				SlideY(
					(
						GetYFromString(
							*(
								If(
									{sourceIndex} gt 71,
									'_buildupGroupTargY',
									'_componentGroupTargY'
								)
								# _storeCompCurRowIndex{sourceIndex}
							)
						) +
						(
							( component_branch_height - GetHeight() ) / 2
						)
					), 200 * _shopFlag_animSpeedMult
				);
			"
			watch="RecipeItem"
			ontrigger="DestroyWidget();"
		>
			
			<panel
				oninstantiate="
					SleepWidget(200 * _shopFlag_animSpeedMult, 'DoEvent();');
				"
				onevent="
					Scale({targWidth}, {targHeight}, 200 * _shopFlag_animSpeedMult);
				"
				color="invisible" noclick="true"	
			>
				<image noclick="true"
					oninstantiate="
						If(
							StringEquals('{targWatch}', 'recipeItem'),
							DoEvent(0),
							DoEvent(1)
						);
					"
					onevent0="
						SetTexture(_storeRecipeCurTexture);
						If(
							_storeRecipeCurAvailable,
							SetRenderMode('normal'),
							SetRenderMode('grayscale')
						);
					"
					onevent1="
						SetTexture(_storeCompCurTexture{targIndex=0});
						If(
							_storeCompCurAvailable{targIndex=0}, SetRenderMode('normal'), SetRenderMode('grayscale')
						);
					"
				/>
				<piegraph start="270" visible="false" end="-90" square="true" color="#000000cc"
					watch="{targWatch}{targIndex}" ontrigger="SetVisible(param21 gt 0); SetValue(param20);" noclick="true"
				/> 
				<frame color="invisible" borderthickness="1" bordercolor="0 0 0 1" noclick="true"/>
				<!-- Owned Item Indicator -->
				<frame
					width="-2" height="-2" x="1" y="1"
					borderthickness="0.2h"
					color="invisible"
					oninstantiate="
						If(
							StringEquals('{targWatch}', 'recipeItem'),
							DoEvent(0),							
							DoEvent(1)
						);
					"
					onevent0="
						If(
							_storeRecipeCurOwnLocal or _storeRecipeCurOwnRemote,
							If(
								_storeRecipeCurOwnLocal,
								SetBorderColor('#16e124'),
								SetBorderColor('#ddbb24')
							),
							SetBorderColor('invisible')
						);
					"
					onevent1="
						If(
							_storeCompCurOwnLocal{targIndex=0} or _storeCompCurOwnRemote{targIndex=0},
							If(
								_storeCompCurOwnLocal{targIndex=0},
								SetBorderColor('#16e124'),
								SetBorderColor('#ddbb24')
							),
							SetBorderColor('invisible')
						);
					"
					noclick="1"
				/>
				<panel color="0 0 0 0.6"
					oninstantiate="
						If(
							StringEquals('{targWatch}', 'recipeItem'),
							DoEvent(0),
							DoEvent(1)
						);					
					"
					onevent0="
						SetVisible(!_storeRecipeCurAvailable);
					"
					onevent1="
						SetVisible(!_storeCompCurAvailable{targIndex=0});
					"
					visible="false" noclick="true"/>
	
				<panel
					oninstantiate="
						If(
							StringEquals('{targWatch}', 'recipeItem'),
							DoEvent(0),
							DoEvent(1)
						);
					"
					onevent0="
						SetVisible(false);
					"
					onevent1="
						SetVisible(_storeCompCurRecipeOverlay{targIndex=0});
					"
					visible="false"
				>
					<image align="center" valign="center" width="-45%" height="-45%"
						oninstantiate="
							If(
								StringEquals('{targWatch}', 'recipeItem'),
								DoEvent(0),
								DoEvent(1)
							);
						"
						onevent0="
							SetTexture(_storeRecipeCurTexture);
						"
						onevent1="
							SetTexture(_storeCompCurTexture{targIndex=0});
						"
					/>
					<image texture="/ui/elements/shop/scroll_overlay.tga"/>
					<frame color="invisible" borderthickness="1" bordercolor=".5 .5 .5 1" />
				</panel>

				<frame color="invisible" borderthickness="2" bordercolor="yellow" noclick="true" visible="false"
					oninstantiate="
						If(
							StringEquals('{targWatch}', 'recipeItem'),
							DoEvent(0)
						);
						
						If(
							StringEquals('{sourceWatch}', 'recipeItem'),
							DoEvent(1)
						);
					"
					onevent0="
						SleepWidget(
							200 * _shopFlag_animSpeedMult,
							'FadeIn(200 * _shopFlag_animSpeedMult);'
						);
					"
					onevent1="
						SetVisible(true);
						SleepWidget(
							200 * _shopFlag_animSpeedMult,
							'FadeOut(200 * _shopFlag_animSpeedMult);'
						);
					"
				 />
				
				<image texture="/ui/common/new_shop_interface/stash.tga" x="0.5h" y="0.5h" width="2.2h" height="2.2h" align="right" valign="bottom" noclick="true" visible="false"
					oninstantiate="
					
						If(
							StringEquals('{targWatch}', 'recipeItem'),
							DoEvent(0),
							DoEvent(1)
						);
						
					"
					onevent0="
						SetVisible(_storeRecipeCurToStash);
					"
					onevent1="
						SetVisible(_storeCompCurToStash{targIndex});
					"
				/>
				<image texture="/ui/elements/star.tga" x="-0.7h" y="-0.7h" width="1.4h" height="1.4h" align="left" valign="top" noclick="true" visible="false"
					oninstantiate="
						If(
							StringEquals('{targWatch}', 'recipeItem'),
							DoEvent(0),
							DoEvent(1)
						);
					"
					onevent0="
						SetVisible(_storeRecipeCurRecommended);
					"
					onevent1="
						SetVisible(_storeCompCurRecommended{targIndex});
					"
					color="1 1 0 1"
				/>
				
				<!--

					Text alignment is screwy when these guys slide.  Probably skipping out on them for now
					<label textalign="center" textvalign="center" width="1.5h" height="1.5h" align="right" font="dyn_10" shadow="true" color="white" watch="{targWatch}{targIndex}" ontrigger="SetText(param19);" noclick="true" />
					<label noclick="1" valign="center" align="center" textvalign="center" textalign="center" color="#87CEEB" shadow="1" font="dyn_11" watch="{targWatch}{targIndex}" ontrigger="SetVisible(param21 gt 0); SetText(FtoT(param21, 1, 0, '-'));"/>					
				 -->
				 


			</panel>
		</panel>
	</template>
	
	
	<template name="rCompVarHolder">
		<panel color="invisible" noclick="true"
			group="rCompVarHolders"
			name="rCompVarHolderCurrent{index}"
			onload="
				CreateString('_storeCompCurCost{index}', '');
				CreateBool('_storeCompCurValid{index}', false);
				CreateString('_storeCompCurName{index}', '');
				CreateString('_storeCompCurDesc{index}', '');
				CreateString('_storeCompCurEntity{index}', '');
				CreateString('_storeCompCurTexture{index}', '');
				CreateBool('_storeCompCurIsRecipe{index}', false);
				CreateBool('_storeCompCurRecipeOverlay{index}', false);
				CreateBool('_storeCompCurAvailable{index}', false);
				CreateBool('_storeCompCurToStash{index}', false);
				CreateBool('_storeCompCurOwnLocal{index}', false);
				CreateBool('_storeCompCurOwnRemote{index}', false);
				CreateBool('_storeCompCurRecommended{index}', false);

				## Old data for comparisons when making transitions ##
				
				CreateString('_storeCompOldCost{index}', '');
				CreateBool('_storeCompOldValid{index}', false);
				CreateString('_storeCompOldName{index}', '');
				CreateString('_storeCompOldDesc{index}', '');
				CreateString('_storeCompOldEntity{index}', '');
				CreateString('_storeCompOldTexture{index}', '');
				CreateBool('_storeCompOldIsRecipe{index}', false);
				CreateBool('_storeCompOldRecipeOverlay{index}', false);
				CreateBool('_storeCompOldAvailable{index}', false);
				CreateBool('_storeCompOldToStash{index}', false);
				CreateBool('_storeCompOldOwnLocal{index}', false);
				CreateBool('_storeCompOldOwnRemote{index}', false);
				CreateBool('_storeCompOldRecommended{index}', false);

				## Indicates whether a match was found in the new recipe (if one was found, it fades in -before- the icon disappears, otherwise the icon simply fades out) ##				
				CreateBool('_storeCompFoundMatch{index}', false);
			"
			watch="RecipeExpandedComponents{index}"
			ontrigger="
				Set('_storeCompCurCost{index}', param5);
				Set('_storeCompCurValid{index}', param0);
				Set('_storeCompCurName{index}', param1);
				Set('_storeCompCurDesc{index}', param2);
				Set('_storeCompCurTexture{index}', param3);
				Set('_storeCompCurEntity{index}', param28);
				Set('_storeCompCurIsRecipe{index}', param8);
				Set('_storeCompCurRecipeOverlay{index}', param29);
				Set('_storeCompCurAvailable{index}', param25);
				Set('_storeCompCurRecommended{index}', param27);
				Set('_storeCompCurToStash{index}', param15);
				Set('_storeCompCurOwnLocal{index}', param11);
				Set('_storeCompCurOwnRemote{index}', param26);
			"
			onevent="
				Set('_storeCompOldValid{index}', _storeCompCurValid{index});
				Set('_storeCompOldEntity{index}', _storeCompCurEntity{index});
				Set('_storeCompOldTexture{index}', _storeCompCurTexture{index});
				Set('_storeCompOldIsRecipe{index}', _storeCompCurIsRecipe{index});
				Set('_storeCompOldRecipeOverlay{index}', _storeCompCurRecipeOverlay{index});
				Set('_storeCompOldAvailable{index}', _storeCompCurAvailable{index});
				Set('_storeCompOldToStash{index}', _storeCompCurToStash{index});
				Set('_storeCompOldOwnLocal{index}', _storeCompCurOwnLocal{index});
				Set('_storeCompOldOwnRemote{index}', _storeCompCurOwnRemote{index});
				Set('_storeCompOldRecommended{index}', _storeCompCurRecommended{index});
			"			
		/>
	</template>

	<instance name="rCompVarHolder" index="0"/>
	<instance name="rCompVarHolder" index="1"/>
	<instance name="rCompVarHolder" index="2"/>
	<instance name="rCompVarHolder" index="3"/>
	<instance name="rCompVarHolder" index="4"/>
	<instance name="rCompVarHolder" index="5"/>
	<instance name="rCompVarHolder" index="6"/>
	<instance name="rCompVarHolder" index="7"/>
	<instance name="rCompVarHolder" index="8"/>
	<instance name="rCompVarHolder" index="9"/>
	<instance name="rCompVarHolder" index="10"/>
	<instance name="rCompVarHolder" index="11"/>
	<instance name="rCompVarHolder" index="12"/>
	<instance name="rCompVarHolder" index="13"/>
	<instance name="rCompVarHolder" index="14"/>
	<instance name="rCompVarHolder" index="15"/>
	<instance name="rCompVarHolder" index="16"/>
	<instance name="rCompVarHolder" index="17"/>
	<instance name="rCompVarHolder" index="18"/>
	<instance name="rCompVarHolder" index="19"/>
	<instance name="rCompVarHolder" index="20"/>
	<instance name="rCompVarHolder" index="21"/>
	<instance name="rCompVarHolder" index="22"/>
	<instance name="rCompVarHolder" index="23"/>
	<instance name="rCompVarHolder" index="24"/>
	<instance name="rCompVarHolder" index="25"/>
	<instance name="rCompVarHolder" index="26"/>
	<instance name="rCompVarHolder" index="27"/>
	<instance name="rCompVarHolder" index="28"/>
	<instance name="rCompVarHolder" index="29"/>
	<instance name="rCompVarHolder" index="30"/>
	<instance name="rCompVarHolder" index="31"/>
	<instance name="rCompVarHolder" index="32"/>
	<instance name="rCompVarHolder" index="33"/>
	<instance name="rCompVarHolder" index="34"/>
	<instance name="rCompVarHolder" index="35"/>
	<instance name="rCompVarHolder" index="36"/>
	<instance name="rCompVarHolder" index="37"/>
	<instance name="rCompVarHolder" index="38"/>
	<instance name="rCompVarHolder" index="39"/>
	<instance name="rCompVarHolder" index="40"/>
	<instance name="rCompVarHolder" index="41"/>
	<instance name="rCompVarHolder" index="42"/>
	<instance name="rCompVarHolder" index="43"/>
	<instance name="rCompVarHolder" index="44"/>
	<instance name="rCompVarHolder" index="45"/>
	<instance name="rCompVarHolder" index="46"/>
	<instance name="rCompVarHolder" index="47"/>
	<instance name="rCompVarHolder" index="48"/>
	<instance name="rCompVarHolder" index="49"/>
	<instance name="rCompVarHolder" index="50"/>
	<instance name="rCompVarHolder" index="51"/>
	<instance name="rCompVarHolder" index="52"/>
	<instance name="rCompVarHolder" index="53"/>
	<instance name="rCompVarHolder" index="54"/>
	<instance name="rCompVarHolder" index="55"/>
	<instance name="rCompVarHolder" index="56"/>
	<instance name="rCompVarHolder" index="57"/>
	<instance name="rCompVarHolder" index="58"/>
	<instance name="rCompVarHolder" index="59"/>
	<instance name="rCompVarHolder" index="60"/>
	<instance name="rCompVarHolder" index="61"/>
	<instance name="rCompVarHolder" index="62"/>
	<instance name="rCompVarHolder" index="63"/>
	<instance name="rCompVarHolder" index="64"/>
	<instance name="rCompVarHolder" index="65"/>
	<instance name="rCompVarHolder" index="66"/>
	<instance name="rCompVarHolder" index="67"/>
	<instance name="rCompVarHolder" index="68"/>
	<instance name="rCompVarHolder" index="69"/>
	<instance name="rCompVarHolder" index="70"/>
	<instance name="rCompVarHolder" index="71"/>
	<instance name="rCompVarHolder" index="72"/>
	<instance name="rCompVarHolder" index="73"/>
	<instance name="rCompVarHolder" index="74"/>
	<instance name="rCompVarHolder" index="75"/>
	<instance name="rCompVarHolder" index="76"/>
	<instance name="rCompVarHolder" index="77"/>
	<instance name="rCompVarHolder" index="78"/>
	<instance name="rCompVarHolder" index="79"/>
	<instance name="rCompVarHolder" index="80"/>
	<instance name="rCompVarHolder" index="81"/>
	<instance name="rCompVarHolder" index="82"/>
	<instance name="rCompVarHolder" index="83"/>
	<instance name="rCompVarHolder" index="84"/>
	<instance name="rCompVarHolder" index="85"/>
	<instance name="rCompVarHolder" index="86"/>
	<instance name="rCompVarHolder" index="87"/>
	<instance name="rCompVarHolder" index="88"/>
	<instance name="rCompVarHolder" index="89"/>
	<instance name="rCompVarHolder" index="90"/>
	<instance name="rCompVarHolder" index="91"/>
	<instance name="rCompVarHolder" index="92"/>
	<instance name="rCompVarHolder" index="93"/>
	<instance name="rCompVarHolder" index="94"/>
	<instance name="rCompVarHolder" index="95"/>
	<instance name="rCompVarHolder" index="96"/>
	<instance name="rCompVarHolder" index="97"/>
	<instance name="rCompVarHolder" index="98"/>
	<instance name="rCompVarHolder" index="99"/>
	<instance name="rCompVarHolder" index="100"/>
	<instance name="rCompVarHolder" index="101"/>
	<instance name="rCompVarHolder" index="102"/>
	<instance name="rCompVarHolder" index="103"/>
	<instance name="rCompVarHolder" index="104"/>
	<instance name="rCompVarHolder" index="105"/>
	<instance name="rCompVarHolder" index="106"/>
	<instance name="rCompVarHolder" index="107"/>
	<instance name="rCompVarHolder" index="108"/>
	<instance name="rCompVarHolder" index="109"/>
	<instance name="rCompVarHolder" index="110"/>
	<instance name="rCompVarHolder" index="111"/>
	<instance name="rCompVarHolder" index="112"/>
	<instance name="rCompVarHolder" index="113"/>
	<instance name="rCompVarHolder" index="114"/>
	<instance name="rCompVarHolder" index="115"/>
	<instance name="rCompVarHolder" index="116"/>
	<instance name="rCompVarHolder" index="117"/>
	<instance name="rCompVarHolder" index="118"/>
	<instance name="rCompVarHolder" index="119"/>
	<instance name="rCompVarHolder" index="120"/>
	<instance name="rCompVarHolder" index="121"/>
	<instance name="rCompVarHolder" index="122"/>
	<instance name="rCompVarHolder" index="123"/>
	<instance name="rCompVarHolder" index="124"/>
	<instance name="rCompVarHolder" index="125"/>
	<instance name="rCompVarHolder" index="126"/>
	<instance name="rCompVarHolder" index="127"/>
	<instance name="rCompVarHolder" index="128"/>
	<instance name="rCompVarHolder" index="129"/>
	<instance name="rCompVarHolder" index="130"/>
	<instance name="rCompVarHolder" index="131"/>
	<instance name="rCompVarHolder" index="132"/>
	<instance name="rCompVarHolder" index="133"/>
	<instance name="rCompVarHolder" index="134"/>
	<instance name="rCompVarHolder" index="135"/>
	<instance name="rCompVarHolder" index="136"/>
	<instance name="rCompVarHolder" index="137"/>
	<instance name="rCompVarHolder" index="138"/>
	<instance name="rCompVarHolder" index="139"/>

	<template name="boot_tree_item">
	  <panel x="{slideX8=0}" width="8.0h" align="center" noclick="true" visible="false"
		group="boot_tree_items"
		onevent="
			If(
				_storeCompCurValid{itemIndex},
				Split(
					FadeIn(200 * _shopFlag_animSpeedMult),
					If(
						_storeCompCurValid79,
						SlideX('{slideX8=0}', 200 * _shopFlag_animSpeedMult),
						If(
							_storeCompCurValid78,
							SlideX('{slideX7=0}', 200 * _shopFlag_animSpeedMult),
							If(
								_storeCompCurValid77,
								SlideX('{slideX6=0}', 200 * _shopFlag_animSpeedMult),
								If(
									_storeCompCurValid76,
									SlideX('{slideX5=0}', 200 * _shopFlag_animSpeedMult)
								)
							)
						)
					)
				),
				FadeOut(200 * _shopFlag_animSpeedMult)
			);
		"
	  >
	  
		<!-- Icon / Button -->
		<panel x="-0.1h" y="1.6h" width="5.0h" height="5.0h" align="center" valign="top" noclick="true">			
			<instance name="recipe_component_item_icon" index="{itemIndex=0}" groupSuffix="2" bootViewInfo="true"/>
		</panel>
		
		<!-- Frame -->
		<image width="7.0h" height="7.0h" align="center" valign="top" texture="/ui/common/new_shop_interface/boot_frame.tga" noclick="true"/>

		<!-- Cost -->
		<panel grow="true" x="-0.7h" y="6.9h" height="1.75h" align="center" float="right" padding="0.2h" noclick="true" regrow="true" visible="false"
			watch="updateRecipeDisplay"
			ontrigger="
				If(
					!StringEquals(_storeCompCurEntity{itemIndex=0}, _storeCompOldEntity{itemIndex=0}),
					Split(
						FadeOut(200 * _shopFlag_animSpeedMult),
						SleepWidget(200 * _shopFlag_animSpeedMult, 'DoEvent(0);')
					),
					DoEvent(0)
				);
			"
			onevent0="
				If(
					_storeCompCurValid{itemIndex=0},
					FadeIn(200 * _shopFlag_animSpeedMult)
				);
			"
		>
		  <label fitx="true" height="1.75h" color="#FFCC00" shadow="true" font="dyn_10" align="center" noclick="true"
				watch="updateRecipeDisplay"
				ontrigger="
					If(
						!StringEquals(_storeCompCurEntity{itemIndex=0}, _storeCompOldEntity{itemIndex=0}),
						SleepWidget(200 * _shopFlag_animSpeedMult, 'DoEvent(0);'),
						DoEvent(0)
					);
				"
				onevent0="
					If(
						_storeCompCurValid{itemIndex=0},
						SetText(_storeCompCurCost{itemIndex=0})
					);
				"
		  />
		  <panel height="1.75h" width="1.4h" noclick="true">
			  <image texture="/ui/fe2/store/gold_coins.tga" width="100%" height="100@" valign="center" noclick="true"
			/>
		  </panel>
		</panel>
		<!-- Name -->
		<label y="8.4h" fity="true" width="100%" wrap="true" textalign="center" font="dyn_10" color="1 1 1 1" shadow="true" noclick="true"
		watch="updateRecipeDisplay"
		ontrigger="
			If(
				!StringEquals(_storeCompCurEntity{itemIndex=0}, _storeCompOldEntity{itemIndex=0}),
				Split(
					FadeOut(200 * _shopFlag_animSpeedMult),
					SleepWidget(200 * _shopFlag_animSpeedMult, 'DoEvent(0);')
				),
				DoEvent(0)
			);
		"
		onevent0="
			If(
				_storeCompCurValid{itemIndex=0},
				Split(
					SetText(_storeCompCurName{itemIndex=0}),
					FadeIn(200 * _shopFlag_animSpeedMult)
				)
			);
		"
		/>

	  </panel>
	</template> 
	
	<template name="recipe_component_item_widgetstate">
		<widgetstate statename="{statename}" x="{x}" y="{y}">
			<image noclick="true" watch="recipeCompDisplay{groupSuffix}{index}" ontrigger="SetTexture(_storeCompCurTexture{index});" watch1="RecipeExpandedComponents{index}" ontrigger1="If(param25, SetRenderMode('normal'), SetRenderMode('grayscale'));" />
			<piegraph visible="false" start="270" end="-90" square="true" color="#000000cc" watch="RecipeExpandedComponents{index}" ontrigger="SetVisible(param21 gt 0); SetValue(param20);" noclick="true"/>
			<frame color="invisible" borderthickness="1" bordercolor="0 0 0 1" noclick="true"/>

			<panel color="0 0 0 0.6" visible="false" watch="RecipeExpandedComponents{index}" ontrigger="SetVisible(!param25);" noclick="true"/>

			<panel watch="recipeCompDisplay{groupSuffix}{index}" color="0 0 0 1"
				ontrigger="
					SetVisible(_storeCompCurRecipeOverlay{index});
				"
			>
				<image watch="recipeCompDisplay{groupSuffix}{index}" align="center" valign="center" width="-45%" height="-45%" ontrigger="SetTexture(_storeCompCurTexture{index});"	/>
				<image texture="/ui/elements/shop/scroll_overlay.tga"/>
				<frame color="invisible" borderthickness="1" bordercolor=".5 .5 .5 1" />
			</panel>
			<!-- Owned Item Indicator -->
			<frame
				width="-2" height="-2" x="1" y="1"
				borderthickness="0.2h"
				color="invisible"
				watch="RecipeExpandedComponents{index}"
				ontrigger="
				If(
					_storeCompCurOwnLocal{index} or _storeCompCurOwnRemote{index},
					If(
						_storeCompCurOwnLocal{index},
						SetBorderColor('#16e124'),
						SetBorderColor('#ddbb24')
					),
					SetBorderColor('invisible'));
				"
				noclick="1"
			/>
			<image texture="/ui/common/new_shop_interface/stash.tga" x="15%" y="15%" width="55%" height="55%" align="right" valign="bottom" noclick="true" visible="false" watch="RecipeExpandedComponents{index}" ontrigger="SetVisible(_storeCompCurToStash{index});" />
			<image texture="/ui/elements/star.tga" x="-20%" y="-20%" width="45%" height="45%" align="left" valign="top" noclick="true" visible="false" watch="recipeCompDisplay{groupSuffix}{index}" ontrigger="SetVisible(_storeCompCurRecommended{index});" color="1 1 0 1" />
			<label textalign="center" textvalign="center" width="45%" height="45%" align="right" font="dyn_10" shadow="true" color="white" watch="RecipeExpandedComponents{index}" ontrigger="SetText(param19);" noclick="true" />
			<label noclick="1" valign="center" align="center" textvalign="center" textalign="center" color="#87CEEB" shadow="1" font="dyn_11" watch="RecipeExpandedComponents{index}" ontrigger="SetVisible(param21 gt 0); SetText(FtoT(param21, 1, 0, '-'));"/>
			<!-- HotKey used to select this item -->
			<label x="15%" y="2%" width="90%" height="90%" textalign="left" textvalign="top" color="white" outline="true" font="dyn_9" noclick="true" watch="RecipeExpandedComponents{index}" ontrigger="SetText(Translate(param13));" />
		</widgetstate>
	</template>
	<!-- stolen test -->
	<template name="recipe_component_item_icon">
		<button
			visible="false"
			name="RecipeComponentItemIcon{groupSuffix}{index}"
			group="recipeComponentItemIcons{groupSuffix}"
			color="invisible"
			interactive="false"
			onmouseover="
				PlaySound('/shared/sounds/ui/button_over_03.wav');
				TriggerItemTooltip(
					'shopGlobalItemTooltipUpdate',
					_storeCompCurEntity{index},
					_storeCompCurRecipeOverlay{index}
				);
				Trigger('shopGlobalItemTooltipIcon', GetEntityIconPath(_storeCompCurEntity{index}));
				ShowWidget('shopGlobalItemTooltip');
			"
			onmouseout="
				HideWidget('shopGlobalItemTooltip');
			"
			onhide="
				HideWidget('shopGlobalItemTooltip');
			"
			
			onevent0="
				If(
					(
						!_storeCompCurValid{index} or
						(
							!_storeCompFoundMatch{index} and !StringEquals(_storeCompCurEntity{index}, _storeCompOldEntity{index})
						)
					),
					FadeOut(200 * _shopFlag_animSpeedMult)
				);

				If(
					_storeCompCurValid{index} and !_storeCompFoundMatch{index},
					DoEvent(2)
				);
			"
			onevent1="
				If(
					_storeCompFoundMatch{index} and !StringEquals(_storeCompCurEntity{index}, _storeCompOldEntity{index}),
					SetVisible(false)
				);
				
				If(
					_storeCompCurValid{index},
					DoEvent(2)
					
				);
			"
			onevent2="
				Trigger('recipeCompDisplay{groupSuffix}{index}');
				FadeIn(200 * _shopFlag_animSpeedMult);
			"
			onevent3="
				If(
					_storeCompOldValid{index} and !_storeCompFoundMatch{index},
					Trigger(
						'componentPreMatchFound',
						{index},
						GetAbsoluteX(),
						GetAbsoluteY(),
						GetWidth(),
						GetHeight()
					)
				);
			"
			onevent4="
				If(
					(!_storeCompCurValid{index} or !StringEquals(_storeCompCurEntity{index}, _storeCompOldEntity{index})),
					FadeOut(200 * _shopFlag_animSpeedMult)
				);
			"
			onevent5="
				If(
					_storeCompOldValid{index} and !_storeCompFoundMatch{index},
					Trigger(
						'recipeCheckComponentMatch',
						{index},
						GetAbsoluteX(),
						(
							GetYFromString(
								*(
									If(
										{index} gt 71,
										'_buildupGroupTargY',
										'_componentGroupTargY'
									)
									# _storeCompCurRowIndex{index}
								) *1.33
							) +
							component_tree_baseY +
							(
								( component_branch_height - GetHeight() ) / 2
							)
						),
						GetWidth(),
						GetHeight()
					)					
				);
			"
			onevent6="
				Set('_storeCompFoundMatch{index}', false);
			"
			watch="componentPreMatchFound{groupSuffix}"
			ontrigger="
				If(
					_storeCompCurValid{index},
					If(
						StringEquals(*('_storeCompOldEntity' # param0), _storeCompCurEntity{index}) and
						{index} != param0 and
						(
							(
								!*('_storeCompOldRecipeOverlay' # param0) and
								!_storeCompCurRecipeOverlay{index}
							) or
							(
								*('_storeCompOldRecipeOverlay' # param0) and
								_storeCompCurRecipeOverlay{index}
							)
						)
						,
						Split(
							Set('_storeCompFoundMatch{index}', true),
							Trigger(
								'instantiateRecipeTransition',
								param0,
								param1,
								param2,
								param3,
								param4,
								{index},
								GetAbsoluteX(),
								(
									GetYFromString(
										*(
											If(
												{index} gt 71,
												'_buildupGroupTargY',
												'_componentGroupTargY'
											)
											# _storeCompCurRowIndex{index}
										) *1.33
									) +
									component_tree_baseY +
									(
										( component_branch_height - GetHeight() ) / 2
									)
								),
								GetWidth(),
								GetHeight()
							)
						)
					)
				);
			"
			watch1="recipeFindMatch{groupSuffix}"
			ontrigger1="
				If(
					!_storeRecipeFoundMatch and _storeCompCurValid{index},
					If(
						StringEquals(_storeCompCurEntity{index}, _storeRecipeOldEntity),
						Split(
							Set('_storeRecipeFoundMatch', true),
							Trigger(
								'InstantiateRecipeIconTrans',
								'recipeItem',
								'',
								param0,
								param1,
								param2,
								param3,
								'RecipeExpandedComponents',
								{index},
								GetAbsoluteX(),
								(
									GetYFromString(
										*(
											If(
												{index} gt 71,
												'_buildupGroupTargY',
												'_componentGroupTargY'
											)
											# _storeCompCurRowIndex{index}
										) *1.33
									) +
									component_tree_baseY +
									(
										( component_branch_height - GetHeight() ) / 2
									)
								),
								GetWidth(),
								GetHeight()
							)
						)
					)
				);
			"
			onclick="
				if(!switchLMB_RMB,
					Split(
						PlaySound('/shared/sounds/ui/button_click_03.wav'),
						Set('_shopNewRecipeTarget', _storeCompCurEntity{index}),
						Set('_recipeTransitionMode', 1),
						Trigger('shopComponentAnimStep0')
					),
					Split(
						PlaySound('/shared/sounds/ui/button_click_03.wav'),
						If(
							!StringEquals(_storeCompCurEntity{index}, GetActiveRecipe()),
							If(
								_storeCompCurIsRecipe{index} and !_storeCompCurRecipeOverlay{index},
								Split(
									Set('_lastSelectedItemEntity', _storeCompCurEntity{index}),
									Trigger(
										'shopBuyRemainingInfo',
										_storeCompCurName{index},
										_storeCompCurDesc{index},
										_storeCompCurTexture{index}							
									),
									CallEvent('purchase_components_popup', 0)
								)
								##PurchaseRemainingComponents(_storeCompCurEntity{index})		##				
								,
								PurchaseByName(_storeCompCurEntity{index})
							),
							PurchaseByName(_storeCompCurEntity{index})
						)
					)
				);
			"
			onrightclick="
				if(switchLMB_RMB,
					Split(
						PlaySound('/shared/sounds/ui/button_click_03.wav'),
						Set('_shopNewRecipeTarget', _storeCompCurEntity{index}),
						Set('_recipeTransitionMode', 1),
						Trigger('shopComponentAnimStep0')
					),
					Split(
						PlaySound('/shared/sounds/ui/button_click_03.wav'),
						If(
							!StringEquals(_storeCompCurEntity{index}, GetActiveRecipe()),
							If(
								_storeCompCurIsRecipe{index} and !_storeCompCurRecipeOverlay{index},
								Split(
									Set('_lastSelectedItemEntity', _storeCompCurEntity{index}),
									Trigger(
										'shopBuyRemainingInfo',
										_storeCompCurName{index},
										_storeCompCurDesc{index},
										_storeCompCurTexture{index}							
									),
									CallEvent('purchase_components_popup', 0)
								)
								##PurchaseRemainingComponents(_storeCompCurEntity{index})		##				
								,
								PurchaseByName(_storeCompCurEntity{index})
							),
							PurchaseByName(_storeCompCurEntity{index})
						)
					)
				);
			"
		>
			<instance name="recipe_component_item_widgetstate" groupSuffix="{groupSuffix}" index="{index}" statename="up"/>
			<instance name="recipe_component_item_widgetstate" groupSuffix="{groupSuffix}" index="{index}" statename="over" color="1 1 0 1"/>
			<instance name="recipe_component_item_widgetstate" groupSuffix="{groupSuffix}" index="{index}" statename="down" x="1" y="1"/>
			<instance name="recipe_component_item_widgetstate" groupSuffix="{groupSuffix}" index="{index}" statename="disabled"/>
		</button>
	</template>

	<template name="shop_btn_closex">
		<button
			x="{x}" y="{y}" width="{width}" height="{height}" align="{align}" valign="{valign}"
			color="invisible" visible="true"
			name="{button_name}"
			onmouseover="PlaySound('/shared/sounds/ui/button_over_03.wav'); ShowWidget('{tip_id=shop_close_shop}');"
			onmouseout="HideWidget('{tip_id=shop_close_shop}');"
			interactive="false"
			onclick="
				PlaySound('/shared/sounds/ui/button_click_03.wav');
				{onclick}
			"
		>
			<instance name="shop_btn_closex_state" statename="up" color="#910000"/>
			<instance name="shop_btn_closex_state" statename="over" color="#dc0000" xcolor="1 1 1 1" />
			<instance name="shop_btn_closex_state" statename="down" x="1" y="1" xcolor="1 1 1 1" />
			<instance name="shop_btn_closex_state" statename="disabled" color="#777777"/>
		</button>
	</template>

	<template name="shop_btn_closex_state">
		<widgetstate statename="{statename}" x="{x}" y="{y}">
		<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.5h" color="{color=#910000}" blockinput="false" noclick="true"/>
		<frame texture="/ui/frames/roundframe.tga" color="0 0 0 1" borderthickness="0.5h" blockinput="false" noclick="true"/>
		<image width="1.3h" height="1.3h" align="center" valign="center" color="{xcolor=.75 .75 .75 1}" texture="/ui/elements/closex.tga" noclick="true" />
	</widgetstate>
	</template>
	
	<!-- Item quickslots -->
	<template name="menu_items_quickslot">
		<panel x="0" y="0" noclick="1" float="right" height="3.5h" width="100%" align="left" valign="top" name="{id}" >
			<frame bordercolor="black" borderthickness="1" height="100%" width="100@" noclick="1" color="black" valign="center" >
				<instance name="shop_quickslot" item="Item_RunesOfTheBlight" panel="5" id="1" /> 
			</frame>
			<frame bordercolor="black" borderthickness="1" height="100%" width="100@" noclick="1" color="black" valign="center" >
				<instance name="shop_quickslot" item="Item_HomecomingStone" panel="5" id="2" /> 
			</frame>
			<frame bordercolor="black" borderthickness="1" height="100%" width="100@" noclick="1" color="black" valign="center" >
				<instance name="shop_quickslot" item="Item_ManaPotion" panel="5" id="3" /> 
			</frame>
			<frame bordercolor="black" borderthickness="1" height="100%" width="100@" noclick="1" color="black" valign="center" >
				<instance name="shop_quickslot" item="Item_HealthPotion" panel="5" id="4" /> 
			</frame>
			<frame bordercolor="black" borderthickness="1" height="100%" width="100@" noclick="1" color="black" valign="center" >
				<instance name="shop_quickslot" item="Item_FlamingEye" panel="5" id="5" /> 
			</frame>			
		</panel>
	</template>
	
	<template name="menu_items_primary">
		<instance name="menu_item" icon="/items/shops/shop_recommended.tga" bgColor="#2e180d" bgHover="#402212" bordercolor2="#74341b" slot="11" showClose="true" shopname="Shop_Recommended" label="game_shop_label_recommended" tip_id="shop_cat_tip11" group="menuItemCategories" slideIndex="0" />
	</template>

	<template name="menu_items_basic">
		<instance name="menu_item" icon="/items/shops/shop_supplies.tga" bgColor="#112016" bgHover="#1d3826" bordercolor2="#265f3a" slot="3" showClose="true" shopname="Shop_Supplies" label="game_shop_label_supplies" tip_id="shop_cat_tip3" group="menuItemCategories" slideIndex="1" />
		<instance name="menu_item" icon="/items/shops/shop_accessories.tga" bgColor="#112016" bgHover="#1d3826" bordercolor2="#265f3a" slot="0" showClose="true" shopname="Shop_Accessories" label="game_shop_label_accessories" tip_id="shop_cat_tip0" group="menuItemCategories" slideIndex="2" />
		<instance name="menu_item" icon="/items/shops/shop_weapons.tga" bgColor="#112016" bgHover="#1d3826" bordercolor2="#265f3a" slot="1" showClose="true" shopname="Shop_Weapons" label="game_shop_label_weapons" tip_id="shop_cat_tip1" group="menuItemCategories" slideIndex="3" />
		<instance name="menu_item" icon="/items/shops/shop_relics.tga" bgColor="#112016" bgHover="#1d3826" bordercolor2="#265f3a" slot="2" showClose="true" shopname="Shop_Relics" label="game_shop_label_relics" tip_id="shop_cat_tip2" group="menuItemCategories" slideIndex="4" />		
		<instance name="menu_item" icon="/items/shops/shop_secret.tga" bgColor="#112016" bgHover="#1d3826" bordercolor2="#265f3a" slot="4" showClose="true" shopname="Shop_Secret" label="game_shop_label_legendary" tip_id="shop_cat_tip4" group="menuItemCategories" slideIndex="5" />		
	</template>

	<template name="menu_items_recipes">
		<instance name="menu_item" icon="/items/shops/shop_recipes1.tga" bgColor="#101d23" bgHover="#192e37" bordercolor2="#25586f" slot="5" showClose="true" shopname="Shop_Recipes1" label="game_shop_label_recipe_one" tip_id="shop_cat_tip5" group="menuItemCategories" slideIndex="6" />
		<instance name="menu_item" icon="/items/shops/shop_recipes2.tga" bgColor="#101d23" bgHover="#192e37" bordercolor2="#25586f" slot="6" showClose="true" shopname="Shop_Recipes2" label="game_shop_label_recipe_two" tip_id="shop_cat_tip6" group="menuItemCategories" slideIndex="7" />
		<instance name="menu_item" icon="/items/shops/shop_recipes3.tga" bgColor="#101d23" bgHover="#192e37" bordercolor2="#25586f" slot="7" showClose="true" shopname="Shop_Recipes3" label="game_shop_label_recipe_three" tip_id="shop_cat_tip7" group="menuItemCategories" slideIndex="8" />
		<instance name="menu_item" icon="/items/shops/shop_recipes4.tga" bgColor="#101d23" bgHover="#192e37" bordercolor2="#25586f" slot="8" showClose="true" shopname="Shop_Recipes4" label="game_shop_label_recipe_four" tip_id="shop_cat_tip8" group="menuItemCategories" slideIndex="9" />
		<instance name="menu_item" icon="/items/shops/shop_recipes5.tga" bgColor="#101d23" bgHover="#192e37" bordercolor2="#25586f" slot="9" showClose="true" shopname="Shop_Recipes5" label="game_shop_label_recipe_five" tip_id="shop_cat_tip9" group="menuItemCategories" slideIndex="10" />
	</template>

	<template name="menu_items_extra">
		<instance name="menu_item" icon="/items/shops/shop_outpost.tga" slot="10" showClose="true" shopname="Shop_Outpost" label="game_shop_label_recipe_outpost" tip_id="shop_cat_tip10" group="menuItemCategories" slideIndex="12" />
	</template>
	
	<template name="menu_filters_0">
		<instance name="menu_item" icon="/items/shops/shop_recommended.tga" bgColor="#2e180d" bgHover="#402212" bordercolor2="#74341b" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_recommended" tip_id="shop_cat_tip11" group="menuItemFilters" slideIndex="0" visible="false" x="110%" filterName="Filter_Recommended" filter="true" />
	</template>

	<template name="menu_filters_1">
		<instance name="menu_item" icon="/items/shops/filter_consumables.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_consumables" tip_id="shop_cat_tip12" group="menuItemFilters" slideIndex="1" visible="false" x="110%" filterName="Filter_Consumable" filter="true" />
	</template>

	<template name="menu_filters_2">
		<instance name="menu_item" icon="/items/shops/filter_mobility.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_mobility" tip_id="shop_cat_tip13" group="menuItemFilters" slideIndex="2" visible="false" x="110%" filterName="Filter_Mobility" filter="true" />
		<instance name="menu_item" icon="/items/shops/filter_attackspeed.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_attack_speed" tip_id="shop_cat_tip14" group="menuItemFilters" slideIndex="3" visible="false" x="110%" filterName="Filter_AttackSpeed" filter="true" />
		<instance name="menu_item" icon="/items/shops/filter_damage.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_damage" tip_id="shop_cat_tip15" group="menuItemFilters" slideIndex="4" visible="false" x="110%" filterName="Filter_Damage" filter="true" />
		<instance name="menu_item" icon="/items/shops/filter_armor.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_armor" tip_id="shop_cat_tip16" group="menuItemFilters" slideIndex="5" visible="false" x="110%" filterName="Filter_Armor" filter="true" />
	</template>

	<template name="menu_filters_3">
		<instance name="menu_item" icon="/items/shops/filter_regen.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_regeneration" tip_id="shop_cat_tip17" group="menuItemFilters" slideIndex="6" visible="false" x="110%" filterName="Filter_Regeneration" filter="true" />
		<instance name="menu_item" icon="/items/shops/filter_agi.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_agi" tip_id="shop_cat_tip18" group="menuItemFilters" slideIndex="7" visible="false" x="110%" filterName="Filter_Agility" filter="true" />
		<instance name="menu_item" icon="/items/shops/filter_str.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_str" tip_id="shop_cat_tip19" group="menuItemFilters" slideIndex="8" visible="false" x="110%" filterName="Filter_Strength" filter="true" />
		<instance name="menu_item" icon="/items/shops/filter_int.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_int" tip_id="shop_cat_tip20" group="menuItemFilters" slideIndex="9" visible="false" x="110%" filterName="Filter_Intelligence" filter="true" />
	</template>

	<template name="menu_filters_4">
		<instance name="menu_item" icon="/items/shops/filter_booster.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_booster" tip_id="shop_cat_tip21" group="menuItemFilters" slideIndex="10" visible="false" x="110%" filterName="Filter_Booster" filter="true" />
		<instance name="menu_item" icon="/items/shops/filter_activate.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_activatable" tip_id="shop_cat_tip22" group="menuItemFilters" slideIndex="11" visible="false" x="110%" filterName="Filter_Activatable" filter="true" />
		<instance name="menu_item" icon="/items/shops/filter_modifier.tga" slot="" showClose="true" shopname="" height="2.9h" label="game_shop_label_modifier" tip_id="shop_cat_tip23" group="menuItemFilters" slideIndex="12" visible="false" x="110%" filterName="Filter_Modifier" filter="true" />
	</template>
	
	<!-- Category Holder -->
	<template name="category_holder">
		<panel
			grow="true"
			width="100%"
			noclick="true"
		>
			<panel x="-0.5h" grow="true" width="19.0h" align="right" noclick="true">
				<panel width="-0.6h" height="-0.6h" align="center" valign="center" color="#181b19" noclick="true"
					watch="storeAlphaUpdate"
					ontrigger="
						SetColor('0.093 0.105 0.097 ' # (0.35 + (param * 0.0065)));
					"
				/>
				<panel y="{y=0.7h}" grow="true" width="-1.4h" align="center" float="bottom" padding="0.2h">
					<instance name="{menu_items}"/>
					<panel width="100%" height="0.5h" noclick="true" />
				</panel>
				<frame texture="/ui/common/new_shop_interface/cat_holder2.tga" borderthickness="1.8h" color="#52646e" blockinput="false" noclick="true"
					watch="storeAlphaUpdate"
					ontrigger="
						SetColor('0.32 0.39 0.43 ' # (param / 100));
						SetBorderColor('0.32 0.39 0.43 ' # (param / 100));
					"
				/>
			</panel>
		</panel>
	</template>

	<panel noclick="true" color="invisible"
		watch="MaxShopItems"
		ontrigger="
			If(
				param,
				For(
					0, param - 1, 1,
					'
						If(
							!WidgetExists(\'shop_v4_item_helper\' # iParam),
							Instantiate(
								\'shop_v4_item_trigger\',
								\'index\',
								iParam
							)
						);
					'
				)
			);
		"
	/>

	<template name="shop_v4_item_trigger">
		<panel noclick="true" color="invisible"
			name="shop_v4_item_helper{index}"
			oninstantiate="
				CreateBool('_storeItemCurValid{index}', false);
				CreateString('_storeItemCurEntity{index}', '');
				CreateString('_storeItemCurTexture{index}', '');
				CreateBool('_storeItemCurIsRecipe{index}', false);
				CreateBool('_storeItemCurRecipeOverlay{index}', false);
				CreateBool('_storeItemCurAvailable{index}', false);
				CreateBool('_storeItemCurToStash{index}', false);
				CreateBool('_storeItemCurOwnLocal{index}', false);
				CreateBool('_storeItemCurOwnRemote{index}', false);
				CreateBool('_storeItemCurRecommended{index}', false);
				CreateString('_storeItemCurName{index}', false);
				CreateString('_storeItemCurDescription{index}', false);
				CreateInt('_storeItemCurCost{index}', false);
				CreateBool('_storeItemCurNew{index}', false);
				CreateInt('_itemSlotWatch{index}', {index});
			"
			watch="ShopItemParam{index}"
			ontrigger="
				Set('_storeItemCurValid{index}', param0);
			"
			watch1="ShopItem{index}"
			ontrigger1="
				Set('_storeItemCurTexture{index}', param3);
				Set('_storeItemCurEntity{index}', param28);
				Set('_storeItemCurIsRecipe{index}', param8);
				Set('_storeItemCurRecipeOverlay{index}', param29);
				Set('_storeItemCurAvailable{index}', param25);
				Set('_storeItemCurRecommended{index}', param27);
				Set('_storeItemCurToStash{index}', param15);
				Set('_storeItemCurOwnLocal{index}', param11);
				Set('_storeItemCurOwnRemote{index}', param26);
				Set('_storeItemCurName{index}', param1);
				Set('_storeItemCurDescription{index}', param2);
				Set('_storeItemCurCost{index}', param4);
				Set('_storeItemCurNew{index}', param23);
			"
		/>
	</template><!--  name="ShopComponentRecipeIcon" -->

	<template name="shop_recipe_item_button_state">
		<widgetstate statename="{statename}" x="{x}" y="{y}">
			<image watch="updateRecipeDisplay" ontrigger="SetTexture(_storeRecipeCurTexture);" watch1="RecipeItem" ontrigger1="If(!param25, SetRenderMode('grayscale'), SetRenderMode('normal'));" />
			<piegraph start="270" end="-90" square="true" color="#000000cc" watch="RecipeItem" ontrigger="SetVisible(param21 gt 0); SetValue(param20);" noclick="true"/>
			<panel color="#404040" rendermode="overlay" watch="updateRecipeDisplay" ontrigger="SetVisible(!_storeRecipeCurAvailable);" noclick="true" watch1="RecipeItem" ontrigger1="SetVisible(!param25);"/>
			<frame color="invisible" borderthickness="2" bordercolor="yellow" noclick="true" />
			<image texture="/ui/common/new_shop_interface/stash.tga" x="0.3h" y="0.3h" width="2.2h" height="2.2h" align="right" valign="bottom" noclick="true" visible="false" watch="RecipeItem" ontrigger="SetVisible(_storeRecipeCurToStash);" />
			<image texture="/ui/elements/star.tga" x="-1.1h" y="-1.1h" width="2.2h" height="2.2h" align="left" valign="top" noclick="true" visible="false" watch="RecipeItem" ontrigger="SetVisible(_storeRecipeCurRecommended);" color="1 1 0 1" />
			<label textalign="center" textvalign="center" width="1.5h" height="1.5h" align="right" font="dyn_10" shadow="true" color="white" watch="RecipeItem" ontrigger="SetText(param19);" noclick="true" />
			<label noclick="1" valign="center" align="center" textvalign="center" textalign="center" color="#87CEEB" shadow="1" font="dyn_11" watch="RecipeItem" ontrigger="SetVisible(param21 gt 0); SetText(FtoT(param21, 1, 0, '-'));"/>
		</widgetstate>
	</template>

	<template name="shop_recipe_item_button">	
		<button
			interactive="false"
			color="invisible"
			name="shopActiveRecipeButton"
			onload="
				
				CreateString('_storeRecipeCurEntity', '');
				CreateString('_storeRecipeCurTexture', '');
				CreateBool('_storeRecipeCurIsRecipe', false);
				CreateBool('_storeRecipeCurRecipeOverlay', false);
				CreateBool('_storeRecipeCurAvailable', false);
				CreateBool('_storeRecipeCurToStash', false);
				CreateBool('_storeRecipeCurOwnLocal', false);
				CreateBool('_storeRecipeCurOwnRemote', false);
				CreateBool('_storeRecipeCurRecommended', false);
				
				CreateString('_storeRecipeOldEntity', '');
				CreateString('_storeRecipeOldTexture', '');
				CreateBool('_storeRecipeOldIsRecipe', false);
				CreateBool('_storeRecipeOldRecipeOverlay', false);
				CreateBool('_storeRecipeOldAvailable', false);
				CreateBool('_storeRecipeOldToStash', false);
				CreateBool('_storeRecipeOldOwnLocal', false);
				CreateBool('_storeRecipeOldOwnRemote', false);
				CreateBool('_storeRecipeOldRecommended', false);
				
				CreateString('_storeRecipeCurTitle', '');
				CreateString('_storeRecipeCurDesc', '');
				CreateInt('_storeRecipeCurCost', '');
				
				CreateBool('_storeRecipeFoundMatch', false);
			"
			watch="RecipeItem"
			ontrigger="
				Set('_storeRecipeCurTexture', param3);
				Set('_storeRecipeCurEntity', param28);
				Set('_storeRecipeCurIsRecipe', param8);
				Set('_storeRecipeCurRecipeOverlay', param29);
				Set('_storeRecipeCurAvailable', param25);
				Set('_storeRecipeCurRecommended', param27);
				Set('_storeRecipeCurToStash', param15);
				Set('_storeRecipeCurOwnLocal', param11);
				Set('_storeRecipeCurOwnRemote', param26);
				Set('_storeRecipeCurTitle', param1);
				Set('_storeRecipeCurDesc', param2);
				Set('_storeRecipeCurCost', param5);
			
			CreateString('string_originalLMB',
					'DoEvent(1);' #
					If(
						param8,
						'
							
							Set(\'_lastSelectedItemEntity\', \'' # param28 # '\');
							Trigger(
								\'shopBuyRemainingInfo\',
								\'' # EscapeString(param1) # '\',
								\'' # EscapeString(param2) # '\',
								\'' # param3 # '\'
							);
							CallEvent(\'purchase_components_popup\', 0);
							
							##PurchaseRemainingComponents(\'' # param28 # '\')##
						',
						'PurchaseByName(\'' # param28 # '\');'
					)
			);
			
			
			
			if(switchLMB_RMB,
				Split(
				SetOnClick(string_originalLMB),
				SetOnRightClick('')
				),
				Split(
				SetOnRightClick(string_originalLMB),
				SetOnClick('')
				)
			);
			"
			watch1="recipeCheckComponentMatch"
			ontrigger1="
				If(
					StringEquals(*('_storeCompOldEntity' # param0), _storeRecipeCurEntity)
					and !*('_storeCompFoundMatch' # param0)
					and !*('_storeCompOldRecipeOverlay' # param0)
					,
					Split(
						Set('_storeCompFoundMatch' # param0, true),
						Trigger(
							'InstantiateRecipeIconTrans',
							'RecipeExpandedComponents',
							param0,
							param1,
							param2,
							param3,
							param4,
							'RecipeItem',
							'',
							GetAbsoluteX(),
							GetAbsoluteY(),
							GetWidth(),
							GetHeight()
						)
						
					)
				);
			

			"
			onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav');
				Trigger('shopGlobalItemTooltipIcon', _storeRecipeCurTexture);
				ShowWidget('recipe_item_tooltip');
			"
			onmouseout="
				HideWidget('recipe_item_tooltip');
			"
			onevent1="
				PlaySound('/shared/sounds/ui/button_click_03.wav');
			"
			onevent2="
				Set('_storeRecipeFoundMatch', false);
				Trigger(
					'recipeFindMatch',
					GetAbsoluteX(),
					GetAbsoluteY(),
					GetWidth(),
					GetHeight()
				);
			"
			onevent3="
				Set('_storeRecipeOldEntity', _storeRecipeCurEntity);
				Set('_storeRecipeOldTexture', _storeRecipeCurTexture);
				Set('_storeRecipeOldIsRecipe', _storeRecipeCurIsRecipe);
				Set('_storeRecipeOldRecipeOverlay', _storeRecipeCurRecipeOverlay);
				Set('_storeRecipeOldAvailable', _storeRecipeCurAvailable);
				Set('_storeRecipeOldToStash', _storeRecipeCurToStash);
				Set('_storeRecipeOldOwnLocal', _storeRecipeCurOwnLocal);
				Set('_storeRecipeOldOwnRemote', _storeRecipeCurOwnRemote);
				Set('_storeRecipeOldRecommended', _storeRecipeCurRecommended);
			"
			 group="activeRecipeGroup" onevent4="If(!StringEquals(_storeRecipeCurEntity, _storeRecipeOldEntity), FadeOut(200 * _shopFlag_animSpeedMult));" onevent5="FadeIn(200 * _shopFlag_animSpeedMult);"
			onmouserdown="SetX(1); SetY(1);"
			onmouserup="SetX(-1); SetY(-1);"			
		>
			<instance name="shop_recipe_item_button_state" statename="up"/>
			<instance name="shop_recipe_item_button_state" statename="over"/>
			<!-- <instance name="shop_recipe_item_button_state" statename="down" x="1" y="1" /> -->
		</button>
	</template>


	<template name="store_v4_item2_widgetstate">
		<widgetstate statename="{statename}" x="{x}" y="{y}">
			<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="{item_bgcolor=0 0 .03 .7}" blockinput="false" noclick="true" watch="updateShopItem{index}" ontrigger="SetVisible(!*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));"
				watch1="updateShopItemAlpha{index}"
				ontrigger1="
					If(
						{overState=false},
						Split(
							SetColor('0 0.25 0.086 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0.25 0.086 ' # (0.1 + (shopAlphaValue * 0.006)))
						),
						Split(
							SetColor('0 0 0.03 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0 0.03 ' # (0.1 + (shopAlphaValue * 0.006)))
						)
					);
				"
			/>
			<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="{recipe_bgcolor=.03 0 0 .7}" visible="false" watch="updateShopItem{index}" ontrigger="SetVisible(*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));" blockinput="false" noclick="true"
				watch1="updateShopItemAlpha{index}"
				ontrigger1="
					If(
						{overState=false},
						Split(
							SetColor('0 0.18 0.27 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0.18 0.27 ' # (0.1 + (shopAlphaValue * 0.006)))
						),
						Split(
							SetColor('0.03 0 0 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0.03 0 0 ' # (0.1 + (shopAlphaValue * 0.006)))
						)
					);
				"
			/>			
			<frame texture="/ui/frames/roundframe.tga" color="{item_bordercolor=0 0 0 1}" borderthickness="0.4h" blockinput="false" noclick="true" watch="updateShopItem{index}" ontrigger="SetVisible(!*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));"
				watch1="updateShopItemAlpha{index}"
				ontrigger1="
					If(
						{overState=false},
						Split(
							SetColor('0 0.1 0.054 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0.1 0.054 ' # (0.1 + (shopAlphaValue * 0.006)))
						),
						Split(
							SetColor('0 0 0 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0 0 ' # (0.1 + (shopAlphaValue * 0.006)))
						)
					);
				"
			/>
			<frame texture="/ui/frames/roundframe.tga" color="{recipe_bordercolor=0 0 0 1}" borderthickness="0.4h" blockinput="false" noclick="true" visible="false" watch="updateShopItem{index}" ontrigger="SetVisible(*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));"
				watch1="updateShopItemAlpha{index}"
				ontrigger1="
					If(
						{overState=false},
						Split(
							SetColor('0 0.67 1.0 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0.67 1.0 ' # (0.1 + (shopAlphaValue * 0.006)))
						),
						Split(
							SetColor('0 0 0 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0 0 ' # (0.1 + (shopAlphaValue * 0.006)))
						)
					);
				"
			/>			
			<panel y="0.4h" width="-0.8h" height="-0.4h" align="center" float="bottom" padding="0.4h" noclick="true">
				<!-- Name/Cost -->
				<panel height="1.9h" noclick="true">
					<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.3h" style="item_header" blockinput="false" noclick="true" watch="updateShopItem{index}" ontrigger="SetVisible(!*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));"
						watch1="updateShopItemAlpha{index}"
						ontrigger1="
							SetBorderColor('0.01 0.56 0.19 ' # (0.25 + (shopAlphaValue * 0.0075)));
							SetColor('0.01 0.56 0.19 ' # (0.25 + (shopAlphaValue * 0.0075)));
						"
					/>
					<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.3h" style="recipe_header" visible="false" watch="updateShopItem{index}" ontrigger="SetVisible(*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));" blockinput="false" noclick="true"
						watch1="updateShopItemAlpha{index}"
						ontrigger1="
							SetBorderColor('0.01 0.39 0.56 ' # (0.25 + (shopAlphaValue * 0.0075)));
							SetColor('0.01 0.39 0.56 ' # (0.25 + (shopAlphaValue * 0.0075)));
						"
					/>
					<frame texture="/ui/frames/roundframe.tga" color="0 0 0 1" borderthickness="0.3h" blockinput="false" noclick="true"/>
					<image texture="/ui/elements/star.tga" x="-0.7h" y="-0.7h" width="1.4h" height="1.4h" align="left" valign="top" noclick="true" visible="false" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('updateShopItem' # param);" watch="updateShopItem{index}" ontrigger="SetVisible(*('_storeItemCurRecommended' # _itemSlotWatch{index}));" color="1 1 0 1" />
					<label x="0.3h" font="dyn_10" color="1 1 1 1" shadow="true" textvalign="center" noclick="true" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('updateShopItem' # param);" watch="updateShopItem{index}" ontrigger="SetText(*('_storeItemCurName' # _itemSlotWatch{index}));" />
					<label x="-1.5h" font="dyn_10" color="1 1 0 1" shadow="true" textvalign="center" textalign="right" noclick="true" watch="ShopItem{index}" ontrigger="SetText(param4);" />
					<image texture="/ui/fe2/store/gold_coins.tga" x="-0.2h" y="-0.1h" width="1.2h" height="1.2h" valign="center" align="right" />
				</panel>
				<panel height="4.6h" noclick="true">
					<!-- Icon -->
					<panel width="4.2h" height="4.2h" valign="center" noclick="true" x="-1"
						watch="ShopItem{index}" ontrigger="If(param6 and !(param8 and param17 and !param18) and param25, SetRenderMode('normal'), SetRenderMode('grayscale'));" 
					>						
						<image noclick="true" watch1="updateShopItem{index}" ontrigger1="SetTexture(*('_storeItemCurTexture' # _itemSlotWatch{index}));"  
								group="shop_item_jiggler_{index}" 
								ontrigger="
								  SetRotation(Sin(((param % 300) / 300) * (3.14159265 * 2)) * 8);
								  "						
						/>
						<piegraph start="270" end="-90" square="true" color="#000000cc" watch="ShopItem{index}" ontrigger="SetVisible(param21 gt 0); SetValue(param20);" noclick="true"/>
						<frame color="invisible" borderthickness="1" bordercolor="0 0 0 1" noclick="true"/>
						<panel color="0 0 0 0.6" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetVisible(!(param6 and !(param8 and param17 and !param18)) or !param25);" noclick="true"/>
						<frame
							borderthickness="4"
							bordercolor="yellow"
							color="invisible"
							visible="false"
							watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('RecipeItemType ShopItem' # param);"
							watch="RecipeItemType ShopItemType{index}"
							ontrigger="SetVisible(StringEquals(RecipeItemType, ShopItemType{index}));"
							noclick="true"
							passivechildren="true"
						>
							<image x="3" y="3" width="-6" height="-6" color="yellow" texture="/ui/fps/selected.tga" rendermode="additive"/>
						</frame>
						<!-- Recipe Scroll -->
						<panel color="black" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetVisible(param8 and !param17 and !param18);" noclick="1">
							<image
								width="55%" height="55%"
								align="center" valign="center"
								 watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);"
								watch="ShopItem{index}"
								ontrigger="SetTexture(param3);
									If(param6, SetRenderMode('normal'), SetRenderMode('grayscale'));
									If(param8 and param12, SetRenderMode('normal'));"
							/>
							<image
								texture="/ui/elements/shop/scroll_overlay.tga"
								watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);"
								watch="ShopItem{index}"
								ontrigger="If(param6, SetRenderMode('normal'), SetRenderMode('grayscale'));
									If(param8 and param12, SetRenderMode('normal'));"
							/>
						</panel>
						<image texture="/ui/common/new_shop_interface/stash.tga" x="0.3h" y="0.3h" width="2.2h" height="2.2h" align="right" valign="bottom" noclick="true" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetVisible(param15 and !param16 and !param17 and !param18);" />
						<label textalign="center" textvalign="center" width="1.5h" height="1.5h" color="white" shadow="true" font="dyn_11" noclick="true" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetText(Translate(param13));" />
						<label textalign="center" textvalign="center" width="1.5h" height="1.5h" align="right" font="dyn_10" shadow="true" color="white" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetText(param19);" noclick="true" />
						<label noclick="1" valign="center" align="center" textvalign="center" textalign="center" color="#87CEEB" shadow="1" font="dyn_11" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetVisible(param21 gt 0); SetText(FtoT(param21, 1, 0, '-'));"/>
						<image
							width="50%" height="50%"
							align="right" valign="top"
							texture="/ui/elements/shop/new.tga"
							watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('updateShopItem' # param);"
							watch="updateShopItem{index}"
							ontrigger="SetVisible(*('_storeItemCurNew' # _itemSlotWatch{index}));"
							noclick="true"
						/>
						<frame width="+2" height="+2" noclick="1" color="invisible" bordercolor="yellow" borderthickness="2" visible="0" 
							watch1="QuickItemBorder" ontrigger1="If(param0 == {index} and param1 == -2, Split(SetVisible(1), SetBorderColor('1 1 0 1')), SetVisible(0));"
						/>	
					</panel>
					<!-- Description -->
					<panel width="-4.5h" align="right" noclick="true">
						<label font="dyn_9" color="1 1 1 1" shadow="true" wrap="true" content="{descrip}" noclick="true" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('updateShopItem' # param);" watch="updateShopItem{index}" ontrigger="SetText(*('_storeItemCurDescription' # _itemSlotWatch{index}));" />
					</panel>
				</panel>
			</panel>
		</widgetstate>
	</template>
	
	<template name="shop_v4_item2">
		<panel noclick="true" color="invisible"
			width="24.4h" height="7.82h"
			name="shop_v4_item2{index}"
			group="shop_v4_items"
			visible="false"
			onload="
				SetX(
					(
						24.5 * ({index} % 3)
					) # 'h'
				);
				
				SetY(
					(
						7.9 * Floor({index} / 3)
					) # 'h'
				);
				If(
					!StringEmpty('{reportRowY}'),
					CreateInt('_shopItemRowY{reportRowY}', GetY())
				);
				
			"
			onevent0="
				## Update Y position on visibility ##
				SetY(
					*('_shopItemRowY' # Ceil(((({index} - _shopScrollMinID) + 1) / 3) - 1))
				);
			"
			onevent1="
				## Simple staggered fade in ##
				
				If(
					_storeItemCurValid{index} and {index} ge _shopScrollMinID and {index} le _shopScrollMaxID,
					SleepWidget(
						3 * {index} * _shopFlag_animSpeedMult,
						'
							DoEvent(0);
							DoEvent(2);
							FadeIn(100 * _shopFlag_animSpeedMult);
						'
					)
				);
			"
			onevent2="
				## Populate the item's widgetstate with new data ##
				Trigger('updateShopItem{index}');
				Trigger('updateShopItemAlpha{index}');
			"
			onevent3="
				## Instant visibility ##
				If(
					_storeItemCurValid{index} and {index} ge _shopScrollMinID and {index} le _shopScrollMaxID,
					Split(
						DoEvent(0),
						DoEvent(2),
						If(
							!IsVisibleSelf(),
							SetVisible(true)
						)
					),
					If(
						IsVisibleSelf(),
						SetVisible(false)
					)
				);

			"
			onevent4="
				## Active to active switch (if the minimum item in the scroll range is visible) ##
				DoEvent(5);
				SleepWidget(
					75 * _shopFlag_animSpeedMult,
					'DoEvent(1);'
				);
			"
			onevent5="
				## Fade out - if switching item sets or if no search/filter/category is chosen ##
				If(
					IsVisibleSelf(),
					FadeOut(75 * _shopFlag_animSpeedMult)
				);
				
			"
			watch="storeAlphaUpdate"
			ontrigger="
				If(
					IsVisible(),
					Trigger('updateShopItemAlpha{index}')
				);
			"
		>
			<button
				interactive="false"
				width="100%"
				height="7.8h"
				color="invisible"
				onclick="
					PlaySound('/shared/sounds/ui/button_click_03.wav');
					Purchase({index});
				"
				onevent1="
					PlaySound('/shared/sounds/ui/button_click_03.wav');
				"
				watch="ShopItem{index}"
				ontrigger="
					SetOnClick(
						'
							DoEvent(1);
							If(
								!StringEquals(GetActiveRecipe(), \'' # param28 # '\'),
								Split(
									Set(\'_recipeTransitionMode\', 0),
									Set(\'_shopNewRecipeTarget\', \'' # param28 # '\'),
									Trigger(\'shopComponentAnimStep0\', 0)
								),
								SetActiveRecipe(\'\')
							);
						'
					);
					SetOnRightClick(
						'DoEvent(1);' #
						If(
							(param8 and !param17 and !param18) or !param8,
							If(
								!StringEmpty(_lastActiveShop) and StringEmpty(_activeShopFilters) and StringEmpty(_lastShopSearch),
								'Purchase({index});',
								'PurchaseByName(\'' # param28 # '\');'
							),
							'
								Set(\'_lastSelectedItemEntity\', \'' # param28 # '\');
								Trigger(
									\'shopBuyRemainingInfo\',
									\'' # EscapeString(param1) # '\',
									\'' # EscapeString(param2) # '\',
									\'' # param3 # '\'
								);
								CallEvent(\'purchase_components_popup\', 0);
							'
						)
					);
					
					SetOnMouseOver(
						'
							TriggerItemTooltip(
								\'shopGlobalItemTooltipUpdate\',
								\''# param28 #'\',
								' # param29 # '
							);
							Trigger(
								\'shopGlobalItemTooltipIcon\',
								GetEntityIconPath(
									\''# param28 #'\'
								)
							);
							
							If(IsVisible() and !IsVisibleSelf(\'item_cursor\') and !quickitem_dummy_draggingItem,
								Trigger(
									\'QuickItemDummyUpdate\',
									\''# param28 #'\',
									GetEntityIconPath(
										\''# param28 #'\'
									),
									'#GetAbsoluteX()#',
									'#GetAbsoluteY()#',
									\'7.82h\',
									\'24h\',
									\'{index=0}\'
								)
							);  
							If(IsVisible() and !IsVisibleSelf(\'item_cursor\') and !autobuyitem_dummy_draggingItem,
								Trigger(
									\'AutobuyItemDummyUpdate\',
									\''# param28 #'\',
									GetEntityIconPath(
										\''# param28 #'\'
									),
									'#GetAbsoluteX()#',
									'#GetAbsoluteY()#',
									\'7.82h\',
									\'24h\',
									\'{index=0}\'
								)
							);  
							
							DoEvent(0);
						'
					);
				"
				onevent0="
					ShowWidget('shopGlobalItemTooltip');
				"
				onmouseout=" 
					HideWidget('shopGlobalItemTooltip');
				"
				
			>
				<instance name="store_v4_item2_widgetstate" index="{index=0}" statename="up"/>
				<instance name="store_v4_item2_widgetstate" index="{index=0}" statename="over" item_bgcolor="#014216" recipe_bgcolor="#002e45" item_bordercolor="#00ff8a" recipe_bordercolor="#00acff" overState="true"/>
				<instance name="store_v4_item2_widgetstate" index="{index=0}" statename="down" x="1" y="1"/>
				<instance name="store_v4_item2_widgetstate" index="{index=0}" statename="disabled"/>
			</button>

		</panel>

	</template>
	
	<trigger name="QuickItemDummyUpdate" />
	<trigger name="QuickItemPositionUpdate" />
	<panel name="quickslot_dummy_item" noclick="0" height="7.82h" width="24h" color="invisible" align="left" valign="top" 
		onload="CreateInt('quickitem_shakeStateIndex', 0); CreateBool('quickitem_dummy_shiftDown', 0); CreateBool('quickitem_dummy_draggingItem', 0); CreateString('quickitem_dummy_entity', ''); CreateString('quickitem_dummy_icon', ''); CreateString('quickitem_ItemCursorEntity', ''); CreateString('quickitem_ItemCursorIcon', '');" cangrab="1"
		watch="QuickItemDummyUpdate" 
		ontrigger="
			If(!IsVisibleSelf('item_cursor') and !StringEmpty(param0),
				Split(
					##Echo('Dragging: '#quickitem_dummy_draggingItem),##
					##Echo('Set quickitem_dummy_entity: ^r'#quickitem_dummy_entity#' ^g'#param0),##
					Set(quickitem_dummy_entity, param0),
					Set(quickitem_dummy_icon, param1)
				)
			);
			SetX(param2);
			SetY(param3);	
			SetHeight(param4);
			SetWidth(param5);
			Set(quickitem_shakeStateIndex, param6);
			"
		onevent="Instantiate('quickslot_onframe');"
		onevent2="Call('quickslot_onframe', 'DestroyWidget();');"
		onevent1="
			If(quickitem_dummy_draggingItem, Cmd('Action CommanderSecondary'));
			BreakDrag();
			If(WidgetExists('quickslot_onframe'), DoEvent(2));		
			Cmd('Trigger ItemCursorVisible 0 0');
			DoEvent(4);
			SetVisible(0);			
			"
		onevent4="
			Trigger('ItemCursorEntity', quickitem_ItemCursorEntity);
			Trigger('ItemCursorIcon', quickitem_ItemCursorIcon);
			Set(quickitem_dummy_entity, '');
			Set(quickitem_dummy_icon, '');		
		"
		onclick="
			If(!StringEmpty(quickitem_dummy_entity) and !StringEmpty(quickitem_dummy_icon),
				Split(
					If(!WidgetExists('quickslot_onframe'), DoEvent()),
					Call('item_cursor_icon', 'SetTexture(quickitem_dummy_icon);'),
					Cmd('Trigger ItemCursorVisible 1 0')
				)
			);
			"
		onmouseover="
			ShowWidget('shopGlobalItemTooltip');
			Trigger('QuickItemBorder', quickitem_shakeStateIndex, -2);
			If(!StringEmpty(quickitem_shakeStateIndex), GroupCall('shop_item_jiggler_'#quickitem_shakeStateIndex, 'SetWatch(\'HostTime\');'));
		"
		onmouseout="
			HideWidget('shopGlobalItemTooltip');
			Trigger('QuickItemBorder', 0, 0);
			If(!StringEmpty(quickitem_shakeStateIndex), GroupCall('shop_item_jiggler_'#quickitem_shakeStateIndex, 'SetWatch(\'\'); SetX(0); SetY(0); SetRotation(0);'));
		"		
		onshow="
			BringToFront();
			"	
		onhide="
			BreakDrag(); 
			HideWidget('shopGlobalItemTooltip');
			Trigger('QuickItemBorder', 0, 0);
			If(!StringEmpty(quickitem_shakeStateIndex), GroupCall('shop_item_jiggler_'#quickitem_shakeStateIndex, 'SetWatch(\'\'); SetX(0); SetY(0); SetRotation(0);'));
			"
		watch3="KeyModifier1"
		ontrigger3="
			If(!param, 
				Split(DoEvent(1), Call('quickslot_dummy_item', 'SetVisible(0);')),
				Split(SetVisible(1), Call('quickslot_dummy_item', 'SetVisible(1);'))
			);
			"
		watch4="ItemCursorVisible"
		ontrigger4="If(!param0, DoEvent(4)); Set(quickitem_dummy_draggingItem, param1);"		
				
		watch5="ItemCursorEntity"
		ontrigger5="Set(quickitem_ItemCursorEntity, ItemCursorEntity);"		

		watch6="ItemCursorIcon"
		ontrigger6="Set(quickitem_ItemCursorIcon, ItemCursorIcon);"			
	
	>
	</panel>
	<template name="quickslot_onframe">
		<panel noclick="1" name="quickslot_onframe" height="2h" width="100%" valign="top" color="invisible"
			onframe="Call('item_cursor', 'MoveToCursor();');"
		/>
	</template>
	
	<template name="store_v4_item_simple_widgetstate">
		<widgetstate statename="{statename}" x="{x}" y="{y}">
	<!--		<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="{item_bgcolor=0 0 .03 .7}" blockinput="false" noclick="true" watch="updateShopItemSimple{index}" ontrigger="SetVisible(!*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));"
				watch1="updateShopItemAlphaSimple{index}"
				ontrigger1="
					If(
						{overState=false},
						Split(
							SetColor('0 0.25 0.086 ' # (0.2 + (shopAlphaValue * 0.005))),
							SetBorderColor('0 0.25 0.086 ' # (0.1 + (shopAlphaValue * 0.006)))
						),
						Split(
							SetColor('0 0 0.03 ' # (0.2 + (shopAlphaValue * 0.005))),
							SetBorderColor('0 0 0.03 ' # (0.1 + (shopAlphaValue * 0.006)))
						)
					);
				"
			/>
			<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="{recipe_bgcolor=.03 0 0 .7}" visible="false" watch="updateShopItemSimple{index}" ontrigger="SetVisible(*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));" blockinput="false" noclick="true"
				watch1="updateShopItemAlphaSimple{index}"
				ontrigger1="
					If(
						{overState=false},
						Split(
							SetColor('0 0.18 0.27 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0.18 0.27 ' # (0.1 + (shopAlphaValue * 0.006)))
						),
						Split(
							SetColor('0.03 0 0 ' # (0.1 + (shopAlphaValue * 0.005))),
							SetBorderColor('0.03 0 0 ' # (0.1 + (shopAlphaValue * 0.006)))
						)
					);
				"
			/>			
			<frame texture="/ui/frames/roundframe.tga" color="{item_bordercolor=0 0 0 1}" borderthickness="0.4h" blockinput="false" noclick="true" watch="updateShopItemSimple{index}" ontrigger="SetVisible(!*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));"
				watch1="updateShopItemAlphaSimple{index}"
				ontrigger1="
					If(
						{overState=false},
						Split(
							SetColor('0 0.1 0.054 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0.1 0.054 ' # (0.1 + (shopAlphaValue * 0.006)))
						),
						Split(
							SetColor('0 0 0 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0 0 ' # (0.1 + (shopAlphaValue * 0.006)))
						)
					);
				"
			/>
			<frame texture="/ui/frames/roundframe.tga" color="{recipe_bordercolor=0 0 0 1}" borderthickness="0.4h" blockinput="false" noclick="true" visible="false" watch="updateShopItemSimple{index}" ontrigger="SetVisible(*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));"
				watch1="updateShopItemAlphaSimple{index}"
				ontrigger1="
					If(
						{overState=false},
						Split(
							SetColor('0 0.67 1.0 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0.67 1.0 ' # (0.1 + (shopAlphaValue * 0.006)))
						),
						Split(
							SetColor('0 0 0 ' # (0.1 + (shopAlphaValue * 0.006))),
							SetBorderColor('0 0 0 ' # (0.1 + (shopAlphaValue * 0.006)))
						)
					);
				"
			/>  -->
			<panel width="100%" height="100%" align="center" valign="center" noclick="true">
				
				<panel width="100%" noclick="true">					
					<!-- Icon -->
					<panel width="100%" height="100@" align="center" valign="center" noclick="true">
						<image noclick="true" watch1="updateShopItemSimple{index}" ontrigger1="SetTexture(_storeItemCurTexture{index});" 
							watch2="ShopItem{index}" ontrigger2="If(param6 and !(param8 and param17 and !param18) and param25, SetRenderMode('normal'), SetRenderMode('grayscale'));" 
								group="shop_item_jiggler_{index}" 
								ontrigger="
								  SetRotation(Sin(((param % 300) / 300) * (3.14159265 * 2)) * 8);
								  "															
							/>
						<piegraph start="270" end="-90" square="true" color="#000000cc" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetVisible(param21 gt 0); SetValue(param20);" noclick="true"/>
						<frame color="invisible" borderthickness="1" bordercolor="0 0 0 1" noclick="true"/>
						<panel color="0 0 0 0.6" watch="ShopItem{index}" ontrigger="SetVisible(!(param6 and !(param8 and param17 and !param18)) or !param25);" noclick="true"/>
						<frame
							borderthickness="4"
							bordercolor="yellow"
							color="invisible"
							visible="false"
							watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('RecipeItemType ShopItem' # param);"
							watch="RecipeItemType ShopItemType{index}"
							ontrigger="SetVisible(StringEquals(RecipeItemType, ShopItemType{index}));"
							noclick="true"
							passivechildren="true"
						>
							<image x="3" y="3" width="-6" height="-6" color="yellow" texture="/ui/fps/selected.tga" rendermode="additive"/>
						</frame>
						<!-- Recipe Scroll -->
						<panel color="black" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetVisible(param8 and !param17 and !param18);" noclick="1">
							<image
								width="55%" height="55%"
								align="center" valign="center"
								 watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);"
								watch="ShopItem{index}"
								ontrigger="SetTexture(param3);
									If(param6, SetRenderMode('normal'), SetRenderMode('grayscale'));
									If(param8 and param12, SetRenderMode('normal'));"
							/>
							<image
								texture="/ui/elements/shop/scroll_overlay.tga"
								watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);"
								watch="ShopItem{index}"
								ontrigger="If(param6, SetRenderMode('normal'), SetRenderMode('grayscale'));
									If(param8 and param12, SetRenderMode('normal'));"
							/>
						</panel>
						<image texture="/ui/common/new_shop_interface/stash.tga" x="0.3h" y="0.3h" width="2.2h" height="2.2h" align="right" valign="bottom" noclick="true" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetVisible(param15 and !param16 and !param17 and !param18);" />
						<label textalign="center" textvalign="center" width="1.5h" height="1.5h" color="white" shadow="true" font="dyn_11" noclick="true" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetText(Translate(param13));" />
						<label noclick="1" valign="center" align="center" textvalign="center" textalign="center" color="#87CEEB" shadow="1" font="dyn_11" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetVisible(param21 gt 0); SetText(FtoT(param21, 1, 0, '-'));"/>

						<image texture="/ui/common/new_shop_interface/stash.tga" x="0.3h" y="0.3h" width="2.2h"
						height="2.2h" align="right" valign="bottom" noclick="true"
						watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);"
						watch="ShopItem{index}" ontrigger="SetVisible(param15 and !param16 and !param17 and !param18);" />
						<image
							width="50%" height="50%"
							align="right" valign="top"
							texture="/ui/elements/shop/new.tga"
							watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('updateShopItem' # param);"
							watch="updateShopItemSimple{index}"
							ontrigger="SetVisible(*('_storeItemCurNew' # _itemSlotWatch{index}));"
							noclick="true"
						/>
						<frame width="+2" height="+2" noclick="1" color="invisible" bordercolor="yellow" borderthickness="2" visible="0" 
							watch1="QuickItemBorder" ontrigger1="If(param0 == {index} and param1 == -2, Split(SetVisible(1), SetBorderColor('1 1 0 1')), SetVisible(0));"
						/>	
					</panel>
				</panel>
				
				<!-- Cost -->
				<panel y="2.2h" width="3.7h" align="right" noclick="true">				
					<panel width="3.55h" height="1.7h" align="center" valign="center" noclick="true">
						<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.3h" style="item_header" blockinput="false" noclick="true" watch="updateShopItemSimple{index}" ontrigger="SetVisible(!*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));"
							watch1="updateShopItemAlphaSimple{index}"
							ontrigger1="
								SetBorderColor('0.01 0.56 0.19 ' # (0.25 + (shopAlphaValue * 0.0075)));
								SetColor('0.01 0.56 0.19 ' # (0.25 + (shopAlphaValue * 0.0075)));
							"
						/>
						<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.3h" style="recipe_header" visible="false"
						watch="updateShopItemSimple{index}" ontrigger="SetVisible(*('_storeItemCurIsRecipe' # _itemSlotWatch{index}));" 
						blockinput="false" noclick="true"
							watch1="updateShopItemAlphaSimple{index}"
							ontrigger1="
								SetBorderColor('0.01 0.39 0.56 ' # (0.25 + (shopAlphaValue * 0.0075)));
								SetColor('0.01 0.39 0.56 ' # (0.25 + (shopAlphaValue * 0.0075)));
							"
						/>
						<frame texture="/ui/frames/roundframe.tga" color="0 0 0 1" borderthickness="0.3h" blockinput="false" noclick="true"/>

					</panel>					
					<label x="-0.2h" y="0.1h" font="dyn_10" color="1 1 0 1" shadow="true" textvalign="center" textalign="right" noclick="true" watch="ShopItem{index}" ontrigger="SetText(param4);" />
					<image texture="/ui/fe2/store/gold_coins.tga" x="-0.2h" y="0.9h" width="1.2h" height="1.2h" valign="center" align="right" />					
				</panel>
				<label textalign="center" textvalign="center" width="1.5h" height="1.5h" align="right" font="dyn_10" shadow="true" color="white" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('ShopItem' # param);" watch="ShopItem{index}" ontrigger="SetText(param19);" noclick="true" />
				
			</panel>
			<image texture="/ui/elements/star.tga" x="-0.7h" y="-0.7h" width="1.6h" height="1.6h" align="left" valign="top" noclick="true" visible="false" watch1="ShopItemSlotDEprec{index}" ontrigger1="SetWatch('updateShopItem' # param);" watch="updateShopItemSimple{index}" ontrigger="SetVisible(*('_storeItemCurRecommended' # _itemSlotWatch{index}));" color="1 1 0 1" />
		
		</widgetstate>
	</template>
	
	<template name="shop_v4_item_simple">
		<panel noclick="true"
			x="{x=0}" y="{y=0}"
			width="6h" height="7h"
			name="shop_v4_item_simple{index}"
			group="shop_v4_items_simple"
			visible="false"
			onload="
				SetX(
					(
						7.3 * ({index} % 5)
					) # 'h'
				);
				
				SetY(
					(
						6 * Floor({index} / 5)
					) # 'h'
				);
				If(
					!StringEmpty('{reportRowY}'),
					CreateInt('_shopItemRowYSimple{reportRowY}', GetY())
				);
				
				##	Set Y position when shown (primarily during scroll) 

				##
				
				##	Update the item's widgetstate to display current item data
				Trigger('updateShopItemSimple{index}');
				##
				
				
				## Minimum req for an item to be displayed
					_storeItemCurValid{index} and {index} ge _shopScrollMinID and {index} le _shopScrollMaxID,
				##
				
			"
			onshow="
				SetX(
					(
						7.3 * ({index} % 5)
					) # 'h'
				);
				
				SetY(
					(
						6 * Floor({index} / 5)
					) # 'h'
				);"
			onevent0="
				## Update Y position on visibility ##
				SetY(
					*('_shopItemRowYSimple' # Ceil(((({index} - _shopScrollMinID) + 1) / 5) - 1))
				);
			"
			onevent1="
				## Simple staggered fade in ##
				
				If(
					_storeItemCurValid{index} and {index} ge _shopScrollMinID and {index} le _shopScrollMaxID,
					SleepWidget(
						3 * {index} * _shopFlag_animSpeedMult,
						'
							DoEvent(0);
							DoEvent(2);
							FadeIn(100 * _shopFlag_animSpeedMult);
						'
					)
				);
			"
			onevent2="
				## Populate the item's widgetstate with new data ##
				Trigger('updateShopItemSimple{index}');
				Trigger('updateShopItemAlphaSimple{index}');
			"
			onevent3="
				## Instant visibility ##
				If(
					_storeItemCurValid{index} and {index} ge _shopScrollMinID and {index} le _shopScrollMaxID,
					Split(
						DoEvent(0),
						DoEvent(2),
						If(
							!IsVisibleSelf(),
							SetVisible(true)
						)
					),
					If(
						IsVisibleSelf(),
						SetVisible(false)
					)
				);

			"
			onevent4="
				## Active to active switch (if the minimum item in the scroll range is visible) ##
				DoEvent(5);
				SleepWidget(
					75 * _shopFlag_animSpeedMult,
					'DoEvent(1);'
				);
			"
			onevent5="
				## Fade out - if switching item sets or if no search/filter/category is chosen ##
				If(
					IsVisibleSelf(),
					FadeOut(75 * _shopFlag_animSpeedMult)
				);
			"
			watch="storeAlphaUpdate"
			ontrigger="
				If(
					IsVisible(),
					Trigger('updateShopItemAlphaSimple{index}')
				);
			"
		>
			<button
				interactive="false"
				width="80%"
				height="80%"
				color="invisible"
				onclick="
					PlaySound('/shared/sounds/ui/button_click_03.wav');
					Purchase({index});
				"
				onevent1="
				
				Call('shop_right',
				'
					CreateInt(\'shop_main_temp_X\', GetAbsoluteX());
					CreateInt(\'shop_main_temp_Y\', GetAbsoluteY());
					Call(\'shopRecipeTree\',
					\'
						SetX(
							(
								(7.3 * ({index} % 5))+24.6
							) # \\\'h\\\'
						);
						SetX((GetAbsoluteX()-shop_main_temp_X
							-(GetWidth()/2)
							)
						);
						SetY(
							(
								(6 * Floor({index} / 5))+7.7
							) # \\\'h\\\'
						);
						SetY((GetAbsoluteY()-shop_main_temp_Y
							-(GetHeight()/2)
							)
						);
					\'
					);
				'
				);
					PlaySound('/shared/sounds/ui/button_click_03.wav');
				"
				watch="ShopItem{index}"
				ontrigger="
				##Trigger('trigger_LMB_RMB_Switched', switchLMB_RMB);##
				
				CreateString('string_lastclickedItem', GetActiveRecipe());
				
				CreateString('string_originalLMB',
							'
								DoEvent(1);
								If(
									!StringEquals(GetActiveRecipe(), \'' # param28 # '\'),
									Split(
										Set(\'_recipeTransitionMode\', 0),
										Set(\'_shopNewRecipeTarget\', \'' # param28 # '\'),
										Trigger(\'shopComponentAnimStep0\', 0)
									),
									SetActiveRecipe(\'\')
								);
							'
						)
				);
				
				CreateString('string_originalRMB',
							'DoEvent(1);' #
							If(
								(param8 and !param17 and !param18) or !param8,
								If(
									!StringEmpty(_lastActiveShop) and StringEmpty(_activeShopFilters) and StringEmpty(_lastShopSearch),
									'Purchase({index});',
									'PurchaseByName(\'' # param28 # '\');'
								),
								'
									Set(\'_lastSelectedItemEntity\', \'' # param28 # '\');
									Trigger(
										\'shopBuyRemainingInfo\',
										\'' # EscapeString(param1) # '\',
										\'' # EscapeString(param2) # '\',
										\'' # param3 # '\'
									);
									CallEvent(\'purchase_components_popup\', 0);
								'
							)
				);
				
				if(!switchLMB_RMB,
					Split(
						SetOnClick(string_originalLMB),
						SetOnRightClick(string_originalRMB)
					),
					Split(
						SetOnRightClick(string_originalLMB),
						SetOnClick(string_originalRMB)
					)
				);
				
					SetOnMouseOver(
						'
							TriggerItemTooltip(
								\'shopGlobalItemTooltipUpdate\',
								\''# param28 #'\',
								' # param29 # '
							);
							Trigger(
								\'shopGlobalItemTooltipIcon\',
								GetEntityIconPath(
									\''# param28 #'\'
								)
							);
							If(IsVisible() and !IsVisibleSelf(\'item_cursor\') and !quickitem_dummy_draggingItem,
								Trigger(
									\'QuickItemDummyUpdate\',
									\''# param28 #'\',
									GetEntityIconPath(
										\''# param28 #'\'
									),
									'#GetAbsoluteX()#',
									'#GetAbsoluteY()#',
									\'7.82h\',
									\'14.6h\',
									\'{index=0}\'
								)
							);
							If(IsVisible() and !IsVisibleSelf(\'item_cursor\') and !autobuyitem_dummy_draggingItem,
								Trigger(
									\'AutobuyItemDummyUpdate\',
									\''# param28 #'\',
									GetEntityIconPath(
										\''# param28 #'\'
									),
									'#GetAbsoluteX()#',
									'#GetAbsoluteY()#',
									\'7.82h\',
									\'14.6h\',
									\'{index=0}\'
								)
							);
							DoEvent(0);
						'
					);
				"
				onevent0="
					ShowWidget('shopGlobalItemTooltip');
				"
				
				onevent4="
				"
				
				onevent5="
				"
				
				onmouseout="
					HideWidget('shopGlobalItemTooltip');
				"
			>
				<instance name="store_v4_item_simple_widgetstate" index="{index=0}" statename="up"/>
				<instance name="store_v4_item_simple_widgetstate" index="{index=0}" statename="over" item_bgcolor="#014216" recipe_bgcolor="#002e45" item_bordercolor="#00ff8a" recipe_bordercolor="#00acff" overState="true" />
				<instance name="store_v4_item_simple_widgetstate" index="{index=0}" statename="down" x="1" y="1" />
				<instance name="store_v4_item_simple_widgetstate" index="{index=0}" statename="disabled"/>
			</button>

		</panel>

	</template>

	<trigger name="GuideRecommendedItemUpdate" />
	<template name="guide_recommended_item">
		<panel visible="0" width="86@" height="86%" valign="center" group="guide_recommended_items" oninstantiate="DoEvent(); If(!VarExists('guide_recommendeditem_isscroll{id}'), DoEvent(1));" onevent="SetVisible(0); FadeIn(guide_fadein*{id} * _shopFlag_animSpeedMult);" onevent1="CreateBool('guide_recommendeditem_isscroll{id}', 0);" 
			noclick="1"	
			watch="{watch}"	ontrigger="
			If({id} == param0 and StringLength(param1) ge 5 and !StringEmpty(GetEntityIconPath(param1)), 
				SetOnTrigger(3, '
					DoEvent(); TriggerShopItem(\'GuideRecommendedItemUpdate\', \''#param1#'\', 0);
				')
			);
			"
			watch3="GuideRecommendedEvent"
			watch4="GuideRecommendedClear" ontrigger4="##DestroyWidget();## SetVisible(0); SetOnTrigger(3, '');"							
		>
			<button noclick="0" passivechildren="1"
				color="invisible"
				interactive="false"
				watch4="GuideRecommendedClear" ontrigger4="SetOnMouseOver(''); SetOnMouseOut(''); SetOnTrigger(1, ''); SetOnTrigger(2, ''); SetOnClick('');"
				watch="{watch}"
				ontrigger="
					If({id} == param0 and StringLength(param1) ge 5 and !StringEmpty(GetEntityIconPath(param1)),
						Split(
							SetOnClick('
								If(!StringEquals(GetActiveRecipe(), \''#param1#'\'), SetActiveRecipe(\''#param1#'\'), SetActiveRecipe(\'\')); Call(\'shop_v4_listbox\', \'SetVisible(0)\');
							'),
							SetOnMouseOver('
								TriggerItemTooltip(
									\'shopGlobalItemTooltipUpdate\',
									\''#param1#'\',
									false
								);
								Trigger(\'shopGlobalItemTooltipIcon\', GetEntityIconPath(\''#param1#'\'));
								Trigger(\'GuideRecommendedBorder\', {panel}, {id});
								ShowWidget(\'shopGlobalItemTooltip\');
							'),
							SetOnMouseOut('
								Trigger(\'GuideRecommendedBorder\', \'\', \'\');
								HideWidget(\'shopGlobalItemTooltip\');							
							'),
							SetOnTrigger(1, '
								If(param39 gt 0, 
									SetOnRightClick(\'						
										If(!ShopControlDown or !guide_recommendeditem_isscroll{id},
											Split(
												Set(\\\'_lastSelectedItemEntity\\\', \\\''#param1#'\\\'),				
												Trigger(
													\\\'shopBuyRemainingInfo\\\',
													\\\'\'#EscapeString(param0)#\'\\\',
													\\\'\'#EscapeString(param4)#\'\\\',
													\\\''#GetEntityIconPath(param1)#'\\\'
												),
												CallEvent(\\\'purchase_components_popup\\\', 0),		
												Call(\\\'shop_v4_listbox\\\', \\\'SetVisible(0)\\\')
											),
											Split(
												Purchase2(\\\''#param1#'\\\'),		
												Call(\\\'shop_v4_listbox\\\', \\\'SetVisible(0)\\\')						
											)
										)
									\'),
									SetOnRightClick(\'	
											PurchaseByName(\\\''#param1#'\\\');		
											Call(\\\'shop_v4_listbox\\\', \\\'SetVisible(0)\\\');
									\')
								);
							'),
							SetOnTrigger(2, '
								If(StringEquals(param28, \''#param1#'\'), Set(guide_recommendeditem_isscroll{id}, (param8 and !param17 and !param18)) );
								If(StringEquals(param28, \''#param1#'\'), 
									SetOnMouseOver(
										\'					
										TriggerItemTooltip(
											\\\'shopGlobalItemTooltipUpdate\\\',
											\\\''#param1#'\\\',
											false
										);
										Trigger(\\\'shopGlobalItemTooltipIcon\\\', GetEntityIconPath(\\\''#param1#'\\\'));
										Trigger(\\\'GuideRecommendedBorder\\\', {panel}, {id});
										ShowWidget(\\\'shopGlobalItemTooltip\\\');					
										
										If(IsVisible() and !IsVisibleSelf(\\\'item_cursor\\\') and !quickitem_dummy_draggingItem,
											Trigger(
												\\\'QuickItemDummyUpdate\\\',
												\\\'\'# param28 #\'\\\',
												GetEntityIconPath(
													\\\'\'# param28 #\'\\\'
												),
												\'#GetAbsoluteX()#\',
												\'#GetAbsoluteY()#\',
												\\\'4.5h\\\',
												\\\'4.5h\\\',
												\\\'{panel}{id}\\\'									
											)
										);	
									\')
								);							
							')
						)
					);
				"
				watch1="shopGlobalItemTooltipUpdate"
				watch2="GuideRecommendedItemUpdate"
			>
				<!-- ctrl recipes  -->
				<panel noclick="1" watch="ShopControlDown" ontrigger="SetVisible(param);" visible="0" passivechildren="true">
					<panel color="black" watch="GuideRecommendedItemUpdate" noclick="1" visible="0"
						watch2="{watch}" ontrigger2=" 
							If({id} == param0 and StringLength(param1) ge 5 and !StringEmpty(GetEntityIconPath(param1)), 
								SetOnTrigger('
									If(StringEquals(param28, \''#param1#'\'), SetVisible(param8 and !param17 and !param18));
								')
							);
						"
					>
						<image align="center" valign="center" 
							watch1="{watch}" ontrigger1=" 
							If({id} == param0 and StringLength(param1) ge 5 and !StringEmpty(GetEntityIconPath(param1)), 
								SetOnTrigger(2, '
									If(StringEquals(param28, \''#param1#'\'), Split(
									SetTexture(param3),
									If(param6, SetRenderMode(\'normal\'), SetRenderMode(\'grayscale\')),
									If(param8 and param12, SetRenderMode(\'normal\'))));
								')	
							);
							"
							width="55%" height="55%"
							watch2="GuideRecommendedItemUpdate"
							group="shop_item_jiggler_{panel}{id}" 
							ontrigger=" SetRotation(Sin(((param % 300) / 300) * (3.14159265 * 2)) * 8); "										
						/>								
						<image texture="/ui/elements/shop/scroll_overlay.tga"/>					
					</panel>
					<frame width="+2" height="+2" noclick="1" color="invisible" bordercolor="yellow" borderthickness="2" visible="0" 
						watch1="QuickItemBorder" ontrigger1="If(param0 == {panel}{id} and param1 == -2, Split(SetVisible(1), SetBorderColor('1 1 0 1')), SetVisible(0));"
					/>					
				</panel>		
				<frame width="+2" height="+2" noclick="1" color="invisible" bordercolor="yellow" borderthickness="2" visible="0" 
					watch1="GuideRecommendedBorder" ontrigger1="If(param0 == {panel} and param1 == {id}, SetVisible(1), SetVisible(0));"
					watch2="shopGlobalItemTooltipUpdate" ontrigger2="If(param39 gt 0, SetBorderColor('#00acff'), SetBorderColor('0 1 0 1'));"
				/> <!-- SetRotation(Sin(((param % 300) / 300) * (3.14159265 * 2)) * 8); -->
				<widgetstate statename="up">
					<image 
						watch2="{watch}" ontrigger2=" If({id} == param0 and StringLength(param1) ge 5 and !StringEmpty(GetEntityIconPath(param1)), SetTexture(GetEntityIconPath(param1)));"
						group="shop_item_jiggler_{panel}{id}" 
						ontrigger="  SetRotation(Sin(((param % 300) / 300) * (3.14159265 * 2)) * 8); " />					
					<frame color="invisible" borderthickness="1" bordercolor=".2 .2 .2 1" noclick="true"/>
					<frame width="+2" height="+2" noclick="1" color="invisible" bordercolor="yellow" borderthickness="2" visible="0" 
						watch1="QuickItemBorder" ontrigger1="If(param0 == {panel}{id} and param1 == -2, Split(SetVisible(1), SetBorderColor('1 1 0 1')), SetVisible(0));"
					/>							
				</widgetstate>
				<widgetstate statename="over">
					<image watch="{watch}" ontrigger=" If({id} == param0 and StringLength(param1) ge 5 and !StringEmpty(GetEntityIconPath(param1)), SetTexture(GetEntityIconPath(param1)));" />
					<frame color="invisible" borderthickness="1" bordercolor=".2 .2 .2 1" noclick="true"/>
				</widgetstate>
				<widgetstate statename="down" x="1" y="1">
					<image watch="{watch}" ontrigger=" If({id} == param0 and StringLength(param1) ge 5 and !StringEmpty(GetEntityIconPath(param1)), SetTexture(GetEntityIconPath(param1)));" />
					<frame color="invisible" borderthickness="1" bordercolor=".2 .2 .2 1" noclick="true"/>
				</widgetstate>
			</button>
		</panel>
	</template>
	
	<trigger name="QuickSlotItemUpdate" />
	<trigger name="QuickItemBorder" />
	<template name="shop_quickslot">
		<panel visible="1" width="95@" height="95%" align="center" valign="center" group="shop_quick_items" oninstantiate="If(!VarExists('shop_quickslot_isscroll{id}'), DoEvent());" 
			noclick="1" onload="If(!VarExists('shop_quickslot_saved{id}'), DoEvent(2)); DoEvent(1);" 
			onevent="CreateBool('shop_quickslot_isscroll{id}', 0);"	
			onevent1="SleepWidget(50, 'TriggerShopItem(\'QuickSlotItemUpdate\', \''#shop_quickslot_saved{id}#'\', 0);');"
			onevent2="CreateString('shop_quickslot_saved{id}', '{item}'); SetSave('shop_quickslot_saved{id}', '{item}');" 
		>
			<button noclick="0" passivechildren="1"
				color="invisible"
				interactive="false"
				onclick="
					if(!switchLMB_RMB,
					Split(
						Echo('Click update fail'),
						If(!StringEquals(GetActiveRecipe(), ''#shop_quickslot_saved{id}#''),
							SetActiveRecipe(''#shop_quickslot_saved{id}#''),
							SetActiveRecipe('')
						),
						Call('shop_v4_listbox', 'SetVisible(0)')
					)
					);
					"
				onrightclick="
					if(switchLMB_RMB,
					Split(
						Echo('Click update fail'),
						If(!StringEquals(GetActiveRecipe(), ''#shop_quickslot_saved{id}#''),
							SetActiveRecipe(''#shop_quickslot_saved{id}#''),
							SetActiveRecipe('')
						),
						Call('shop_v4_listbox', 'SetVisible(0)')
					)
					);"
				onmouseover="
					TriggerItemTooltip(
						'shopGlobalItemTooltipUpdate',
						''#shop_quickslot_saved{id}#'',
						false
					);
					Trigger('shopGlobalItemTooltipIcon', GetEntityIconPath(''#shop_quickslot_saved{id}#'') );
					Trigger('QuickItemBorder', {panel}, {id});
					ShowWidget('shopGlobalItemTooltip');
				"
				onmouseout="
					Trigger('QuickItemBorder', '', '');
					HideWidget('shopGlobalItemTooltip');
				"
				onhide="
					Trigger('QuickItemBorder', '', '');
					HideWidget('shopGlobalItemTooltip');
				"

				watch1="shopGlobalItemTooltipUpdate"
				ontrigger1="
				CreateString('string_originalRMB',
						'						
							If(!ShopControlDown or !shop_quickslot_isscroll{id},
								Split(
									Set(\'_lastSelectedItemEntity\', \''#shop_quickslot_saved{id}#'\'),				
									Trigger(
										\'shopBuyRemainingInfo\',
										\''#EscapeString(param0)#'\',
										\''#EscapeString(param4)#'\',
										\'{icon}\'
									),
									CallEvent(\'purchase_components_popup\', 0),		
									Call(\'shop_v4_listbox\', \'SetVisible(0)\')
								),
								Split(
									Purchase2(\''#shop_quickslot_saved{id}#'\'),		
									Call(\'shop_v4_listbox\', \'SetVisible(0)\')						
								)
							)
						'
				);
				CreateString('string_originalRMB_alt',
						'	
								PurchaseByName(\''#shop_quickslot_saved{id}#'\');		
								Call(\'shop_v4_listbox\', \'SetVisible(0)\');
						'
				);
				
				
				if(!switchLMB_RMB,
					If(param39 gt 0,
						SetOnRightClick(string_originalRMB),
						SetOnRightClick(string_originalRMB_alt)
					),
					If(param39 gt 0,
						SetOnClick(string_originalRMB),
						SetOnClick(string_originalRMB_alt)
					)
				);"
				watch2="QuickSlotItemUpdate"
				ontrigger2="
				
				CreateString('string_originalLMB',
					'
						
						Call(\'shopRecipeTree\',
						\' 
							SetX(
								GetXFromSTring(\\\'50%\\\')
							);
							SetY(
								GetYFromString(\\\'50%\\\')
							);
						\'
						);
						
						If(!StringEquals(GetActiveRecipe(), \'\'#shop_quickslot_saved{id}#\'\'),
							Split(
								Set(\'_lastShopSearch\', \'\'),
								Set(\'_activeShopFilters\', \'\'),	
								If(SearchString(\''#param9#'\', \'recipe\', 0) gt 0,
									Trigger(\'SetShopDisplay\',  \'Shop_Recipes\' # SubString(\''#param9#'\', StringLength(\''#param9#'\') - 5, 1) ),
									Trigger(\'SetShopDisplay\', \'Shop_'#param10#'\')
								),
								Set(\'_shopNewRecipeTarget\', shop_quickslot_saved{id}),
								Set(\'_recipeTransitionMode\', 0),
								Trigger(\'shopComponentAnimStep0\'),
								SetActiveRecipe(\'\'#shop_quickslot_saved{id}#\'\')
							),
							SetActiveRecipe(\'\')
						);
						Call(\'shop_v4_listbox\', \'SetVisible(0)\');				
					'
				);
				
				If(StringEquals(param28, ''#shop_quickslot_saved{id}#''),
					if(!switchLMB_RMB,
						SetOnClick(string_originalLMB),
						SetOnRightClick(string_originalLMB)
				);	
				
				
				
				
				
				If(StringEquals(param28, ''#shop_quickslot_saved{id}#''), Set(shop_quickslot_isscroll{id}, (param8 and !param17 and !param18)) );"
			>
				<!-- ctrl recipes  -->
				<panel noclick="1" watch="ShopControlDown" ontrigger="SetVisible(param);" visible="0" passivechildren="true">
					<panel color="black" watch="QuickSlotItemUpdate" ontrigger="If(StringEquals(param28, ''#shop_quickslot_saved{id}#''), SetVisible(param8 and !param17 and !param18));" noclick="1" visible="0">
						<image align="center" valign="center" watch="QuickSlotItemUpdate"
							width="55%" height="55%"
							ontrigger="If(StringEquals(param28, ''#shop_quickslot_saved{id}#''), Split(
								SetTexture(param3),
								If(param6, SetRenderMode('normal'), SetRenderMode('grayscale')),
								If(param8 and param12, SetRenderMode('normal'))));"
						/>	
						<image texture="/ui/elements/shop/scroll_overlay.tga"/>					
					</panel>
				</panel>			
				<frame width="+2" height="+2" noclick="1" color="invisible" bordercolor="yellow" borderthickness="2" visible="0" 
					watch1="QuickItemBorder" ontrigger1="If(param0 == {panel} and param1 == {id}, SetVisible(1), SetVisible(0)); If(param1 == -2, Split(SetVisible(1), SetBorderColor('1 1 0 1')));"
					watch2="shopGlobalItemTooltipUpdate" ontrigger2="If(param39 gt 0, SetBorderColor('#00acff'), SetBorderColor('0 1 0 1'));"
				/>
				<widgetstate statename="up">
					<image group="shop_quickslot_item_icons{id}" onload="SetTexture(GetEntityIconPath(''#shop_quickslot_saved{id}#''));" />
					<frame color="invisible" borderthickness="1" bordercolor=".2 .2 .2 1" noclick="true"/>
				</widgetstate>
				<widgetstate statename="over">
					<image group="shop_quickslot_item_icons{id}" onload="SetTexture(GetEntityIconPath(''#shop_quickslot_saved{id}#''));" />
					<frame color="invisible" borderthickness="1" bordercolor=".2 .2 .2 1" noclick="true"/>
				</widgetstate>
				<widgetstate statename="down" x="1" y="1">
					<image group="shop_quickslot_item_icons{id}" onload="SetTexture(GetEntityIconPath(''#shop_quickslot_saved{id}#''));" />
					<frame color="invisible" borderthickness="1" bordercolor=".2 .2 .2 1" noclick="true"/>
				</widgetstate>
			</button>			
		</panel>
		<!-- Drag n Drop Item catcher -->
		<panel width="95@" height="95%" align="center" valign="center" color="invisible"
			texture="/ui/common/new_shop_interface/sellback_drop.tga"
			watch="ItemCursorVisible PlayerCanShop"
			ontrigger="SetVisible(ItemCursorVisible); RefreshCursor();"
			rendermode="overlay"					
			onmouseover="
				SetColor('1 1 1 1');
				"
			onmouseout="
				SetColor('invisible');						
			"
			onclick="DoEvent();"
			onevent="			
				##Echo('^cDrop quickitem_dummy_draggingItem: '#quickitem_dummy_draggingItem);##
				##Echo('^gDrop quickitem_dummy_entity: '#quickitem_dummy_entity#' '#quickitem_dummy_icon);##
				##Echo('^yDrop ItemCursorEntity: '#ItemCursorEntity#' '#ItemCursorIcon);##
				If(!StringEmpty(quickitem_dummy_entity) and !StringEmpty(quickitem_dummy_icon) and !quickitem_dummy_draggingItem,
					Split(						
						SetSave('shop_quickslot_saved{id}', ''#quickitem_dummy_entity#''),
						TriggerShopItem('QuickSlotItemUpdate', ''#quickitem_dummy_entity#'', 0),
						GroupCall('shop_quickslot_item_icons{id}', 'SetTexture(\''#quickitem_dummy_icon#'\');'),
						Call('quickslot_dummy_item', 'DoEvent(1);')
					),
					If(!StringEmpty(ItemCursorEntity) and !StringEmpty(ItemCursorIcon),
						Split(
							SetSave('shop_quickslot_saved{id}', ''#ItemCursorEntity#''),
							TriggerShopItem('QuickSlotItemUpdate', ''#ItemCursorEntity#'', 0),
							GroupCall('shop_quickslot_item_icons{id}', 'SetTexture(\''#ItemCursorIcon#'\');'),
							Call('quickslot_dummy_item', 'DoEvent(1);')
						)
					)
				);
			"
			watch2="QuickItemPositionUpdate"
			ontrigger2="
				If( (param0 ge (GetAbsoluteX())) and (param0 le (GetAbsoluteX() + GetWidth())) and IsVisible() and
					(param1 ge (GetAbsoluteY()  - (GetHeight()/4))) and (param1 le (GetAbsoluteY()  + (GetHeight()))),	
						DoEvent()
				);			
			"
			/>			
	</template>	
	
	
	<template name="guide_recommended">
		<panel grow="true" width="100%" height="48@" float="bottom" padding="0.2h" noclick="1"  >
			
			<panel grow="true" width="100%" noclick="1">
				<label fity="true" font="dyn_11" color="#feaa00" content="{phaseName}" noclick="1" shadow="1" outline="1" />				
				<instance name="tip_mark" tip_id="{tip_id}" width="1.7h" height="1.7h" valign="center" align="right"  noclick="1" />
			</panel>
			
			<panel width="100%" height="80%"  noclick="1" >
				<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="0 0 0 .5"  noclick="1" />
				<frame texture="/ui/frames/roundframe.tga" color="#667788" borderthickness="0.4h"  noclick="1" />
				
				<panel name="guide_recommended_panel_{panel}_1" y="1%" height="24@" width="-1.0h" valign="top" align="center" float="right" padding="0.5h" noclick="1" >
					<instance name="guide_recommended_item" id="1" watch="{watch}" panel="{panel}" />
					<instance name="guide_recommended_item" id="2" watch="{watch}" panel="{panel}" />
					<instance name="guide_recommended_item" id="3" watch="{watch}" panel="{panel}" />
					<instance name="guide_recommended_item" id="4" watch="{watch}" panel="{panel}" />
				</panel>
				
				<panel name="guide_recommended_panel_{panel}_2" y="-1%" height="24@" width="-1.0h" valign="bottom" align="center" float="right" padding="0.5h" noclick="1" >
					<instance name="guide_recommended_item" id="5" watch="{watch}" panel="{panel}" />
					<instance name="guide_recommended_item" id="6" watch="{watch}" panel="{panel}" />
					<instance name="guide_recommended_item" id="7" watch="{watch}" panel="{panel}" />
					<instance name="guide_recommended_item" id="8" watch="{watch}" panel="{panel}" />	
				</panel>
			
			</panel>
		</panel>
	</template>

	<template name="guide_ability_lvl">
		<panel group="guide_ability_lvl_group" height="3h" visible="0"  oninstantiate="If(Call(GetParent(), 'IsVisible()'), DoEvent());" onevent="SetVisible(0); SleepWidget((guide_fadein*{id}/5 * _shopFlag_animSpeedMult), 'FadeIn(150 * _shopFlag_animSpeedMult)');" 
			watch3="GuideAbilityEvent" ontrigger3="DoEvent();"	watch4="GuideAbilityClear" ontrigger4="##DestroyWidget();## SetOnMouseOver(''); SetOnMouseOut(''); SetVisible(0);"	
			noclick="0" passivechildren="1"
			watch="GuideInfoFormResultExplodeAbilities"
			ontrigger="
				If({id} == param0,
					Split(
						SetOnMouseOver('
							TriggerLevelupTooltips();
							if(GetInventorySlotFromEntityName(\''#param1#'\') ge 0, if(!cg_useLongTooltips, ShowWidget(\'ability_levelup_tooltip_simple\'#GetInventorySlotFromEntityName(\''#param1#'\')), ShowWidget(\'ability_levelup_tooltip\'#GetInventorySlotFromEntityName(\''#param1#'\'))));					
						'),
						SetOnMouseOut('
							if(GetInventorySlotFromEntityName(\''#param1#'\') ge 0, if(!cg_useLongTooltips, HideWidget(\'ability_levelup_tooltip_simple\'#GetInventorySlotFromEntityName(\''#param1#'\')), 			HideWidget(\'ability_levelup_tooltip\'#GetInventorySlotFromEntityName(\''#param1#'\'))));					
						')
					)
				);
			"		
		>
			<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="0 0 0 .5"/>
			<frame texture="/ui/frames/roundframe.tga" color="#667788" borderthickness="0.4h"/>
			
		<!--	<label width="-92@" textvalign="center" textalign="center" font="dyn_14" color="1 1 1 1" content="{id}" outline="1"  />
			
 -->		<panel x="0.22h" width="88@" height="88%" valign="center" align="left">
				<image  watch="GuideInfoFormResultExplodeAbilities" ontrigger="If({id} == param0, SetTexture(GetEntityIconPath(param1)));" />
				<frame color="invisible" borderthickness="1" bordercolor=".2 .2 .2 1" noclick="true"/>
			</panel>
			<label width="92@" x="9@" y="4%" textvalign="left" textalign="top" font="dyn_10" color="1 1 1 1" content="{id}" outline="1"  />
		
		</panel>
	</template>

	<template name="guidelist_item">
		<panel height="100%" float="right" padding="1.0h" >
	
			<!-- If featured, replace popularity with this --> 
			<panel x="0.8h" width="3.0h" height="100%" visible="0" oninstantiate="SetVisible({is_premium=0} and !{is_yours=0} and !{isfav=0} and !{isdef=0});" >
				<image width="1.6h" height="1.6h" valign="center" align="center" color="0.8 0 1 1" texture="/ui/elements/star.tga" />
			</panel>	
	
			<!-- If yours --> 
			<panel x="0.8h" width="3.0h" height="100%" visible="0" oninstantiate="SetVisible({is_yours=0} and !{isfav=0} and !{isdef=0});" >
				<image width="1.6h" height="1.6h" valign="center" align="center" color="green" texture="/ui/elements/star.tga" />
			</panel>		
		
			<!-- If favorite, replace popularity with this --> 
			<panel x="0.8h" width="3.0h" height="100%" visible="0" oninstantiate="SetVisible({isfav=0} and !{isdef=0});" >
				<image width="1.6h" height="1.6h" valign="center" align="center" texture="/ui/elements/star.tga" />
			</panel>
			
			<!-- If default, replace popularity with this --> 
			<panel x="0.8h" width="3.0h" height="100%" visible="0" oninstantiate="SetVisible({isdef=0});" >
				<image width="1.6h" height="1.6h" valign="center" align="center" color="yellow" texture="/ui/elements/star.tga" />
			</panel>			
			

			
			<!-- If Regular Guide -->
			<label name="guidelist_item_{guideindex}" visible="1" x="0.8h" width="3.0h" height="100%" font="dyn_9" color="0 1 0 1" textvalign="center" textalign="right" shadow="true" 
				content="N/A" 
				oninstantiate="SetVisible(!{isfav=0} and !{isdef=0} and !{is_premium=0} and !{is_yours=0}); 
					If({pop} gt 0,
						Split(
							SetText('{pop=78}%'),
							SetColor(Saturate(1 - (({pop}/100) - 0.50) / 0.50), (({pop}/100) + (((({pop}/100) - 0.05) / 1.0)*0.2)) / 0.45, 	0, 1)
						), 
						Split(
							SetText('N/A'),
							SetColor('0.7 0.7 0.7 1')
						)
					);"
			/>			
			
			<label fitx="true" height="100%" font="dyn_9" color="1 1 1 1" textvalign="center" shadow="true" content="{guidename=Guide Name}" />
			<label fitx="true" height="100%" font="dyn_9" color=".7 .7 .7 1" textvalign="center" shadow="true" content="{author=Author}" />
		</panel>
	</template>
		
	<template name="guidelist_combobox_state">
		<widgetstate statename="{state}">
			<panel color="invisible">
				<image height="100%" width="-200@" align="center" texture="/ui/info/combobox_background_c.tga" color="{color}"/>
				<image height="100%" width="100@" align="left" texture="/ui/info/combobox_background_l.tga" color="{color}"/>
				<image height="100%" width="100@" align="right" texture="/ui/info/combobox_background_r.tga" color="{color}"/>
				<image x="-1" width="100@" height="100%" align="right" valign="center" texture="/ui/info/combobox_button_{image}.tga" />
			</panel>
		</widgetstate>
	</template> 
	
	<template name="guidelist_combobox">
		<combobox
			name="guidelist_combobox"
			interactive="false"
			x="1.0h"
			y="0.55h"
			width="39.0h"
			height="2h"
			align="left"
			valign="top"
			color="invisible"
			itemwidth="100%"
			itemheight="2h"
			maxlistheight="25"
			cvar="{cvar}"
			exteriorscrollbars="false"
			scrolltexture="/ui/info/combobox.tga"
			handleheight="100@" handlewidth="100%"
			scrollbarsize="2h"
			scrollbaroffset="0"
			highlight="under"
			highlightbordercolor="{highlightbordercolor=white}"
			onload="ComboBoxCmd('clear'); {populate=}; {data}('{itemtemplate=guidelist_item}'); {onload=}"
			onselect="{onselect=}"
			onshow="{onshow=}"
			onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav');"
			watch="{watch=}"
			ontrigger="{ontrigger=}"
			onevent="{onevent=}"
			visible="{visible=true}"
			form="{form=}" data="{formdata=}"
		>
			<instance name="guidelist_combobox_state" state="up" color="{color=1 1 1 1}" image="up"/>
			<instance name="guidelist_combobox_state" state="over" color="{overcolor=#69ccff}" image="over"/>
			<instance name="guidelist_combobox_state" state="down" color="{downcolor=#69ccff}" image="over"/>
			<widgetstate statename="listbg">
				<frame height="+2.7h" y="-1.9h" texture="/ui/info/combobox_dropdown.tga" borderthickness="3h" color="{color=1 1 1 1}" />
			</widgetstate>
			<widgetstate statename="itembg">
				<panel width="{itemwidth}" />
			</widgetstate>
			<widgetstate statename="itemhighlight">
				<panel width="{itemwidth=100%}" texture="/ui/info/header_bar_c.tga" color="{color=1 1 1 1}">
					<panel width="100%" height="100%" >
						<image height="50%" width="32" align="left" valign="top" color="{color=1 1 1 1}" texture="/ui/info/header_bar_tl.tga" noclick="1"/>
						<image height="50%" width="32" align="left" valign="bottom" color="{color=1 1 1 1}" texture="/ui/info/header_bar_bl.tga" noclick="1"/>
						<image height="50%" width="32" align="right" valign="top" color="{color=1 1 1 1}" texture="/ui/info/header_bar_tr.tga" noclick="1"/>
						<image height="50%" width="32" align="right" valign="bottom" color="{color=1 1 1 1}" texture="/ui/info/header_bar_br.tga" noclick="1"/>		
					</panel>
				</panel>
			</widgetstate>
		</combobox>
	</template>
	
	<template name="guide_vote_btn">
		<button 
			name="guide_vote_thumbs_{thumbs}_button"
			x="{x}"
			width="116@" height="100%"
			align="{align}"
			color="invisible"
			onmouseover=""
			onmouseout=""
			onclick="{onclick}"
			interactive="false"
			watch="{watch}"
			ontrigger="{ontrigger}"
			watch1="{watch1}"
			ontrigger1="{ontrigger1}"
			watch2="{watch2}"
			ontrigger2="{ontrigger2}"			
		>
			<widgetstate statename="up">
				<label y="-0.2h" textvalign="bottom" textalign="center" font="dyn_7" color=".8 .8 .8 1" content="{label}" />
				<image group="guide_vote_thumbs_{thumbs}" y="-0.3h" width="90%" height="90%" align="center" color=".9 .9 .9 1" texture="/ui/fe2/elements/{texture}" />				
			</widgetstate>
			<widgetstate statename="over">
				<label y="-0.2h" textvalign="bottom" textalign="center" font="dyn_7" color="1 1 1 1" content="{label}" />
				<image group="guide_vote_thumbs_{thumbs}"  y="-0.3h" width="90%" height="90%" align="center" texture="/ui/fe2/elements/{texture}" />
			</widgetstate>
			<widgetstate statename="down" x="1" y="1">
				<label y="-0.2h" textvalign="bottom" textalign="center" font="dyn_7" color="1 1 1 1" content="{label}" />
				<image group="guide_vote_thumbs_{thumbs}"  y="-0.3h" width="90%" height="90%" align="center" texture="/ui/fe2/elements/{texture}" />
			</widgetstate>
		</button>
	</template>
	
	<template name="buyall_item">
		<panel height="3.6h" align="center" visible="{visible=false}" sticky="true" stickytoinvis="false" noclick="true" >
			<!-- Icon -->
			<panel x="0.5h" width="100@" height="100%" noclick="true">
				<image texture="{item}" noclick="true" />
				<frame borderthickness="1" bordercolor=".2 .2 .2 1" color="invisible" noclick="true" />
			</panel>
			<!-- Name -->
			<label x="5.0h" height="100%" textvalign="center" font="dyn_10" color="1 1 1 1" shadow="true" content="{itemname}" noclick="true"/>
			<!-- Cost -->
			<image texture="/ui/fe2/store/gold_coins.tga" x="-0.5h" width="1.6h" height="1.6h" valign="center" align="right" />
			<label x="-3.0h" height="100%" textalign="right" textvalign="center" font="dyn_10" color="1 1 0 1" shadow="true" content="{itemcost}" noclick="true"/>
		</panel>
	</template>

	<template name="buyall_list_item">
		<panel visible="false" height="3.6h" noclick="true"
			watch="RemainingComponents{index}"
			ontrigger="SetVisible(param0);" sticky="true" stickytoinvis="false" group="buyall_list_items">
			<panel noclick="true">
				<!-- Icon -->
				<panel x="0.5h" width="100@" height="100%"
					watch="RemainingComponents{index}"
					ontrigger="
						SetOnMouseOver(
							'
								TriggerItemTooltip(
									\'shopGlobalItemTooltipUpdate\',
									\''# param28 #'\',
									' # param29 # '
								);
								Trigger(\'shopGlobalItemTooltipIcon\', GetEntityIconPath(\''# param28 #'\'));
								DoEvent(0);
							'
						);
					"
					onevent0="
						ShowWidget('shopGlobalItemTooltip');
					"
					onmouseout="
						HideWidget('shopGlobalItemTooltip');
					"
				>
					<image watch="RemainingComponents{index}" ontrigger="SetTexture(param3); If(param25, SetRenderMode('normal'), SetRenderMode('grayscale'));"  texture="{item}" noclick="true" />
					<panel color="0 0 0 0.5" visible="false" watch="RemainingComponents{index}" ontrigger="SetVisible(!param25);" noclick="true"/>
					<panel watch="RemainingComponents{index}" color="0 0 0 1"
						ontrigger="
							SetVisible(param29);
						"
						noclick="true"

					>
						<image watch="RemainingComponents{index}" align="center" valign="center" width="-45%" height="-45%" ontrigger="SetTexture(param3);" noclick="true"	/>
						<image texture="/ui/elements/shop/scroll_overlay.tga" noclick="true"/>
						<frame color="invisible" borderthickness="1" bordercolor=".5 .5 .5 1" noclick="true" />
					</panel>
					<frame borderthickness="1" bordercolor=".2 .2 .2 1" color="invisible" noclick="true" />
				</panel>
				<!-- Name -->
				<label x="5.0h" height="100%" textvalign="center" font="dyn_10" color="1 1 1 1" shadow="true" noclick="true" watch="RemainingComponents{index}" ontrigger="SetText(param1);"/>
				<!-- Cost -->
				<image texture="/ui/fe2/store/gold_coins.tga" x="-0.5h" width="1.6h" height="1.6h" valign="center" align="right" noclick="true" />
				<label x="-3.0h" height="100%" textalign="right" textvalign="center" font="dyn_10" color="1 1 0 1" shadow="true" noclick="true" watch="RemainingComponents{index}" ontrigger="SetText(If(param29, param4, param5)); Set('_recipeRemainingCost', _recipeRemainingCost + If(param29, param4, param5)); CallEvent('recipeRemainingCostTotal');"/>
			</panel>
		</panel>

	</template>

	<if condition="cg_useNewShop2">
		<!-- Central shop controller -->
		<panel noclick="true" color="invisible"
			onload="
				CreateBool('_shopFlag_visible', false);			## Overall visibility for the shop ##
				CreateBool('_shopFlag_recipeVisible', false);	## Whether a recipe should be displayed ##
				CreateBool('_shopFlag_guideOpen', false);		## Whether the guide has been toggled on ##
				
				If(
					!VarExists('_shopFlag_guideOnEmpty'),			## Whether to show the guide if you're not viewing any shop items ##
					CreateBool('_shopFlag_guideOnEmpty', true)
				);
				Cmd('setsave _shopFlag_guideOnEmpty ' # _shopFlag_guideOnEmpty);
				
				CreateBool('_shopFlag_showItems', false);		## Whether items are being displayed for this view ##
				CreateBool('_shopFlag_showScroll', false);		## Whether to show scrollbar ##
				CreateInt('_shopFlag_itemStyle', 0);			
				
				If(
					!VarExists('_shopFlag_itemStyle'),			## 0 is normal detailed view, 1 is simple, 2 is compact (for now) ##
					CreateInt('_shopFlag_itemStyle', 0)
				);
				Cmd('setsave _shopFlag_itemStyle ' # _shopFlag_itemStyle);

				CreateInt('_shopFlag_sortType', 0);				## 0 is category, 1 is filter ##
				CreateInt('_shopFlag_sortStyle', 0);			## Controls how the left-hand menu is displayed.  0 is the current list, 1 is icons only ##
				CreateInt('_shopFlag_maxViewableItems', 18);	## However many can be displayed in this view ##
				CreateBool('_shopFlag_useAnims', true);			## Whether to attempt animations at all ##
				CreateFloat('_shopFlag_animSpeedMult', 1.0);	## Speed multipler for all animations ##
				CreateBool('_shopFlag_useSavedSortStyle');		## Whether to save your choice of category/filter/etc. view ##
				CreateInt('_lastCurrentShopItems', 0);			## Total amount of items to be available in the current shop view ##
				CreateBool('_guideFlag_loadFailure', false);		## Set to true if the guide successfully connects but gets a fail response. ##
				
				If(
					!VarExists('_shopFlag_savePosition'),			## Whether to preserve the shop's position post-drag ##
					CreateBool('_shopFlag_savePosition', false)
				);
				
				## Better facilitate scrollbar functionality with multiple views ##
				CreateInt('_shopFlag_maxViewable0', 18);
				CreateInt('_shopFlag_maxViewable1', 30);

				CreateInt('_shopFlag_itemsPerRow0', 3);
				CreateInt('_shopFlag_itemsPerRow1', 5);
				
				## These help consolidate event calls to show/hide items depending on whether things will be animated ##
				CreateInt('_shopVisShowEventID', 0);			## Whether to do 0 or 2 as the event call for showing target shop widget ##
				CreateInt('_shopVisHideEventID', 1);			## Whether to do 0 or 2 as the event call for showing target shop widget ##
				
				If(
					!VarExists('_shopFlag_itemStyle'),			## 0 is normal detailed view, 1 is simple, 2 is compact (for now) ##
					CreateInt('_shopFlag_itemStyle', 0)
				);

				## Some optional but could-be-cool stuff ##
				
				CreateBool('_shopFlag_guideIntroVisible', true);
				CreateBool('_shopFlag_guideDescVisible', true);
				CreateBool('_shopFlag_guideItemsVisible', true);
				CreateBool('_shopFlag_guideAbilsVisible', true);
				CreateInt('_shopFlag_guideStyle', 0);				## In case we want to have different display styles for the guide ##
				
				##
					Could have something like this:
					If only the desc or intro are visible, display the abilities below.
					If neither are visible, abilities are displayed in that column instead.
					
					Possible columns end up being:
						- Items, Intro/Desc, Abilities
						- Items, Intro/Abilities(2)
						- Items, Desc/Abilities(3)
						- Any of the aforementioned without abilities/items
						
					Basically allows for a much more compact guide view.
					* Might still need to account for fav/vote/etc. button positioning.
					
					Will need to account for recipe component display 
				##
			"
			name="newStoreController"

			watch="RecipeItemType RecipeSequence"
			ontrigger="
				DoEvent(0);
			"
			watch1="CurrentShopItems"
			ontrigger1="
				Set('_lastCurrentShopItems', param);
			"
			watch2="ShopActive"
			ontrigger2="
				If(
					!param0,
					Set('_shopFlag_guideOpen', false)
				);
				
				Set('_shopFlag_visible', param0);
				DoEvent(0);

			"
			watch3="ShopActiveRequest"
			ontrigger3="
				SetActiveRecipe('');
				Set('_activeShopFilters', '');
				Set('_lastShopSearch', '');
				Trigger('SetShopDisplay', param);
			"
			
			watch4="ShopUpdateSequence"
			ontrigger4="
				## Menu item update based on search/filters/shops  ##
				CallEvent('purchase_components_popup', 1);

				If(
					_shopFlag_itemStyle == 1,
					Split(
						GroupCall(
							'shop_v4_items',
							'DoEvent(5);'
						),
						GroupCall(
							'shop_v4_items_simple',
							If(
								_storeInstantTransition or !_shopFlag_useAnims,
								'DoEvent(3);',
								'DoEvent(4);'
							)
						)
					),
					Split(
						GroupCall(
							'shop_v4_items_simple',
							'DoEvent(5);'
						),
						GroupCall(
							'shop_v4_items',
							If(
								_storeInstantTransition or !_shopFlag_useAnims,
								'DoEvent(3);',
								'DoEvent(4);'
							)
						)
					)

				);
					
				DoEvent(0);
			"
			watch5="SetShopDisplay"
			ontrigger5="
				##
					_lastActiveShop
					_activeShopFilters
					_lastShopSearch
				##

				Set('_lastActiveShop', param0);
				Set('_storeInstantTransition', false);
				If(
					!StringEmpty(_lastShopSearch),
					Split(
						SetShopFilter(''),
						SetActiveShop(''),
						SetShopSearch(_lastShopSearch),
						DoEvent(1),
						GroupCall('menu_item_group', 'DoEvent(3));')
					),
					If(
						!StringEmpty(_activeShopFilters),
						Split(
							SetShopSearch(''),
							SetActiveShop(''),
							SetShopFilter(_activeShopFilters),
							DoEvent(1)
						),
						If(
							!StringEmpty(_lastActiveShop),
							Split(
								SetShopSearch(''),
								SetShopFilter(''),
								SetActiveShop(_lastActiveShop),
								DoEvent(1)								
							),
							Split(
								SetShopSearch(''),
								SetShopFilter(''),
								SetActiveShop(''),
								Set('_shopNewRecipeTarget', ''),
								Set('_recipeTransitionMode', 0),
								Trigger('shopComponentAnimStep0'),
								DoEvent(0)
							)
						)
					)
				);
				
				Set('_useShopScroll', false);
				Call('shopItemScrollbar', 'SetValue(6);');

			"
			onevent1="
				## Anything that changes what items could be displayed in the shop while actually displaying items should trigger these ##
				Set('_shopScrollMinID', 0);
				Set('_shopScrollMaxID', *('_shopFlag_maxViewable' # _shopFlag_itemStyle) - 1);
				SetShopItemRange(_shopScrollMinID, _shopScrollMaxID);
			"
			onevent0="
				CallEvent('simpleViewCheckbox', 0);
				Set('_shopFlag_recipeVisible', !StringEmpty(GetActiveRecipe()));
				
				If(
					StringEmpty(_activeShopFilters),
					GroupCall(
						'menu_item_group',
						'DoEvent(' #
						If(
							!StringEmpty(_lastShopSearch),
							3
						)			## Incidentally, a blank event covers categories ##
						# ');'
					)
				);

				
				If(
					_shopFlag_useAnims and IsVisible('newStore'),
					Split(
						Set('_shopVisShowEventID', 0),
						Set('_shopVisHideEventID', 1)
					),
					Split(
						Set('_shopVisShowEventID', 2),
						Set('_shopVisHideEventID', 3)
					)
				);
				
				## Determine what actions to take next based on the basic flags that have been set ##

				##
					Event Controls:
					0 - Standard animated display (in)
					1 - Standard animated display (out)
					2 - Instant display (in)
					3 - Instant display (out)
				
					Relevant widgets:
						- shop_scroll_backer			// Background image for the scrollbar
						- shopItemScrollbar				// The scrollbar itself
						- shop_v4_itemList				// List of items (regardless of list style)
						- shop_popup_noitemsfound		// Too bad it's me blacksmith (0 items found yet search/filter/shop selected)
						- hero_guide_button				// Button state 0 or 1 depending on whether the guide is visible
						- hero_guide					// Main guide panel
						- guide_lower_area				// Guide vote/favorite/etc. controls.
						- catlist_name					// Category view menu
						- catlist_filter				// Filter view menu
						- shop_right					// Entire right portion of the shop
						- shopRecipeTree				// Recipe display
						- heroGuideErrorDisplay			// Error popup space for the hero guide
				##
				
				## Determine whether we're showing the guide or a list of items ##				
				If(
					!StringEmpty(_lastActiveShop) or
					!StringEmpty(_activeShopFilters) or
					!StringEmpty(_lastShopSearch),
					Split(
						Set('_shopFlag_showItems', true),
						Set('_shopFlag_guideOpen', false)
					),
					Split(
						Set('_shopFlag_showItems', false),
						If(
							_shopFlag_guideOnEmpty,
							Set('_shopFlag_guideOpen', true)
						)
					)					
				);
				
				Set(
					'_shopFlag_maxViewableItems',
					*('_shopFlag_maxViewable' # _shopFlag_itemStyle)
				);
				
				Set(
					'_shopFlag_showScroll',
					_lastCurrentShopItems gt _shopFlag_maxViewableItems and _shopFlag_showItems
				);
				
				## Take action based on all flags ##

				CallEvent(
					'header_store',
					If(
						_shopFlag_showItems,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);
				
				CallEvent(
					'shop_v4_itemList',
					If(
						_shopFlag_showItems,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);
				
				CallEvent(
					'shopSimpleViewCheckbox',
					If(
						_shopFlag_showItems,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);

				
				CallEvent(
					'newStore',
					If(
						_shopFlag_showItems or _shopFlag_guideOpen,
						4,		## Full width ##
						5		## Menu width only ##
					)
				);
				
			
				CallEvent(
					'shop_right',
					If(
						_shopFlag_showItems or _shopFlag_guideOpen,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);
				
				CallEvent(
					'hero_guide',
					If(
						_shopFlag_guideOpen and !StringEmpty(GetLocalHeroName()) and !_shopFlag_showItems,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);
				
				Call(
					'hero_guide_button',
					'
						SetButtonState(
							If(
								_shopFlag_guideOpen and !_shopFlag_showItems and !StringEmpty(GetLocalHeroName()),
								1,
								0
							)
						);
					'
				);
				
				CallEvent(
					'header_guide',
					If(
						_shopFlag_guideOpen and !StringEmpty(GetLocalHeroName()),
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);
				
				CallEvent(
					'heroGuideErrorDisplay',
					If(
						_shopFlag_guideOpen,
						0,
						1
					)
				);
				
				CallEvent(
					'guide_lower_area',
					If(
						!_shopFlag_recipeVisible and _shopFlag_guideOpen,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);
				
				CallEvent(
					'shopRecipeTree',
					If(
						_shopFlag_recipeVisible,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);

				CallEvent(
					'shop_scroll_backer',
					If(
						_shopFlag_showScroll,
						_shopVisShowEventID,
						_shopVisHideEventID
					)					
				);
				
				CallEvent(
					'shopItemScrollbar',
					If(
						_shopFlag_showScroll,
						_shopVisShowEventID,
						_shopVisHideEventID
					)					
				);
				
				CallEvent(
					'shopScrollCatcher',
					If(
						_shopFlag_showScroll,
						0,
						1
					)
				);
				
				If(
					_shopFlag_showScroll,
					CallEvent('shopItemScrollbar', 6)
				);
			
				CallEvent(
					'shop_popup_noitemsfound',
					If(
						_lastCurrentShopItems == 0,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);
				
				CallEvent(
					'catlist_name',
					If(
						_shopFlag_sortType == 0,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);
				
				CallEvent(
					'catlist_filter',
					If(
						_shopFlag_sortType == 1,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);

				If(
					_shopFlag_useAnims,
					Split(
						Set('_shopVisShowEventID', 0),
						Set('_shopVisHideEventID', 1)
					),
					Split(
						Set('_shopVisShowEventID', 2),
						Set('_shopVisHideEventID', 3)
					)
				);
				
				CallEvent(
					'newStore',
					If(
						_shopFlag_visible,
						_shopVisShowEventID,
						_shopVisHideEventID
					)
				);
				
				Set('_useShopScroll', true);

			"
		/>
	</if>
	
































	<!-- Store Parent / Drag Bar -->
	<panel
		name="newStore"
		x="8.5h" y="4.8h"
		width="95.0h" height="5.0h"
		cangrab="true"
		onload="
			CreateString('_shopNewRecipeTarget', '');
			
			If(
				!VarExists('_shop_v4_tempX') or !_shopFlag_savePosition,
				CreateInt('_shop_v4_tempX', GetX())
			);
			
			If(
				!VarExists('_shop_v4_tempY') or !_shopFlag_savePosition,
				CreateInt('_shop_v4_tempY', GetY())
			);
			
			If(
				_shopFlag_savePosition and VarExists('_shop_v4_tempX'),
				SetX(_shop_v4_tempX)
			);
			
			If(
				_shopFlag_savePosition and VarExists('_shop_v4_tempY'),
				SetY(_shop_v4_tempY)
			);
			
			If(
				_shopFlag_savePosition,
				Split(
					Cmd('setsave _shop_v4_tempY ' # _shop_v4_tempY),
					Cmd('setsave _shop_v4_tempX ' # _shop_v4_tempX)
				)
			);
			
		"
		onevent0="
			FadeIn(90 * _shopFlag_animSpeedMult);
		"
		onevent1="
			FadeOut(60 * _shopFlag_animSpeedMult);
		"
		onevent2="
			SetVisible(true);
		"
		onevent3="
			SetVisible(false);
		"
		onevent4="
			DoEvent(6);
			SetWidth('95.0h');
			DoEvent(7);
		"
		onevent5="
			DoEvent(6);
			SetWidth('20.0h');
			DoEvent(7);
		"
		onevent6="
			Set('_shop_v4_tempX', GetX());
			Set('_shop_v4_tempY', GetY());
		"
		onevent7="
			SetX(_shop_v4_tempX);
			SetY(_shop_v4_tempY);
		"
		
		watch4="Disconnected"
		ontrigger4="FadeOut(1); SleepWidget(2, 'SetVisible(0);'); CloseShop();"
		
		hotkey="ESC"
		onhotkey="PlaySound('/shared/sounds/ui/button_close_01.wav'); CloseShop();"
		visible="false"
		onenddrag="
			SetFocus(false);
			

			If(
				_shopFlag_savePosition,
				Split(
					Set('_shop_v4_tempX', GetX()),
					Set('_shop_v4_tempY', GetY())
				)
			);
			
			If(
				_shopFlag_savePosition,
				Split(
					Cmd('setsave _shop_v4_tempY ' # _shop_v4_tempY),
					Cmd('setsave _shop_v4_tempX ' # _shop_v4_tempX)
				)
			);
		"
	>
	
		<!-- Input blocker (to clarify, needed a panel which best represented the unclickable area on the store background (which none of the current widgets nor images provided) - it prevents you from accidentally giving unit orders on misclicks 
		<panel name="shop_input_blocker" visible="0" width="-17.0h" height="48.5h" y="5h" x="2.5h" align="right" color="invisible" blockinput="true"/>
		-->
	
		<!-- Left Side -->
		<panel
			x="-6.0h" y="-0.9h"
			width="26.0h"
			noclick="true"
			onshow=" 
							Set('_shopFlag_itemStyle', true);
							Cmd('setsave _shopFlag_itemStyle ' # _shopFlag_itemStyle);
							Trigger('SetShopDisplay', _lastActiveShop);
							
							If(
								!VarExists('shopAlphaValue'), 
								CreateInt('shopAlphaValue', 10)
							);
							Cmd('setsave shopAlphaValue ' # 10);
							##SetValue(shopAlphaValue);##
							
							Trigger('storeAlphaUpdate', 10);
							"
		>		
							
			<!-- Alpha Slider
			<panel x="-1.4h" y="54.4h" height="3.0h" width="19.0h" align="right" noclick="true" visible="0">
				<image width="144%" height="36@" align="right" valign="top" texture="/ui/common/new_shop_interface/trans_slider_bg.tga" noclick="true"/>
				<panel x="-4.3h" y="-0.4h" width="10.0h" height="2.0h" align="right" valign="bottom">			
					<slider
						onload="
							If(
								!VarExists('shopAlphaValue'), 
								CreateInt('shopAlphaValue', 10)
							);
							DoEvent(0); ##65##
						"
						onevent0="
							Cmd('setsave shopAlphaValue ' # shopAlphaValue);
							SetValue(shopAlphaValue);
							
						"
						onshow="
							Trigger('storeAlphaUpdate', shopAlphaValue);
						"
						slotwidth="-1%" slotheight="0.6h"
						slotcolor="1 1 1 1"
						handlewidth="85@" handleheight="85%"
						handlecolor="1 1 1 1"
						cvar=""
						minvalue="10" maxvalue="100"
						step="1"
						value="100"
						texture="/ui/info/slider.tga"
						onselect=""
						onchange="
							Set('shopAlphaValue', this);
							Trigger('storeAlphaUpdate', this);
							Cmd('setsave shopAlphaValue ' # this);
						"
					/>			
				</panel>								
				<instance name="tip_mark" tip_id="shop_trans_tip" x="-1.7h" width="1.8h" height="1.8h" valign="center" align="right" />
			</panel> -->
			
			<!-- Category / Shop List -->
			<panel y="7h" width="100%">
				<image y="-1.8h" width="100%" height="57h" align="right" texture="/ui/common/new_shop_interface/shop_category_bg.tga" noclick="true"
					watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (0.5 + (param / 200)));"
				/>
				
				<!-- Shop Name View -->
				<panel
					name="catlist_name"
					y="0"
					grow="true"
					width="100%"
					float="bottom"
					padding="0"
					noclick="true"
					visible="true"
					onload="
						CreateString('_lastActiveShop', '');
					"
					onevent0="
						If(
							!IsVisibleSelf(),
							Split(
								FadeIn(125),
								SleepWidget(
									125,
									'
										GroupCall(
											\'menuItemCategories\',
											\'DoEvent(0);\'
										);
									'
								)
							)
							
						);
						

					"
					onevent1="
					
						If(
							IsVisibleSelf(),
							Split(
								GroupCall(
									'menuItemCategories',
									'DoEvent(1);'
								),
								SleepWidget(
									125,
									'
										FadeOut(125);
									'
								)
							)
						);
					"
					onevent2="
						If(
							!IsVisibleSelf(),
							Split(
								SetVisible(true),
								GroupCall(
									'menuItemCategories',
									'DoEvent(2);'
								)
							)
						);

					"
					onevent3="
						If(
							IsVisibleSelf(),
							Split(
								GroupCall(
									'menuItemCategories',
									'DoEvent(3);'
								),
								SetVisible(false)
							)
						);

					"
				>
					<instance name="category_holder" menu_items="menu_items_quickslot" id="originalPanel" y="0.2h" />
					<instance name="category_holder" menu_items="menu_items_primary" />
					<instance name="category_holder" menu_items="menu_items_basic" />
					<instance name="category_holder" menu_items="menu_items_recipes" />
					<instance name="category_holder" menu_items="menu_items_extra" />
				</panel>

				<!-- Filter View -->
				<panel
					name="catlist_filter"
					y="0"
					grow="true"
					width="100%"
					float="bottom"
					padding="0"
					noclick="true"
					visible="false"
					onload="
						CreateString('_activeShopFilters', '');
					"
					onevent0="
						If(
							!IsVisibleSelf(),
							Split(
								FadeIn(125),
								SleepWidget(
									125,
									'
										GroupCall(
											\'menuItemFilters\',
											\'DoEvent(0);\'
										);
									'
								)
							)
						);

					"
					onevent1="
						If(
							IsVisibleSelf(),
							Split(
								GroupCall(
									'menuItemFilters',
									'DoEvent(1);'
								),
								SleepWidget(
									125,
									'FadeOut(125);'
								)
							)
						);

					"
					onevent2="
						If(
							!IsVisibleSelf(),
							Split(
								SetVisible(true),
								GroupCall(
									'menuItemFilters',
									'DoEvent(2);'
								)
							)
						);

					"
					onevent3="
						If(
							IsVisibleSelf(),
							Split(
								GroupCall(
									'menuItemFilters',
									'DoEvent(3);'
								),
								SetVisible(false)
							)
						);

					"
				>
				
					<instance name="category_holder" menu_items="menu_items_quickslot" y="0.2h" />
					<instance name="category_holder" menu_items="menu_filters_0" />
					<instance name="category_holder" menu_items="menu_filters_1" />
					<instance name="category_holder" menu_items="menu_filters_2" />
					<instance name="category_holder" menu_items="menu_filters_3" />
					<instance name="category_holder" menu_items="menu_filters_4" />
				</panel>

			</panel>
			
			<!-- Guide / Cat-Filter Buttons -->
			<panel
				y="0.9h"
				width="100%" height="6.5h"
				noclick="true"
			>
				<image width="100%" height="25@" align="right" y="-7.9" texture="/ui/common/new_shop_interface/search_shop_bg.tga" noclick="true"
					watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (0.5 + (param / 200)));"
				/>
				
				<!-- Cat/Filter Toggle -->
				<panel x="-6.05h" y="1.0h" width="11.8h" height="3.0h" align="right" color="0 0 0 .6">
					<frame borderthickness="0.7h" texture="/ui/common/new_shop_interface/simple_border.tga" noclick="true"/>
					<button
						y="-0.1h"
						width="-1.0h"
						height="-0.6h"
						align="center" valign="center"
						color="invisible"
						numstates="2"
						interactive="false"
						onmouseover="PlaySound('/shared/sounds/ui/button_over_03.wav');	ShowWidget('shop_cat_filter');"
						onmouseout="HideWidget('shop_cat_filter');"
						onclick="
							Set(
								_shopFlag_sortType,
								GetButtonState()
							);
							CallEvent('newStoreController', 0);
						"
					>
						<widgetstate statename="up">
							<panel x="-2.7h" width="1" height="-0.6h" valign="center" align="right" color="1 1 1 .1"/>
							<image width="2.4h" height="2.4h" align="right" valign="center" texture="/ui/common/new_shop_interface/cat_swap_up.tga" noclick="true" />
						</widgetstate>
						<widgetstate statename="over">
							<panel x="-2.7h" width="1" height="-0.6h" valign="center" align="right" color="1 1 1 .1"/>
							<image width="2.4h" height="2.4h" align="right" valign="center" texture="/ui/common/new_shop_interface/cat_swap_over.tga" noclick="true" />
						</widgetstate>
						<widgetstate statename="down" x="1" y="1">
							<panel x="-2.7h" width="1" height="-0.6h" valign="center" align="right" color="1 1 1 .1"/>
							<image width="2.4h" height="2.4h" align="right" valign="center" texture="/ui/common/new_shop_interface/cat_swap_down.tga" noclick="true" />
						</widgetstate>
						<widgetstate statename="up2">
							<panel x="-2.7h" width="1" height="-0.6h" valign="center" align="right" color="1 1 1 .1"/>
							<image width="2.4h" height="2.4h" align="right" valign="center" texture="/ui/common/new_shop_interface/cat_swap_up.tga" noclick="true" />
						</widgetstate>
						<widgetstate statename="over2">
							<panel x="-2.7h" width="1" height="-0.6h" valign="center" align="right" color="1 1 1 .1"/>
							<image width="2.4h" height="2.4h" align="right" valign="center" texture="/ui/common/new_shop_interface/cat_swap_over.tga" noclick="true" />
						</widgetstate>
						<widgetstate statename="down2" x="1" y="1">
							<panel x="-2.7h" width="1" height="-0.6h" valign="center" align="right" color="1 1 1 .1"/>
							<image width="2.4h" height="2.4h" align="right" valign="center" texture="/ui/common/new_shop_interface/cat_swap_down.tga" noclick="true" />
						</widgetstate>
					</button>
				</panel>
				
				<!-- Hero Guide Button -->
				<panel x="-2.6h" y="1.0h" width="3.4h" height="3.0h" align="right" color="0 0 0 .6">		
					
					<button
						width="100%" height="100%"
						align="center" valign="center"
						color="invisible"
						numstates="2"
						name="hero_guide_button"
						interactive="false"	
						onmouseover="PlaySound('/shared/sounds/ui/button_over_03.wav');	ShowWidget('shop_guide_btn_tip');"
						onmouseout="HideWidget('shop_guide_btn_tip');"
						onclick="
							PlaySound('/shared/sounds/ui/button_click_06.wav');
							Set('_lastShopSearch', '');
							Set('_activeShopFilters', '');
							If(
								this,
								Split(
									Set('_shopFlag_guideOnEmpty', true),
									Set('_shopFlag_guideOpen', true),
									Trigger('SetShopDisplay', '')
								),
								Split(
									Set('_shopFlag_guideOnEmpty', false),
									Set('_shopFlag_guideOpen', false),
									Trigger('SetShopDisplay', '')
								)
							);
							
							Cmd('setsave _shopFlag_guideOnEmpty ' # _shopFlag_guideOnEmpty);
						"
				
					>
						<widgetstate statename="up">
							<image texture="/ui/common/new_shop_interface/listing_bg.tga" color="#330505" />
							<image texture="/ui/common/new_shop_interface/guide_icon_up.tga" width="100%" height="100@" align="center" valign="center" noclick="true" />
						</widgetstate>
						<widgetstate statename="over">
							<image texture="/ui/common/new_shop_interface/listing_bg.tga" color="#510202" />
							<image texture="/ui/common/new_shop_interface/guide_icon_over.tga" y="-0.2h" width="80%" height="80@" align="center" valign="center" noclick="true" />
						</widgetstate>
						<widgetstate statename="down">
							<image texture="/ui/common/new_shop_interface/listing_bg.tga" color="#510202" />
							<image texture="/ui/common/new_shop_interface/guide_icon_over.tga" width="80%" height="80@" align="center" valign="center" noclick="true" />
						</widgetstate>
						<widgetstate statename="up2">
							<image texture="/ui/common/new_shop_interface/listing_bg.tga" color="#15301e" />
							<image texture="/ui/common/new_shop_interface/guide2_icon_up.tga" width="80%" height="80@" align="center" valign="center" noclick="true" />
						</widgetstate>
						<widgetstate statename="over2">
							<image texture="/ui/common/new_shop_interface/listing_bg.tga" color="#0e4c23" />
							<image texture="/ui/common/new_shop_interface/guide_icon_over.tga" y="-0.2h" width="80%" height="80@" align="center" valign="center" noclick="true" />
						</widgetstate>
						<widgetstate statename="down2">
							<image texture="/ui/common/new_shop_interface/listing_bg.tga" color="#0e4c23" />
							<image texture="/ui/common/new_shop_interface/guide_icon_over.tga" width="80%" height="80@" align="center" valign="center" noclick="true" />
						</widgetstate>
					</button>
					
					<frame borderthickness="0.7h" texture="/ui/common/new_shop_interface/simple_border.tga" noclick="true"/>
					
				</panel>
				

			<!-- Search -->
				<!-- Search Input Box -->
				<panel x="-9.1h" y="1.0h" width="10.5h" height="3.0h" align="right" color="0 0 0 .85">
					<frame borderthickness="0.7h" texture="/ui/common/new_shop_interface/simple_border.tga"/>

					<textbox
						name="shop_search_entry"
						hpadding="0.5h"
						vpadding="0.6h"
						maxlength="250"
						width="-3.6h"
						font="dyn_10"
						textcolor=".8 .8 .8 1"
						shadow="false"
						color="invisible"
						onshow="SetFocus(false);"
						onhide="EraseInputLine(); SetFocus(false);"
						onfocus="If(StringLength(this) le 0, Split(EraseInputLine(), CallEvent('shop_search_label', 1)));"
						onlosefocus=""
						onkeydown=""
						onenter="If(StringLength(this) le 0, Split(EraseInputLine(), CallEvent('shop_search_label', 1))); SetFocus(false);"
						onesc="
							EraseInputLine();
							CallEvent('shop_search_label', 0);
						"
						onload="
							CreateString('_lastShopSearch', '');
							CreateString('_overrideRecommendedItems', '');
							CreateBool('_executeShopSearch', true);
						"
						onchange="
							DoEvent();
						"
						onevent="
							If(
								_executeShopSearch,
								If(
									StringEmpty(this) and !HasFocus(),
									Split(
										CallEvent('shop_search_label', 0),
										DoEvent(1)
									),
									Split(
										Set('_activeShopFilters', ''),
										CallEvent('shop_search_label', 1),
										DoEvent(0)
									)
								)
							);
							Set('_executeShopSearch', true);
						"
						onevent0="
							If(
								_executeShopSearch,
								SleepWidget(
									250,
									'
										If(
											!StringEmpty(this),
											Split(
												Set(\'_lastShopSearch\', this),
												Trigger(\'SetShopDisplay\', \'\', 0)
											),
											DoEvent(1)
										);
									'
								)								
							);
							
							

						"
						onevent1="
							Set('_lastShopSearch', this);
							Trigger('SetShopDisplay', '', 0);
						"
					/>
					<label noclick="true" name="shop_search_label" font="dyn_10" textvalign="center" y="-0.1h" x="0.5h" color="0.7 0.7 0.7 1"
						onevent0="
							SetText(Translate('Shop_Search_Shop'));
							HideWidget('shop_clearSearch_divider');
							HideWidget('shop_clearSearch_button');
						"
						onevent1="
							SetText('');
							ShowWidget('shop_clearSearch_divider');
							ShowWidget('shop_clearSearch_button');
						"
						onload="DoEvent(0);"
					/>

					<!-- Clear Search -->
					<panel x="-2.6h" width="1" height="-1.0h" valign="center" align="right" color="1 1 1 .1" name="shop_clearSearch_divider"/>
					<button
						x="-0.4h"
						width="70@" height="70%"
						align="right" valign="center"
						color="invisible"
						interactive="false"
						onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav'); ShowWidget('shop_clear_search');"
						onmouseout="HideWidget('shop_clear_search');"
						onclick="
							Call(
								'shop_search_entry',
								'
									EraseInputLine();
									DoEvent();
								'
							);
						"
						name="shop_clearSearch_button"
					>
						<widgetstate statename="up">
							<image texture="/ui/common/new_shop_interface/clear_search.tga" color="#555555" />
							<image x="0.1h" width="1.3h" height="1.3h" align="center" valign="center" color=".75 .75 .75 1" texture="/ui/elements/closex.tga" noclick="true" />
						</widgetstate>
						<widgetstate statename="over">
							<image texture="/ui/common/new_shop_interface/clear_search.tga" color="#777777" />
							<image x="0.1h" width="1.3h" height="1.3h" align="center" valign="center" color="1 1 1 1" texture="/ui/elements/closex.tga" noclick="true" />
						</widgetstate>
						<widgetstate statename="down" x="1" y="1">
							<image texture="/ui/common/new_shop_interface/clear_search.tga" color="#777777" />
							<image x="0.1h" width="1.3h" height="1.3h" align="center" valign="center" color="1 1 1 1" texture="/ui/elements/closex.tga" noclick="true" />
						</widgetstate>
						<widgetstate statename="disabled">
							<image texture="/ui/common/new_shop_interface/clear_search.tga" color=".15 .15 .15 1" />
							<image x="0.1h" width="1.3h" height="1.3h" align="center" valign="center" color=".4 .4 .4 1" texture="/ui/elements/closex.tga" noclick="true" />
						</widgetstate>
					</button>

				</panel>
			</panel>
			
			<instance name="shop_btn_closex" width="1.8h" height="1.8h" y="0.9h" x="-0.8h" align="right" valign="center" onclick="CloseShop();" />

			<image x="15.4h" y="5.4h" width="1.0h" height="1.0h" texture="/ui/common/new_shop_interface/gem.tga" noclick="true" />
			
		</panel>

		<!-- Right Side Container -->
		<panel y="-5h"
			name="shop_right"
			noclick="true"
			visible="true"
			onevent0="
				If(
					!IsVisibleSelf(),
					FadeIn(200 * _shopFlag_animSpeedMult)
				);
				
			"
			onevent1="
				If(
					IsVisibleSelf(),
					FadeOut(200 * _shopFlag_animSpeedMult)							
				);
				
			"
			onevent2="
				If(
					!IsVisibleSelf(),
					SetVisible(true)
				);
			"
			onevent3="
				If(
					IsVisibleSelf(),
					SetVisible(false)							
				);
			"
		>
		
			<!-- Guide Lower Area
				Hidden: 48.0h
				Slid Down: 53.6h
			-->
			<panel name="guide_lower_area"
				x="21h" y="48.5h"
				width="43.3h" height="5.5h"
				align="left"
				noclick="true"
				visible="false" color=".5 .5 .5 .3"
				onevent0="
					If(
						!IsVisibleSelf(),
						Split(
							FadeIn(200 * _shopFlag_animSpeedMult),
							SlideY('48.5h', 200 * _shopFlag_animSpeedMult)
						)
					);
				"
				onevent1="
					If(
						IsVisibleSelf(),
						Split(
							SlideY('48.5h', 200 * _shopFlag_animSpeedMult),
							FadeOut(200 * _shopFlag_animSpeedMult)
						)
					);
				"
				onevent2="
					If(
						!IsVisibleSelf(),
						Split(
							SetY('48.5h'),
							SetVisible(true)
						)
					);

				"
				onevent3="
					If(
						IsVisibleSelf(),
						Split(
							SetY('48.5h'),
							SetVisible(false)
						)
					);

				"
			>		
				
					<!--
				
				<image y="0" width="145%" height="13.0h" texture="/ui/common/new_shop_interface/holder_bottom_buttons.tga" noclick="true"
					watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (param / 100));"
				/>
				-->
				<panel x="0.3h" y="0.8h" width="100%" height="4.2h" align="left" float="right" padding="0.5h">
					<panel y="0.1h" width="11h" height="4h" >
						<!-- Default -->
						<instance interactive="false"
							button_name="guide_button_default"
							name="button2"
							width="100%" height="2h"
							valign="top"
							label="general_set_default"
							onclick="Trigger('GuideSetAsDefault', 1);"
							enabled="true"
							watch="GuideDefaultFormResult"
							ontrigger="
							If(param2 and GuideDefaultFormStatus == 2 and (guide_masterQueryTime == param4),
								If(StringEquals(param1, '1') and param2, Split(SetVisible(0), Call('guide_button_undefault', 'SetVisible(1)')))
							);
							"	
							watch2="GuideInfoFormResult GuideInfoFormResultLocal"
							ontrigger2="							
							If((GuideInfoFormStatus == 2  and (guide_masterQueryTime == param17) and param20) or param19, 
								If(!param14, Split(SetVisible(1), Call('guide_button_undefault', 'SetVisible(0)')))
							);								
							"
							watch1="GuideMasterStatus"
							ontrigger1="SetEnabled(param != 1);"						
						/>				
						<instance  interactive="false"
							button_name="guide_button_undefault"
							name="button2"
							width="100%" height="2h"
							valign="top"
							label="guide_remove_default"
							onclick="Trigger('GuideSetAsDefault', 0);"
							enabled="true"
							watch="GuideDefaultFormResult"
							ontrigger="
							If(param2 and GuideDefaultFormStatus == 2 and (guide_masterQueryTime == param4),
								If(StringEquals(param1, '0') and param2, Split(SetVisible(0), Call('guide_button_default', 'SetVisible(1)')))
							);
							"		
							watch2="GuideInfoFormResult GuideInfoFormResultLocal"
							ontrigger2="							
							If((GuideInfoFormStatus == 2  and (guide_masterQueryTime == param17) and param20) or param19, 
								If(param14, Split(SetVisible(1), Call('guide_button_default', 'SetVisible(0)')))
							);"	
							watch1="GuideMasterStatus"
							ontrigger1="SetEnabled(param != 1);"						
						/>	
						
						<!-- Favorite -->
						<instance  interactive="false"
							button_name="guide_button_favorite"
							name="button2"
							width="100%" height="2h"
							valign="bottom"
							label="general_addto_fav"
							onclick="Trigger('GuideAddToFavorites', 1);"
							enabled="true"
							watch="GuideFavoriteFormResult"
							ontrigger="
							If(param2 and GuideFavoriteFormStatus == 2 and (guide_masterQueryTime == param4), 
								If(StringEquals(param1, '1') and param2, Split(SetVisible(0), Call('guide_button_unfavorite', 'SetVisible(1)')))
							);
							"	
							watch2="GuideInfoFormResult GuideInfoFormResultLocal"
							ontrigger2="	
							If((GuideInfoFormStatus == 2  and (guide_masterQueryTime == param17) and param20) or param19, 
								If(!param13, Split(SetVisible(1), Call('guide_button_unfavorite', 'SetVisible(0)')))
							);"		
							watch1="GuideMasterStatus"
							ontrigger1="SetEnabled(param != 1);"
						/>
						<instance  interactive="false"
							button_name="guide_button_unfavorite" visible="0"
							name="button2"
							width="100%" height="2h"
							valign="bottom"
							label="guide_remove_favorite"
							onclick="Trigger('GuideAddToFavorites', 0);"
							enabled="true"
							watch="GuideFavoriteFormResult"
							ontrigger="
							If(param2 and GuideFavoriteFormStatus == 2 and (guide_masterQueryTime == param4),
								If(StringEquals(param1, '0') and param2, Split(SetVisible(0), Call('guide_button_favorite', 'SetVisible(1)')))
							);
							"	
							watch2="GuideInfoFormResult GuideInfoFormResultLocal"
							ontrigger2="							
							If((GuideInfoFormStatus == 2  and (guide_masterQueryTime == param17) and param20) or param19, 
								If(param13, Split(SetVisible(1), Call('guide_button_favorite', 'SetVisible(0)')))
							);"	
							watch1="GuideMasterStatus"
							ontrigger1="SetEnabled(param != 1);"						
						/>
					</panel>
					
					 
					<!-- Voting -->
					<panel width="16.0h" height="100%">				
						<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="0 0 0 .75"/>
						<frame texture="/ui/frames/roundframe.tga" color=".2 .2 .2 1" borderthickness="0.4h"/>				
						<!-- Current -->
						<label y="8%" width="100%" height="100%" textvalign="top" textalign="center" font="dyn_9" color=".8 .8 .8 1" noclick="true" content="game_guide_popularity" />
						<label name="guide_pop_display_label" y="34%" width="100%" height="100%" textvalign="top" textalign="center" font="dyn_16" color="0.7 0.7 0.7 1" noclick="true" content="N/A" />					
						<!-- Up -->
						<instance name="guide_vote_btn" thumbs="up" x="0.3h" align="left" texture="vote_up.tga" label="game_guide_vote_up" 
							onclick="
								if(GuideMasterStatus != 1,
									Split(							
										Trigger('GuideMasterQuery', 'GuideVoteForm', HostTime),
										SubmitForm('GuideVoteForm', 'f', 'guide_vote', 'account', GetAccountID(), 'cookie', GetCookie(), 'v', 1, 'guide', guide_selectedGuide, 'gid', guide_selectedGuide, 'hosttime', HostTime)
									)
								);"
							watch="GuideVoteFormResult"
							ontrigger="
							If(GuideVoteFormStatus == 2  and param3, 
								If(StringEquals(param1, '1'), 
									Split(
										Call('guide_vote_thumbs_up_button', 'SetEnabled(0);'),
										Call('guide_vote_thumbs_down_button', 'SetEnabled(1);'),
										GroupCall('guide_vote_thumbs_up', 'SetRenderMode(\'grayscale\');'),
										GroupCall('guide_vote_thumbs_down', 'SetRenderMode(\'normal\');')
									),
									If(StringEquals(param1, '0'), 
										Split(
											Call('guide_vote_thumbs_up_button', 'SetEnabled(1);'),
											Call('guide_vote_thumbs_down_button', 'SetEnabled(0);'),
											GroupCall('guide_vote_thumbs_up', 'SetRenderMode(\'normal\');'),
											GroupCall('guide_vote_thumbs_down', 'SetRenderMode(\'grayscale\');')
										)
									)
								)
							);
							"
							watch1="GuideInfoFormResult GuideInfoFormResultLocal" 
							ontrigger1="
							If(!StringEmpty(param18) and ((GuideInfoFormStatus == 2  and (guide_masterQueryTime == param17) and param20) or param19),
								Split(
									If(StringEquals(param16, '1'), 
										Split(
											GroupCall('guide_vote_thumbs_up', 'SetRenderMode(\'grayscale\');'),
											GroupCall('guide_vote_thumbs_down', 'SetRenderMode(\'normal\');'),
											Call('guide_vote_thumbs_down_button', 'SetEnabled(1); '),
											Call('guide_vote_thumbs_up_button', 'SetEnabled(0); ') 
											)
										),
									If(StringEquals(param16, '0'), 
										Split(
											GroupCall('guide_vote_thumbs_up', 'SetRenderMode(\'normal\');'),
											GroupCall('guide_vote_thumbs_down', 'SetRenderMode(\'grayscale\');'),						
											Call('guide_vote_thumbs_down_button', 'SetEnabled(0); '), 
											Call('guide_vote_thumbs_up_button', 'SetEnabled(1); ')
										)
									)
								)
							);
							"
							watch2="GuideLoadGuide"
							ontrigger2="GroupCall('guide_vote_thumbs_up', 'SetRenderMode(\'normal\');'); Call('guide_vote_thumbs_up_button', 'SetEnabled(1);');"
						/>		
						<!-- Down -->
						<instance name="guide_vote_btn" thumbs="down" x="-0.3h" align="right" texture="vote_down.tga" label="game_guide_vote_down" 
							onclick="
								if(GuideMasterStatus != 1,
									Split(
										Trigger('GuideMasterQuery', 'GuideVoteForm', HostTime),
										SubmitForm('GuideVoteForm', 'f', 'guide_vote', 'account', GetAccountID(), 'cookie', GetCookie(), 'v', 0, 'guide', guide_selectedGuide, 'gid', guide_selectedGuide, 'hosttime', HostTime)
									)
								);
								"
							watch2="GuideLoadGuide"
							ontrigger2="GroupCall('guide_vote_thumbs_down', 'SetRenderMode(\'normal\');'); Call('guide_vote_thumbs_down_button', 'SetEnabled(1);');"							
						/>					
						<!-- Voting in progress -->
						<panel noclick="0" width="100%" height="100%" align="left" x="0" color=".2 .2 .2 1" visible="0" watch="GuideVoteFormStatus" ontrigger="If(param == 1, SetVisible(1), SleepWidget(3000, 'FadeOut(500)'));" >
							<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="0 0 .07 .8" />
							<frame texture="/ui/frames/roundframe.tga" color="#667788" borderthickness="0.4h"/>						
							<label y="0" x="7%" width="100%" height="100%" textvalign="center" textalign="left" font="dyn_14" color="1.0 0.8 0.0 1" noclick="true" content="Voting..." outline="1" shadow="1" />
							<animatedimage x="55%" name="GuideVoteThrob" texture="/ui/elements/throb/throb.tga" noclick="true" valign="center" loop="1" fps="30" onshow="StartAnim(1);" visible="0" height="66%" width="66@" 
								watch="GuideVoteFormStatus" ontrigger="SetVisible(0); If(param0 == 1, SetVisible(1), FadeOut(10));" 
							/>
							<image x="75%" name="GuideVoteValid" texture="/ui/elements/check_mark.tga" color="0 0.6 0 1" align="left" valign="center" visible="0" height="66%" width="66@" 
								watch="GuideVoteFormResult" ontrigger="
									If(GuideVoteFormStatus == 2  and param3, 
										Split(
											SetVisible(0),
											If((StringEquals(param1, '0') or StringEquals(param1, '1')) and param3, Split(SetVisible(0), FadeIn(50), SleepWidget(3000, 'FadeOut(500)')))
										)
									);"
							/>
							<image x="75%" name="GuideVoteInvalid" texture="/ui/fe2/store/closex2.tga" color="0.6 0 0 1" align="left" valign="center" visible="0" height="66%" width="66@" 
								watch="GuideVoteFormResult" ontrigger="
								If(GuideVoteFormStatus == 2  and param3, 
									Split(
										SetVisible(0),
										If(!(StringEquals(param1, '0') or StringEquals(param1, '1')) or !param3, Split(SetVisible(0), FadeIn(50), SleepWidget(3000, 'FadeOut(500)')))
									)
								);"
							/>
						</panel>
						<!--
						<panel noclick="0" width="100%" height="100%" align="left" x="0" color=".2 .2 .2 1" visible="1" >
							<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="0 0 .07 .8" />
							<frame texture="/ui/frames/roundframe.tga" color="#667788" borderthickness="0.4h"/>				
							<label y="-25%" x="0%" width="100%" height="100%" textvalign="center" textalign="center" font="dyn_12" color="1.0 0.8 0.0 1" noclick="true" content="Guide Voting" outline="1" shadow="1" />
							<label y="20%" x="0%" width="100%" height="100%" textvalign="center" textalign="center" font="dyn_12" color="1.0 0.8 0.0 1" noclick="true" content="Coming Soon(TM)" outline="1" shadow="1" />
						</panel>
						-->
						<panel name="guide_usingLocalPanel" noclick="0" width="100%" height="100%" align="left" x="0" color=".2 .2 .2 1" visible="0" >
							<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="0 0 .07 .8" />
							<frame texture="/ui/frames/roundframe.tga" color="#667788" borderthickness="0.4h"/>				
							<instance valign ="center" align="center" height="65%"
								name="button2"
								label="Retry Web Guides"
								onclick="
									Set(_guideFlag_loadFailure, 0);
									Set(guide_newRound, 1);
									Trigger('GuideHeroName', HeroName);															
									Call('guide_blacksmith', 'SetVisible(0);');
								"
								enabled="true"
								width="95%"
							/>
						</panel>
											
					</panel>
					
					<!-- Auto Level Checkbox -->
					<panel width="17.0h" align="right" noclick="true">
						<instance
							name="Noptions_checkbox"				
							width="15.0h"
							align="left" valign="center"					
							font="dyn_10" label="game_guide_auto_level"
							tip_id="shop_guide_auto_level"
							cvar=""
							onclick="If(GetButtonState() == 1, SetAutoLevelup(StringReplace(guide_autolevel_abilities, '|', ',')), SetAutoLevelup(' '));"
							watch="GuideChangedGuide"
							ontrigger="SetButtonState(0);"
							interactive="false"
						/>
						<!-- <instance name="tip_mark" tip_id="shop_guide_auto_level" width="1.8h" height="1.8h" valign="center" align="right" /> -->
					</panel>			
				</panel>	
				
			</panel>

			<!-- Recipe Tree -->
			<panel align="left" noclick="true" width="65.0h" height="19.11h"
				onload="bringtofront(); SetWidth(GetWidth()*0.77); SetHeight(GetHeight()*0.77);"
				name="shopRecipeTree"
				visible="0"
				onevent0="
					If(
						!IsVisibleSelf(),
							FadeIn(200 * _shopFlag_animSpeedMult)
					);
				

				"
				onevent1="
					If(
						IsVisibleSelf(),
						Split(
							SlideY('30h', 200 * _shopFlag_animSpeedMult),
							FadeOut(200 * _shopFlag_animSpeedMult)
						)
					);

				"
				onevent2="
					If(
						!IsVisibleSelf(),
							SetVisible(true)
					);

				"
				onevent3="
					If(
						IsVisibleSelf(),
							SetVisible(false)
					);

				"
				
				onhotkey="PlaySound('/shared/sounds/ui/button_close_01.wav'); SetActiveRecipe('');"
			>
				<panel align="center" y="110%" width="30%" x="-4%" noclick="1" height="13%" >
					
					<!-- Back Button -->
					<panel color="invisible" noclick="true"
						group="activeRecipeGroup"  align="left" width="40%"

					>
						<instance font="dyn_7"
							name="button2"
							borderthickness="9%"
							label="Back"
							onclick="
					SetActiveRecipe(string_lastclickedItem);"
							onevent0=""
							enabled="true"

						/>
					</panel>
				
				<!-- Buy All Button -->
				<panel  align="right" width="55%" color="invisible" noclick="true" >
					
						<instance
							name="button2"
							font="dyn_7"
							borderthickness="7%"
							label="game_shop_label_buyremaining"
							onclick="
								
								PurchaseRemainingComponents(GetActiveRecipe());
								##
								Set('_lastSelectedItemEntity', GetActiveRecipe());
								
								Trigger(
									'shopBuyRemainingInfo',
									_storeRecipeCurTitle,
									_storeRecipeCurDesc,
									_storeRecipeCurTexture
								);
								CallEvent('purchase_components_popup', 0);
								##
							"
							labelwatch="RecipeItem"
							labelontrigger="
								If(
									param31,
									SetText(Translate('game_shop_label_upgrade')),
									SetText(Translate('game_shop_label_buyremaining'))
								);
							"
							onevent0=""
							enabled="true"

						/>
					</panel>
				</panel>

			<!-- <image name="tree_body_background" y="0" width="104.0h" height="26.0h" texture="/ui/common/new_shop_interface/shop_tree_body.tga" noclick="true" watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (param / 100));"/>

				Tree Layout -->
				<panel y="0" x="0" width="94%" height="98.1%" noclick="true" visible="1" name="guide_lower_tree"
					watch="setRecipeViewStyle"
					ontrigger="
						If(
							param == 0,
							DoEvent(0),
							DoEvent(1)
						);
					"
					
					onevent0="
						FadeIn(150 * _shopFlag_animSpeedMult);
					"
					onevent1="
						FadeOut(150 * _shopFlag_animSpeedMult);
					"
				>
				<!--
					<label width="25.28h" align="left" textalign="center" textvalign="top" font="dyn_12" color="1 1 1 1" outline="true" content="game_shop_label_components" noclick="true"
						group="recipe_tree_labels"
						onevent="
							If(
								_componentGroupValid0 or
								_componentGroupValid1 or
								_componentGroupValid2 or
								_componentGroupValid3,
								If(
									!IsVisible(),
									FadeIn(250)
								),
								If(
									IsVisible(),
									FadeOut(250)
								)
							);
						"
					/>
					<label width="25.28h" align="right" textalign="center" textvalign="top" font="dyn_12" color="1 1 1 1" outline="true" content="game_shop_label_buildsinto" noclick="true"
						group="recipe_tree_labels"
						onevent="
							If(
								_buildupGroupValid0 or
								_buildupGroupValid1 or
								_buildupGroupValid2 or
								_buildupGroupValid3,
								If(
									!IsVisible(),
									FadeIn(250)
								),
								If(
									IsVisible(),
									FadeOut(250)
								)
							);
						"
					/>
 -->
					<panel
						name="tree_4"
						height="-13%"
						valign="bottom"
						noclick="true"
					>
					
						<!-- Left Tree Image --> 
						<panel x="37%" y="0.7%" width="7%" align="left" noclick="true">
							<image width="100%" height="100%" valign="center" align="right" texture="/ui/common/new_shop_interface/tree_left_4_black°.tga" noclick="true" group="recipeBranchImages"
							watch="storeAlphaUpdate" ontrigger="##SetColor('1 1 1 ' # (param / 100));##"
							onevent="
									If(
										(
											!_componentGroupValid0 and
											!_componentGroupValid1 and
											!_componentGroupValid2 and
											!_componentGroupValid3
										) or (
											!StringEquals(_componentGroupValid0, _componentGroupValidOld0) or
											!StringEquals(_componentGroupValid1, _componentGroupValidOld1) or
											!StringEquals(_componentGroupValid2, _componentGroupValidOld2) or
											!StringEquals(_componentGroupValid3, _componentGroupValidOld3)
										),
										SlideX('5h', 200 * _shopFlag_animSpeedMult),
										FadeOut(200 * _shopFlag_animSpeedMult)
									);
								"
								onevent0="
									If(
										(_componentGroupValid0 or _componentGroupValid1 or _componentGroupValid2 or _componentGroupValid3),
										Split(
											If(
												_componentGroupValid3,
												SetTexture('/ui/common/new_shop_interface/tree_left_4_black.tga'),
												If(
													_componentGroupValid2,
													SetTexture('/ui/common/new_shop_interface/tree_left_3_black.tga'),
													If(
														_componentGroupValid1,
														SetTexture('/ui/common/new_shop_interface/tree_left_2_black.tga'),
														SetTexture('/ui/common/new_shop_interface/tree_left_1_black.tga')
													)
												)
											),
											SlideX(0, 200 * _shopFlag_animSpeedMult),
											FadeIn(200 * _shopFlag_animSpeedMult)
										)
									);
								"
							/>
						</panel>

						<!-- Right Tree Image -->
						<panel x="-37%" y="0.7%" width="7%" align="right" noclick="true">
							<image width="100%" height="100%" valign="center" align="left" texture="/ui/common/new_shop_interface/tree_right_4_black.tga" noclick="true" group="recipeBranchImages"
								watch="storeAlphaUpdate" ontrigger="##SetColor('1 1 1 ' # (param / 100));##"
								onevent="
									If(
										(
											!_buildupGroupValid0 and
											!_buildupGroupValid1 and
											!_buildupGroupValid2 and
											!_buildupGroupValid3
										) or (
											!StringEquals(_buildupGroupValid0, _buildupGroupValidOld0) or
											!StringEquals(_buildupGroupValid1, _buildupGroupValidOld1) or
											!StringEquals(_buildupGroupValid2, _buildupGroupValidOld2) or
											!StringEquals(_buildupGroupValid3, _buildupGroupValidOld3)
										),
										SlideX('-5h', 200 * _shopFlag_animSpeedMult),
										FadeOut(200 * _shopFlag_animSpeedMult)
									);
								"
								onevent0="
									If(
										(_buildupGroupValid0 or _buildupGroupValid1 or _buildupGroupValid2 or _buildupGroupValid3),
										Split(
											If(
												_buildupGroupValid3,
												SetTexture('/ui/common/new_shop_interface/tree_right_4_black.tga'),
												If(
													_buildupGroupValid2,
													SetTexture('/ui/common/new_shop_interface/tree_right_3_black.tga'),
													If(
														_buildupGroupValid1,
														SetTexture('/ui/common/new_shop_interface/tree_right_2_black.tga'),
														SetTexture('/ui/common/new_shop_interface/tree_right_1_black.tga')
													)
												)
											),
											SlideX(0, 200 * _shopFlag_animSpeedMult),
											FadeIn(200 * _shopFlag_animSpeedMult)
										)
									);
								"
							/>
						</panel>

						<!-- Center Item Background Isolated -->
						<image y="-2%" x="32.2%" visible="1" width="35%" height="142%" valign="center" texture="/ui/common/new_shop_interface/shop_tree_body_center_new.tga" noclick="true" watch="storeAlphaUpdate" ontrigger="##SetColor('1 1 1 ' # (param / 100));##"/>
						
						<!-- Sub-components / Initial Components -->
						<panel y="2.5%" width="36.4%" align="left" noclick="true" onload="CreateInt('component_tree_baseY', GetAbsoluteY());" name="component_tree_parent" onevent="Set('component_tree_baseY', GetAbsoluteY());">
							<instance name="tree_component_base" y="0%"  rowIndex="0" slotInit="0" slotSubA="8" slotSubB="9" slotSubC="10" slotSubD="11" 	itemY4="0"		itemY3="7%" 	itemY2="13%" 	itemY1="37%" />
							<instance name="tree_component_base" y="25%" rowIndex="1" slotInit="1" slotSubA="16" slotSubB="17" slotSubC="18" slotSubD="19" 	itemY4="25%" 	itemY3="37%" 	itemY2="60%" 	itemY1="0" />
							<instance name="tree_component_base" y="50%" rowIndex="2" slotInit="2" slotSubA="24" slotSubB="25" slotSubC="26" slotSubD="27" 	itemY4="50%" 	itemY3="67%" 	itemY2="0" 		itemY1="0" />
							<instance name="tree_component_base" y="75%" rowIndex="3" slotInit="3" slotSubA="32" slotSubB="33" slotSubC="34" slotSubD="35"	itemY4="75%" 	itemY3="0" 		itemY2="0" 		itemY1="0" />
						</panel>

						<!-- Second Tier Buildups / Initial Buildups  -->
						<panel y="2.5%" width="36.4%" align="right" noclick="true" onload="CreateInt('buildup_tree_baseY', GetY());">
							<instance name="tree_buildup_base" 	 y="0"   rowIndex="0" slotInit="72" slotSubA="80" slotSubB="81" slotSubC="82" slotSubD="83" 		itemY4="0"		itemY3="7%" 	itemY2="13%" 	itemY1="37%" />
							<instance name="tree_buildup_base" 	 y="25%" rowIndex="1" slotInit="73" slotSubA="88" slotSubB="89" slotSubC="90" slotSubD="91" 		itemY4="25%" 	itemY3="37%" 	itemY2="60%" 	itemY1="0" />
							<instance name="tree_buildup_base" 	 y="50%" rowIndex="2" slotInit="74" slotSubA="96" slotSubB="97" slotSubC="98" slotSubD="99" 		itemY4="50%" 	itemY3="67%" 	itemY2="0" 		itemY1="0" />
							<instance name="tree_buildup_base" 	 y="75%" rowIndex="3" slotInit="75" slotSubA="104" slotSubB="105" slotSubC="106" slotSubD="107" 	itemY4="75%" 	itemY3="0" 		itemY2="0" 		itemY1="0" />
						</panel>

						<!-- Current Active Recipe -->
						<panel width="14.5%" align="center" noclick="true">							
								
							<!-- Name -->
							<panel y="0.5%" width="120%" height="20%" align="center">
								<label height="100%" wrap="true" textalign="center" textvalign="center" color="white" shadow="true" font="dyn_9" watch="updateRecipeDisplay" ontrigger="SetText(_storeRecipeCurTitle);" group="activeRecipeGroup" onevent4="If(!StringEquals(_storeRecipeCurEntity, _storeRecipeOldEntity), FadeOut(200 * _shopFlag_animSpeedMult));" onevent5="If(!IsVisible(), FadeIn(200 * _shopFlag_animSpeedMult));"/>
							</panel>
							
							<!-- Cost -->
							<panel grow="true" height="7%" x="-5.5%" y="3%" align="center" valign="bottom" float="right" padding="0.2h" noclick="true" watch="updateRecipeDisplay" group="activeRecipeGroup" onevent4="If(!StringEquals(_storeRecipeCurEntity, _storeRecipeOldEntity), FadeOut(200 * _shopFlag_animSpeedMult));" onevent5="If(!IsVisible(), FadeIn(200 * _shopFlag_animSpeedMult));">
								<label fitx="true" height="1.75h" color="#FFCC00" shadow="true" font="dyn_10" align="center" content="Cost:" watch="updateRecipeDisplay" ontrigger="SetText('Cost:^w ' # _storeRecipeCurCost);" group="activeRecipeGroup" onevent4="If(!StringEquals(_storeRecipeCurEntity, _storeRecipeOldEntity), FadeOut(200 * _shopFlag_animSpeedMult));" onevent5="If(!IsVisible(), FadeIn(200 * _shopFlag_animSpeedMult));"/>
								<panel height="1.75h" width="1.4h" noclick="true">
									<image texture="/ui/fe2/store/gold_coins.tga" width="100%" height="100@" valign="center" noclick="true" />
								</panel>
							</panel>
							
							<!-- Big Icon -->
							<panel x="1%" y="27.5%" width="52@" height="52%">
								<instance name="shop_recipe_item_button"/>
							</panel>							
							
						</panel>
						
						<panel noclick="true" color="invisible" watch="instantiateRecipeTransition"

							ontrigger="
								Instantiate(
									'componentIconPlaceholder',
									'sourceIndex', param0,
									'x', param1,
									'y', param2,
									'width', param3,
									'height', param4,
									'targIndex', param5,
									'targX', param6,
									'targY', param7,
									'targWidth', param8,
									'targHeight', param9
								);
							"
							watch1="InstantiateRecipeIconTrans"
							ontrigger1="
								Instantiate(
									'recipeIconPlaceholder',
									'sourceWatch', param0,
									'sourceIndex', param1,
									'x', param2,
									'y', param3,
									'width', param4,
									'height', param5,
									'targWatch', param6,
									'targIndex', param7,
									'targX', param8,
									'targY', param9,
									'targWidth', param10,
									'targHeight', param11
								);
							"
						/>			
					</panel>
				</panel>


	<!--			<image name="boot_body_background" y="0" width="104.0h" height="26.0h" texture="/ui/common/new_shop_interface/boots_tree_background.tga" noclick="true" visible="0" watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (param / 100));"
					watch1="setRecipeViewStyle"
					ontrigger1="
						If(
							param == 0,
							DoEvent(1),
							DoEvent(0)
						);
					"
					
					onevent0="
						FadeIn(150 * _shopFlag_animSpeedMult);
					"
					onevent1="
						FadeOut(150 * _shopFlag_animSpeedMult);
					"
				/> -->
				<!-- Boots display -->
				<panel y="50.2%" width="94%" height="111.1%" noclick="true" visible="true"
					onload="
						##
							CreateString('_storeRecipeCurEntity', '');
							CreateString('_storeRecipeCurTexture', '');
							CreateBool('_storeRecipeCurIsRecipe', false);
							CreateBool('_storeRecipeCurRecipeOverlay', false);
							CreateBool('_storeRecipeCurAvailable', false);
							CreateBool('_storeRecipeCurToStash', false);
							CreateBool('_storeRecipeCurOwnLocal', false);
							CreateBool('_storeRecipeCurOwnRemote', false);
							CreateBool('_storeRecipeCurRecommended', false);
						##
					"
					name="extendedRecipe"
					watch="setRecipeViewStyle"
					ontrigger="
						If(
							param == 0,
							DoEvent(1),
							DoEvent(0)
						);
					"
					
					onevent0="
						FadeIn(150 * _shopFlag_animSpeedMult);
					"
					onevent1="
						FadeOut(150 * _shopFlag_animSpeedMult);
					"
				>				
				
					
					<!-- Selected Item(Top) -->
					<panel height="40%" width="100%" noclick="true">
					
						<!-- Name / Cost / Buy -->
						<panel align="left" width="39%" noclick="true">
							<label y="0.12%" fity="true" width="100%" textalign="center" font="dyn_14" color="1 1 1 1" shadow="true" noclick="true" watch="updateRecipeDisplay" ontrigger="SetText(_storeRecipeCurTitle);" group="activeRecipeGroup" onevent4="If(!StringEquals(_storeRecipeCurEntity, _storeRecipeOldEntity), FadeOut(200 * _shopFlag_animSpeedMult));" onevent5="If(!IsVisible(), FadeIn(200 * _shopFlag_animSpeedMult));" />							
							<panel grow="true" x="-17%" y="30%" height="30%" align="center" float="right" padding="0.2h" noclick="true" watch="updateRecipeDisplay" group="activeRecipeGroup" onevent4="If(!StringEquals(_storeRecipeCurEntity, _storeRecipeOldEntity), FadeOut(200 * _shopFlag_animSpeedMult));" onevent5="If(!IsVisible(), FadeIn(200 * _shopFlag_animSpeedMult));">
								<label fitx="true" height="100%" color="#FFCC00" shadow="true" font="dyn_10" align="center" content="Total Cost:" watch="updateRecipeDisplay" ontrigger="SetText('Total Cost:^w ' # _storeRecipeCurCost);" group="activeRecipeGroup" onevent4="If(!StringEquals(_storeRecipeCurEntity, _storeRecipeOldEntity), FadeOut(200 * _shopFlag_animSpeedMult));" onevent5="If(!IsVisible(), FadeIn(200 * _shopFlag_animSpeedMult));"/>
								<panel height="100%" width="20%" noclick="true">
									<image texture="/ui/fe2/store/gold_coins.tga" width="100%" height="100@" valign="center" noclick="true" />
								</panel>
							</panel>
							<instance
								name="button2"
								y="-0.12%"
								width="50%" height="30%"
								align="center" valign="bottom"
								label="game_shop_label_buyremaining"
								onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav');"
								onclick="PurchaseRemainingComponents(GetActiveRecipe()));"
								watch="updateRecipeDisplay"
								ontrigger="
									If(
										_storeRecipeCurIsRecipe,
										If(
											!IsVisible(),
											FadeIn(200 * _shopFlag_animSpeedMult)
										),
										If(
											IsVisible(),
											FadeOut(200 * _shopFlag_animSpeedMult)
										)
									);
								"
							/>
						</panel>
						
						<!-- Icon -->
						<panel y="-20.5%" width="100@" height="100%" align="center" noclick="true">
							<instance name="shop_recipe_item_button"/>
						</panel>
						
						<!-- Description -->
						<panel align="right" width="39%" noclick="true">							
							<panel width="55%" height="70%" align="center" float="bottom" noclick="true">
								<label fity="true" valign="center" font="dyn_10" wrap="true" color="1 1 1 1" shadow="true" content="" watch="updateRecipeDisplay" ontrigger="SetText(_storeRecipeCurDesc);" group="activeRecipeGroup" onevent4="If(!StringEquals(_storeRecipeCurEntity, _storeRecipeOldEntity), FadeOut(200 * _shopFlag_animSpeedMult));" onevent5="If(!IsVisible(), FadeIn(200 * _shopFlag_animSpeedMult));" />
							</panel>							
						</panel>
					
					</panel>
				
					<!-- Tree Texture -->
					<panel y="32%" x="-25.1%" width="150%" height="25%" noclick="true">
						<image width="100%" height="100%" align="center" texture="/ui/common/new_shop_interface/boots_bar.tga" noclick="true"/>
					</panel>
					
					<!-- Build-up Display -->
					<panel y="38%" width="100%" noclick="true">
						<instance name="boot_tree_item" itemIndex="72" slotIndex="0" slideX8="-7%" slideX7="-7%" slideX6="-40%" slideX5="-40%" />
						<instance name="boot_tree_item" itemIndex="73" slotIndex="1" slideX8="-5%" slideX7="-4.6%" slideX6="-24%" slideX5="-20%" />
						<instance name="boot_tree_item" itemIndex="74" slotIndex="2" slideX8="-3%" slideX7="-2.3%" slideX6="-8%" slideX5="0" />
						<instance name="boot_tree_item" itemIndex="75" slotIndex="3" slideX8="-1%" slideX7="0" slideX6="8%" slideX5="20%" />							
						<instance name="boot_tree_item" itemIndex="76" slotIndex="4" slideX8="1%" slideX7="2.3%" slideX6="24%" slideX5="40%" />
						<instance name="boot_tree_item" itemIndex="77" slotIndex="5" slideX8="3%" slideX7="4.6%" slideX6="40%" />
						<instance name="boot_tree_item" itemIndex="78" slotIndex="6" slideX8="5%" slideX7="7%" />
						<instance name="boot_tree_item" itemIndex="79" slotIndex="7" slideX8="7%" />					
					</panel>
					
				</panel>
				
				<instance name="shop_btn_closex" width="1.8h" height="1.8h" x="-44%" y="5%" align="right" valign="top" tip_id="shop_collapse_tree"
					onclick="
						Set('_shopFlag_recipeVisible', false);
						Set('_shopNewRecipeTarget', '');
						Set('_recipeTransitionMode', 0);
						SetActiveRecipe('');
						CallEvent('newStoreController', 0);
					"
				/>
				
				<!-- Tree Area Item catcher
				<panel
					x="1.2h" y="0.8h"
					width="71.2h" height="20.8h"
					color="invisible"
					texture="/ui/common/new_shop_interface/sellback_drop.tga"
					watch="ItemCursorVisible PlayerCanShop"
					ontrigger="SetVisible(ItemCursorVisible and PlayerCanShop); RefreshCursor();"
					rendermode="overlay"					
					onmouseover="
						SetColor('1 1 1 1');						
						Call(
							'tree_body_background',
							'
								##SetColor(\'#a7e9ff\');##
								SetColor(\'0.65 0.91 1 \' # (0.2 + (shopAlphaValue * 0.008)));
							'
						);
						Call(
							'boot_body_background',
							'
								SetColor(\'0.65 0.91 1 \' # (0.2 + (shopAlphaValue * 0.008)));
							'
						);
					"
					onmouseout="
						SetColor('invisible');						
						Call(
							'tree_body_background',
							'
								SetColor(\'1 1 1 \' # (shopAlphaValue / 100));
							'
						);
						Call(
							'boot_body_background',
							'
								SetColor(\'1 1 1 \' # (shopAlphaValue / 100));
							'
						);
						"
					onclick="Sell();"
					onrightclick="Sell();"
				/> -->
			</panel>
			
			<!-- Item / Recipe Listings -->
			<panel
				x="19.1h" y="-1.0h"
				width="35h" height="36.8h"
				align="left" 
				noclick="true"
				visible="true"
			><panel name="shop_body_background" visible="0" noclick="1" />
				<!-- <image width="104.0h" height="13.0h" align="left" valign="top" texture="/ui/common/new_shop_interface/shop_header.tga" noclick="true" />
				<image width="107.8h" height="13.0h" align="left" valign="top" texture="/ui/common/new_shop_interface/shop_header.tga" noclick="true"
					watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (0.3 + (param * 0.007)));"
				/> -->
				<!--<image y="5.2h" width="104.0h" height="52.0h" align="left" valign="top" texture="/ui/common/new_shop_interface/shop_body.tga" noclick="true" />-->
				<!--
				<image name="shop_body_background" y="5.2h" width="107.8h" height="52.0h" align="left" valign="top" texture="/ui/common/new_shop_interface/shop_body.tga" noclick="true" watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (param / 100));"/>
				-->
		<!--		<image x="75.5h" y="-40h" width="7h" height="95.0h" align="left" valign="top" texture="/ui/common/new_shop_interface/Scrollbar_Panel.tga" noclick="true" visible="false"
					name="shop_scroll_backer"
					onevent0="
						If(
							!IsVisibleSelf(),
							FadeIn(200 * _shopFlag_animSpeedMult)
						);
						
					"
					onevent1="
						If(
							IsVisibleSelf(),
							FadeOut(200 * _shopFlag_animSpeedMult)							
						);
						
					"
					onevent2="
						If(
							!IsVisibleSelf(),
							SetVisible(true)
						);
					"
					onevent3="
						If(
							IsVisibleSelf(),
							SetVisible(false)							
						);
					"
				/>
				<image x="37.4h" y="5.4h" width="1.25h" height="1.25h" texture="/ui/common/new_shop_interface/gem.tga" noclick="true" />
		 -->		<scrollbar
					onload="
						CreateInt('_shopScrollMax', 1);
						CreateInt('_shopScrollMinID', 0);
						CreateInt('_shopScrollMaxID', 0);
						CreateBool('_storeInstantTransition', true);
						CreateBool('_useShopScroll', true);
					"
					visible="true"
					align="right" width="2h" height="-2h" x="1.9h" y="6h"
					texture="/ui/info/newstoreslider.tga"
					minvalue="6"
					maxvalue="10"
					onslide="
						If(
							_useShopScroll,
							DoEvent(7),
							Set('_useShopScroll', true)
						);
					"
					handlewidth="2h"
					handleheight="2h"
					step="1"
					value="6"
					vertical="true"
					slotwidth="0.6h" slotheight="1"
					name="shopItemScrollbar"
					onevent0="
						If(
							!IsVisibleSelf(),
							FadeIn(200 * _shopFlag_animSpeedMult)
						);
						
					"
					onevent1="
						If(
							IsVisibleSelf(),
							FadeOut(200 * _shopFlag_animSpeedMult)							
						);
						
					"
					onevent2="
						If(
							!IsVisibleSelf(),
							SetVisible(true)
						);
					"
					onevent3="
						If(
							IsVisibleSelf(),
							SetVisible(false)							
						);
					"
					onevent4="
						If(
							GetValue() lt _shopScrollMax,
							SetValue(GetValue() + 1)
						);
					"
					onevent5="
						If(
							GetValue() gt 6,
							SetValue(GetValue() - 1)
						);
					"
					onevent6="
						Set('_shopScrollMax', Floor((_lastCurrentShopItems + *('_shopFlag_itemsPerRow' # _shopFlag_itemStyle) - 1) / *('_shopFlag_itemsPerRow' # _shopFlag_itemStyle)));
					
						If(
							_shopFlag_showScroll,
							SetMaxValue(_shopScrollMax),
							SetMaxValue(6)
						);
					"
					onevent7="
					
					
						Set(
							'_shopScrollMinID',
							Ceil(
								(this - 6) *
								(*('_shopFlag_itemsPerRow' # _shopFlag_itemStyle))
							)
						);
						Set(
							'_shopScrollMaxID',
							Ceil(
								(
									this *
									(*('_shopFlag_itemsPerRow' # _shopFlag_itemStyle))
								) - 1
								
							)
						);
						
						Set('_storeInstantTransition', true);
						
						SetShopItemRange(
							_shopScrollMinID,
							_shopScrollMaxID
						);
					"
				/>



				<panel color="invisible" noclick="true"
				onload="
					CreateInt('_recipeTransitionMode', 0);		## Currently 0 is quick, 1 is elaborate (components) ##
				"
				watch0="shopComponentAnimStep0"
				ontrigger0="
					GroupCall('rCompVarHolders', 'DoEvent();');				## Store old component data ##
					CallEvent('shopActiveRecipeButton', 3);					## Store old active recipe data ##
					GroupCall('recipeComponentItemIcons', 'DoEvent(6);');
					SetActiveRecipe(_shopNewRecipeTarget);					## Set active recipe/new data vars are set (RecipeSequence triggers after this completes) ##
				"
				watch1="RecipeSequence"
				ontrigger1="
					Set('_shopNewRecipeTarget', GetActiveRecipe());
					CallEvent('purchase_components_popup', 1);
					Trigger(
						'setRecipeViewStyle',
						If(
							_storeCompCurValid76,
							1,0
						)
					);
					
					
					If(
						_storeCompCurValid76,
						Set('_recipeTransitionMode', 0)
					);
					
					GroupCall('activeRecipeGroup', 'DoEvent(4);');
					If(
						!_storeCompCurValid76,
						Trigger('componentReadTree')								## Vars per row for components/buildups are set to indicate whether or not to display 4, 3, 2, or 1 rows ##
					);
					
					If(
						!_storeCompCurValid76,
						Trigger('componentApplyTreeAnim')							## Based on the prior line, the rows animate into the appropriate position ##
					);
					
					If(
						!_storeCompCurValid76,
						CallEvent('component_tree_parent')							## Updates the parent container Y to account for any dragging (required for placeholders to be in a non-fullscreen child widget - allows them to follow dragging) ##
					);
					
					If(
						!_storeCompCurValid76,
						GroupCall('recipe_tree_labels', 'DoEvent();')				## Triggers the visibility of the builds into/components labels ##
					);
					
					
					If(
						_recipeTransitionMode == 1 and !_storeCompCurValid76,
						GroupCall('recipeComponentItemIcons', 'DoEvent(5);')
					);
					If(
						_recipeTransitionMode == 1,
						Split(
							If(
								!_storeCompCurValid76,
								GroupCall('recipeComponentItemIcons', 'DoEvent(3);')
							),
							If(
								!_storeCompCurValid76,
								CallEvent('shopActiveRecipeButton', 2)
							),		## Get ready to spawn placeholder if necessary ##
							If(
								!_storeCompCurValid76,
								GroupCall('recipeComponentItemIcons', 'DoEvent(0);'),
								GroupCall('recipeComponentItemIcons2', 'DoEvent(0);')
							)		## Placeholders fade in if match, invalid items without matches fade out, unchanged icons do nothing ##
						),
						Split(
							GroupCall('recipeComponentItemIcons', 'DoEvent(4);'),
							GroupCall('recipeComponentItemIcons2', 'DoEvent(4);')
						)
					);
					
					GroupCall('recipeBranchImages', 'DoEvent();');				## If the branches have changed, fade them out ##
					SleepWidget(200 * _shopFlag_animSpeedMult, 'Trigger(\'shopComponentAnimStep1\');');	## Move to next step (default 200ms later) ## 
				"
				watch2="shopComponentAnimStep1"
				ontrigger2="
					Trigger('updateRecipeDisplay');
					GroupCall('activeRecipeGroup', 'DoEvent(5);');
					If(
						!_storeCompCurValid76,
						GroupCall('recipeComponentItemIcons', 'DoEvent(1);'),
						GroupCall('recipeComponentItemIcons2', 'DoEvent(1);')
					);
					
					If(
						!_storeCompCurValid76,
						GroupCall('recipeBranchImages', 'DoEvent(0);'),				## If the branches aren't visible, get them on the right texture and fade in ##
						GroupCall('boot_tree_items', 'DoEvent();')
					);
					Set('_recipeTransitionMode', 0);
				"
				watch4="cleanRecommendedItemString"
				ontrigger4="
					If(
						!StringEmpty(param1),
						Set(
							'_overrideRecommendedItems',
							_overrideRecommendedItems # If(!StringEmpty(_overrideRecommendedItems), ',', '') # param1
						)
					);
				"
				watch7="RecipeItemRequest"
				ontrigger7="
					Set('_shopNewRecipeTarget', param0);
					Set('_recipeTransitionMode', 0);
					Trigger('shopComponentAnimStep0');
				"
				onevent5="
					Set('_overrideRecommendedItems', 'Item_HomecomingStone');
					ExplodeTrigger('cleanRecommendedItemString', guide_recommendedString, '|');
					OverrideRecommendedItems(_overrideRecommendedItems);
				"
				name="shop_v4_listbox"
				/>
				<panel color="invisible" x="1.5h" y="6.75h" width="-0.1h" height="-3h" onload="" name="shop_v4_itemList" noclick="true"
					onevent0="
						FadeIn(200 * _shopFlag_animSpeedMult);
						
					"
					onevent1="
						If(
							IsVisibleSelf(),
							FadeOut(200 * _shopFlag_animSpeedMult)							
						);
						
					"
					onevent2="
						SetVisible(true);
					"
					onevent3="
						If(
							IsVisibleSelf(),
							SetVisible(false)							
						);
					"
					visible="false"
					onhotkey="
						PlaySound('/shared/sounds/ui/button_close_01.wav');
						Set('_lastShopSearch', '');
						Set('_activeShopFilters', '');
						Trigger('SetShopDisplay', '')
					"
				>
					<!-- Full Item Display -->
					<panel noclick="true" color="0 0 0 .55" >
					
						<panel  x="2.7h" y="11.8h" width="33.8h" height="42.5h" align="center" valign="center" color="0 0 0 0.75" name="shop_popup_noitemsfound" visible="false"
							onevent0="
								If(
									!IsVisibleSelf(),
									FadeIn(200 * _shopFlag_animSpeedMult)
								);
								
							"
							onevent1="
								If(
									IsVisibleSelf(),
									FadeOut(200 * _shopFlag_animSpeedMult)							
								);
								
							"
							onevent2="
								If(
									!IsVisibleSelf(),
									SetVisible(true)
								);
							"
							onevent3="
								If(
									IsVisibleSelf(),
									SetVisible(false)							
								);
							"
							watch="storeAlphaUpdate"
							ontrigger="
								SetColor('0 0 0 ' # (0.25 + (param * 0.005)));
							"
						>
							<frame color="invisible" bordercolor="#455166" borderthickness="1" noclick="1" />
							<!--<instance name="header_bar" width="100%" height="2.8h" lbl="game_shop_noitemsfound_title" lbl_font="dyn_11" show_close="0" onclick="" />-->
							
							<panel height="2.8h"
								
							>
								<panel width="100%" height="100%" >
									<image align="center" width="-64"
										texture="/ui/info/header_bar_c.tga"
										watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (0.25 + (param * 0.0075)));"
									/>
									<image height="50%" width="32" align="left" valign="top" texture="/ui/info/header_bar_tl.tga" noclick="1"
										watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (0.25 + (param * 0.0075)));"									
									/>
									<image height="50%" width="32" align="left" valign="bottom" texture="/ui/info/header_bar_bl.tga" noclick="1"
										watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (0.25 + (param * 0.0075)));"
									/>
									<image height="50%" width="32" align="right" valign="top" texture="/ui/info/header_bar_tr.tga" noclick="1"
										watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (0.25 + (param * 0.0075)));"
									/>
									<image height="50%" width="32" align="right" valign="bottom" texture="/ui/info/header_bar_br.tga" noclick="1"
										watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (0.25 + (param * 0.0075)));"
									/>		
								</panel>
								<label textvalign="center" width="-1h" x="0.5h" font="dyn_11" color="white" shadow="true" content="game_shop_noitemsfound_title"/>
								<frame color="invisible" bordercolor="#455166" borderthickness="1" noclick="1" />
							</panel>
							
							<panel height="-13.25h" y="3.25h">
							
								<panel width="100@" height="100%" align="center">
									<image texture="/heroes/dwarf_magi/icon.tga"
										watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (0.50 + (param * 0.005)));"
									/>
									<frame color="invisible" bordercolor="#455166" borderthickness="1" noclick="1" />
								</panel>
							</panel>
							
							<panel valign="bottom" height="10h">
								<panel width="-1h" height="-1h" valign="center" align="center" color="black"
									watch="storeAlphaUpdate"
									ontrigger="
										SetColor('0 0 0 ' # (0.25 + (param * 0.0075)));
									"
								>
									<frame color="invisible" bordercolor="#455166" borderthickness="1" noclick="1" />
									<panel width="-1h" height="-1h" valign="center" align="center" float="bottom" padding="0.75h">
										<label font="dyn_10" color="white" wrap="true" width="100%" fity="true" content="game_shop_noitemsfound1"/>
										<label font="dyn_10" color="#FFCC00" wrap="true" width="100%" fity="true" content="game_shop_noitemsfound2"/>
										
									</panel>
								</panel>
							</panel>
						</panel>
					
						<instance name="shop_v4_item2" index="0" reportRowY="0"/>
						<instance name="shop_v4_item2" index="1"/>
						<instance name="shop_v4_item2" index="2"/>
						<instance name="shop_v4_item2" index="3" reportRowY="1"/>
						<instance name="shop_v4_item2" index="4"/>
						<instance name="shop_v4_item2" index="5"/>
						<instance name="shop_v4_item2" index="6" reportRowY="2"/>
						<instance name="shop_v4_item2" index="7"/>
						<instance name="shop_v4_item2" index="8"/>
						<instance name="shop_v4_item2" index="9" reportRowY="3"/>
						<instance name="shop_v4_item2" index="10"/>
						<instance name="shop_v4_item2" index="11"/>
						<instance name="shop_v4_item2" index="12" reportRowY="4"/>
						<instance name="shop_v4_item2" index="13"/>
						<instance name="shop_v4_item2" index="14"/>
						<instance name="shop_v4_item2" index="15" reportRowY="5"/>
						<instance name="shop_v4_item2" index="16"/>
						<instance name="shop_v4_item2" index="17"/>
						<instance name="shop_v4_item2" index="18"/>
						<instance name="shop_v4_item2" index="19"/>
						<instance name="shop_v4_item2" index="20"/>
						<instance name="shop_v4_item2" index="21"/>
						<instance name="shop_v4_item2" index="22"/>
						<instance name="shop_v4_item2" index="23"/>
						<instance name="shop_v4_item2" index="24"/>
						<instance name="shop_v4_item2" index="25"/>
						<instance name="shop_v4_item2" index="26"/>
						<instance name="shop_v4_item2" index="27"/>
						<instance name="shop_v4_item2" index="28"/>
						<instance name="shop_v4_item2" index="29"/>
						<instance name="shop_v4_item2" index="30"/>
						<instance name="shop_v4_item2" index="31"/>
						<instance name="shop_v4_item2" index="32"/>
						<instance name="shop_v4_item2" index="33"/>
						<instance name="shop_v4_item2" index="34"/>
						<instance name="shop_v4_item2" index="35"/>
						<instance name="shop_v4_item2" index="36"/>
						<instance name="shop_v4_item2" index="37"/>
						<instance name="shop_v4_item2" index="38"/>
						<instance name="shop_v4_item2" index="39"/>
						<instance name="shop_v4_item2" index="40"/>
						<instance name="shop_v4_item2" index="41"/>
						<instance name="shop_v4_item2" index="42"/>
						<instance name="shop_v4_item2" index="43"/>
						<instance name="shop_v4_item2" index="44"/>
						<instance name="shop_v4_item2" index="45"/>
						<instance name="shop_v4_item2" index="46"/>
						<instance name="shop_v4_item2" index="47"/>
						<instance name="shop_v4_item2" index="48"/>
						<instance name="shop_v4_item2" index="49"/>
						<instance name="shop_v4_item2" index="50"/>
						<instance name="shop_v4_item2" index="51"/>
						<instance name="shop_v4_item2" index="52"/>
						<instance name="shop_v4_item2" index="53"/>
						<instance name="shop_v4_item2" index="54"/>
						<instance name="shop_v4_item2" index="55"/>
						<instance name="shop_v4_item2" index="56"/>
						<instance name="shop_v4_item2" index="57"/>
						<instance name="shop_v4_item2" index="58"/>
						<instance name="shop_v4_item2" index="59"/>

					</panel>

					<!-- Simple Item Display -->
					<panel noclick="true" visible="true"  x="0.5h" y="0.2h">
					
						<!--
							X adds 
						-->
						
						
						<instance name="shop_v4_item_simple" index="0" reportRowY="0"/>
						<instance name="shop_v4_item_simple" index="1"/>
						<instance name="shop_v4_item_simple" index="2"/>
						<instance name="shop_v4_item_simple" index="3"/>
						<instance name="shop_v4_item_simple" index="4"/>
						<instance name="shop_v4_item_simple" index="5" reportRowY="1"/>
						<instance name="shop_v4_item_simple" index="6"/>
						<instance name="shop_v4_item_simple" index="7"/>
						<instance name="shop_v4_item_simple" index="8"/>
						<instance name="shop_v4_item_simple" index="9"/>
						<instance name="shop_v4_item_simple" index="10" reportRowY="2"/>
						<instance name="shop_v4_item_simple" index="11"/>
						<instance name="shop_v4_item_simple" index="12"/>
						<instance name="shop_v4_item_simple" index="13"/>
						<instance name="shop_v4_item_simple" index="14"/>
						<instance name="shop_v4_item_simple" index="15" reportRowY="3"/>
						<instance name="shop_v4_item_simple" index="16"/>
						<instance name="shop_v4_item_simple" index="17"/>
						<instance name="shop_v4_item_simple" index="18"/>
						<instance name="shop_v4_item_simple" index="19"/>
						<instance name="shop_v4_item_simple" index="20" reportRowY="4"/>
						<instance name="shop_v4_item_simple" index="21"/>
						<instance name="shop_v4_item_simple" index="22"/>
						<instance name="shop_v4_item_simple" index="23"/>
						<instance name="shop_v4_item_simple" index="24"/>
						<instance name="shop_v4_item_simple" index="25" reportRowY="5"/>
						<instance name="shop_v4_item_simple" index="26"/>
						<instance name="shop_v4_item_simple" index="27"/>
						<instance name="shop_v4_item_simple" index="28"/>
						<instance name="shop_v4_item_simple" index="29"/>
						<instance name="shop_v4_item_simple" index="30" reportRowY="6"/>
						<instance name="shop_v4_item_simple" index="31"/>
						<instance name="shop_v4_item_simple" index="32"/>
						<instance name="shop_v4_item_simple" index="33"/>
						<instance name="shop_v4_item_simple" index="34"/>
						<instance name="shop_v4_item_simple" index="35" reportRowY="7"/>/>
						<instance name="shop_v4_item_simple" index="36"/>
						<instance name="shop_v4_item_simple" index="37"/>
						<instance name="shop_v4_item_simple" index="38"/>
						<instance name="shop_v4_item_simple" index="39"/>
						<instance name="shop_v4_item_simple" index="40"/>
						<instance name="shop_v4_item_simple" index="41"/>
						<instance name="shop_v4_item_simple" index="42"/>
						<instance name="shop_v4_item_simple" index="43"/>
						<instance name="shop_v4_item_simple" index="44"/>
						<instance name="shop_v4_item_simple" index="45"/>
						<instance name="shop_v4_item_simple" index="46"/>
						<instance name="shop_v4_item_simple" index="47"/>
						<instance name="shop_v4_item_simple" index="48"/>
						<instance name="shop_v4_item_simple" index="49"/>
						<instance name="shop_v4_item_simple" index="50"/>
						<instance name="shop_v4_item_simple" index="51"/>
						<instance name="shop_v4_item_simple" index="52"/>
						<instance name="shop_v4_item_simple" index="53"/>
						<instance name="shop_v4_item_simple" index="54"/>
						<instance name="shop_v4_item_simple" index="55"/>
						<instance name="shop_v4_item_simple" index="56"/>
						<instance name="shop_v4_item_simple" index="57"/>
						<instance name="shop_v4_item_simple" index="58"/>
						<instance name="shop_v4_item_simple" index="59"/>
						
					</panel>					
					
					<panel processonlyscroll="true" color="invisible" name="shopScrollCatcher"
						hover="false"
						onmousewheeldown="
							CallEvent('shopItemScrollbar', 4);
						"
						onmousewheelup="
							CallEvent('shopItemScrollbar', 5);
						"
						onevent0="
							If(
								!IsVisibleSelf(),
								SetVisible(true)
							);
							
						"
						onevent1="
							If(
								IsVisibleSelf(),
								SetVisible(false)
							);
							
						"
					/>
				</panel>
				
				
				<!-- stolenBackground -->
				<image name="shop_body_guide_bg" y="9.7h" width="65.8h" height="47.5h" align="left" valign="top"
				texture="/ui/common/new_shop_interface/shop_body_half.tga" noclick="true" 
				watch="storeAlphaUpdate" ontrigger="SetColor('1 1 1 ' # (param / 100));"
					visible="0"
					 />
				<frame 
					x="1.8h" y="10.8h"
					width="43.5h" height="38.3h"
					name="design_frame_hero_guide" 
					borderthickness="0.7h" texture="/ui/common/new_shop_interface/simple_border.tga"  noclick="true"
					onload="BringToFront();"
					onevent1="
						If( 
							IsVisibleSelf(),
								FadeOut(200 * _shopFlag_animSpeedMult)
						);
						
					"
					onevent2="
						SetVisible(true);
					"
					onevent3="
						If(
							IsVisibleSelf(),
								SetVisible(false)
						);
					"
					
					/>	 
				<panel noclick="1"
					name="hero_guide"
					x="2.0h" y="10.8h"  color="0 0 0 .55"
					width="43.3h" height="38.2h"
					float="bottom" padding="1.0h"
					visible="false"
					onevent0="
						FadeIn(200 * _shopFlag_animSpeedMult);
						
					"
					onevent1="
						If(
							IsVisibleSelf(),
							Split(
								FadeOut(200 * _shopFlag_animSpeedMult),
								CallEvent('design_frame_hero_guide', 1)
							)
						);
						
					"
					onevent2="
						SetVisible(true);
							CallEvent('design_frame_hero_guide', 2);
					"
					onevent3="
						If(
							IsVisibleSelf(),
							Split(
								SetVisible(false),
								CallEvent('design_frame_hero_guide', 3)
							)
						);
					"
				>
				<panel float="right" padding="1.0h" >
					<!-- Recommended Items -->
					<panel noclick="1"
						name="guide_main_recommended_panel"
						width="12.08h"
						float="bottom"
						padding="1.2h"
						onshow="DoEvent();"
						onevent="Trigger('GuideRecommendedEvent');"
					>
						<instance name="guide_recommended" panel="1" phaseName="game_guide_reco_1" tip_id="shop_guide_reco_1_tip" watch="GuideInfoFormResultExplodeItemsStart" />
						<instance name="guide_recommended" panel="2" phaseName="game_guide_reco_2" tip_id="shop_guide_reco_2_tip" watch="GuideInfoFormResultExplodeItemsLaning" />
						<instance name="guide_recommended" panel="3" phaseName="game_guide_reco_3" tip_id="shop_guide_reco_3_tip" watch="GuideInfoFormResultExplodeItemsCore"  />
						<instance name="guide_recommended" panel="4" phaseName="game_guide_reco_4" tip_id="shop_guide_reco_4_tip" watch="GuideInfoFormResultExplodeItemsLux"  />
					</panel>
					
					<!-- Guide Text -->
					<panel noclick="1"
						width="30h" float="bottom" padding="1.2h" 
					>
						<!-- Intro -->
						<panel padding="1h" height="12.5h" align="center"  noclick="1">
							<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="0 .08 0 .8"  noclick="1" />
							<frame texture="/ui/frames/roundframe.tga" color="#58805e" borderthickness="0.4h"  noclick="1" />
							<label y="0.6h" width="-1.8h" height="2.4h" align="center" font="dyn_14" color="#8aff81" content="game_guide_label_intro" outline="true"  noclick="1" />
							<label y="1.2h" x="-0.3h" width="10h" height="2.4h" textalign="right" align="right" font="dyn_9" color="#C8FE2E" content="game_guide_label_premium" outline="true"  noclick="1" visible="0"
								watch0="GuideInfoFormResult GuideInfoFormResultLocal"
								ontrigger0="	
								If((GuideInfoFormStatus == 2  and (guide_masterQueryTime == param17) and param20) or param19, 
									SetVisible(param21)
								);								
								"							
							/>
							<textbuffer y="3.0h" width="-1.8h" height="-4.4h" align="center" valign="top" font="dyn_9" color="invisible" wrap="true" shadow="1" shadowcolor="black" noclick="0"
								group="guide_label_group"
								watch4="GuideTextClear" ontrigger4="SetBufferText('');"
								watch3="GuideLabelEvent"
								ontrigger3="##If(IsVisible(), DoEvent());## SetBufferText(NormalizeLineBreaks(guide_currentIntroString));"
								content=""							
								watch0="GuideInfoFormResult GuideInfoFormResultLocal"
								ontrigger0="
								SetBufferText(NormalizeLineBreaks(param10));
								Set(guide_currentIntroString, param10);
								If(GetStringWrapHeight('dyn_9', NormalizeLineBreaks(param10), GetWidth()) gt GetHeight(), SetNoClick(0), SetNoClick(1));
								## If((GuideInfoFormStatus == 2  and (guide_masterQueryTime == param17) and param20) or param19, 							
									Split(										
										ClearBufferText(),
										Set(guide_currentIntroString, param10),
										If(GetStringWrapHeight('dyn_9', param10, GetWidth()) gt GetHeight(), SetNoClick(0), SetNoClick(1))
									)
								); ##							
								"						
								onshow="##DoEvent();##"
								onevent="
								If(GuideInfoFormStatus == 2,
									If(StringLength(guide_currentIntroString) lt 100, 
										SetBufferText(NormalizeLineBreaks(guide_currentIntroString)),
										Split(
											CreateLerp('GuideIntroTextLerp', StringLength(guide_currentIntroString), guide_lerptime * _shopFlag_animSpeedMult, 0, 1),
											SleepWidget(guide_lerptime * _shopFlag_animSpeedMult, 'CreateLerp(\'GuideIntroTextLerp\', 0, 1, 0, -1)')
										)
									)
								);
								"
								watch1="GuideIntroTextLerpTrigger"
								ontrigger1="
									If(param gt 0,
										SetBufferText(
											NormalizeLineBreaks(SubString(guide_currentIntroString, 0, param-15)#'^751'#SubString(guide_currentIntroString, param-15, 15))
										),
										SetBufferText(NormalizeLineBreaks(guide_currentIntroString))
									);
								"	
								scrolltexture="/ui/info/combobox.tga"
								handleheight="1.8h"
								scrollbarsize="1.8h"
								scrollbarplaceholder="false"
								exteriorscrollbars="false"
								textalign="left"
								onchange="If(StringEmpty(this), Call('guide_no_content_error', 'DoEvent(0);'), Call('guide_no_content_error', 'DoEvent(1);')  );"
								textcolor="white"									
							/>			
					
							<!-- Last Modified -->
							<label height="100%" textvalign="top" textalign="right" font="dyn_9" color=".7 .7 .7 1" noclick="true" content="" shadow="1" shadowcolor="black"
								watch0="GuideInfoFormResult GuideInfoFormResultLocal"
								ontrigger0="	
								If((GuideInfoFormStatus == 2  and (guide_masterQueryTime == param17) and param20) or param19, 
									If(StringLength(param12) ge 6, SetText('^951'#Translate('guide_last_updated')#':  ^777'#SubString(param12, 0, 8)#''))
								);								
								"											
							/>	
						</panel>
						
						<!-- Description -->
						<panel padding="1h" height="17.5h" y="13.5h" align="center" noclick="1" >
							<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.4h" color="0 0 .07 .8"  noclick="1" />
							<frame texture="/ui/frames/roundframe.tga" color="#667788" borderthickness="0.4h"  noclick="1" />
							<label noclick="1"  y="0.6h" width="-1.8h" height="2.4h" align="center" font="dyn_14" color="#83cfff" content="game_guide_label_detailed" outline="true" />
							
							<textbuffer noclick="0" color="invisible"  y="3.0h" width="-1.8h" height="-4.4h" valign="top" align="center" font="dyn_9" wrap="true" content="" shadow="1" shadowcolor="black"
								group="guide_label_group"
								watch4="GuideTextClear" ontrigger4="SetBufferText('');"
								watch3="GuideLabelEvent"
								ontrigger3="##DoEvent();## SetBufferText(NormalizeLineBreaks(guide_currentGuideString));"								
								watch0="GuideInfoFormResult GuideInfoFormResultLocal"
								ontrigger0="														
								SetBufferText(NormalizeLineBreaks(param11));
								Set(guide_currentGuideString, param11);
								If(GetStringWrapHeight('dyn_9', NormalizeLineBreaks(param11), GetWidth()) gt GetHeight(), SetNoClick(0), SetNoClick(1));
								## 
								If((GuideInfoFormStatus == 2  and (guide_masterQueryTime == param17) and param20) or param19, 
									Split(
										Set(guide_currentGuideString, param11),
										If(GetStringWrapHeight('dyn_9', param11, GetWidth()) gt GetHeight(), SetNoClick(0), SetNoClick(1))
									)
								);	
								##
								"							
								onshow="##DoEvent();##"
								onevent="
								If(GuideInfoFormStatus == 2, 
									If(StringLength(guide_currentGuideString) lt 100, 
										SetBufferText(NormalizeLineBreaks(guide_currentGuideString)),									
										Split(
											CreateLerp('GuideMainTextLerp', StringLength(guide_currentGuideString), guide_lerptime * _shopFlag_animSpeedMult, 0, 1),
											SleepWidget(guide_lerptime * _shopFlag_animSpeedMult, 'CreateLerp(\'GuideMainTextLerp\', 0, 1, 0, -1)')
										)
									)
								);
								"
								watch1="GuideMainTextLerpTrigger"
								ontrigger1="
									If(param gt 0,
										SetBufferText(
											NormalizeLineBreaks(SubString(guide_currentGuideString, 0, param-15)#'^751'#SubString(guide_currentGuideString, param-15, 15))
										),
										SetBufferText(NormalizeLineBreaks(guide_currentGuideString))
									);
								"	
								scrollbarplaceholder="false"
								scrolltexture="/ui/info/combobox.tga"
								handleheight="1.8h"
								scrollbarsize="1.8h"
								exteriorscrollbars="false"
								textalign="left"
								textcolor="white"					
							/>				
						</panel>
						
						</panel>
					
				</panel>	
					
					
					<!-- Ability Order -->
					<panel noclick="1" y="31.5h"
						height="6.4h" width="50h" align="top" valign="left"
						visible="true"
						onshow="Trigger('GuideAbilityEvent');"
					>
						<panel name="guide_ability_panel_1" width="49@" height="49.0%" valign="top" align="left" float="right" padding="0.2h"  noclick="1" >
							<instance name="guide_ability_lvl" id="1" />
							<instance name="guide_ability_lvl" id="2" />
							<instance name="guide_ability_lvl" id="3" />
							<instance name="guide_ability_lvl" id="4" />
							<instance name="guide_ability_lvl" id="5" />
							<instance name="guide_ability_lvl" id="6" />
							<instance name="guide_ability_lvl" id="7" />
							<instance name="guide_ability_lvl" id="8" />
							<instance name="guide_ability_lvl" id="9" />
							<instance name="guide_ability_lvl" id="10" />
							<instance name="guide_ability_lvl" id="11" />
							<instance name="guide_ability_lvl" id="12" />
							<instance name="guide_ability_lvl" id="13" />
						</panel>						
						<panel name="guide_ability_panel_2"  width="49@" height="49.0%" valign="bottom" align="left" float="right" padding="0.2h"  noclick="1">
							<instance name="guide_ability_lvl" id="14" />
							<instance name="guide_ability_lvl" id="15" />
							<instance name="guide_ability_lvl" id="16" />
							<instance name="guide_ability_lvl" id="17" />
							<instance name="guide_ability_lvl" id="18" />
							<instance name="guide_ability_lvl" id="19" />
							<instance name="guide_ability_lvl" id="20" />
							<instance name="guide_ability_lvl" id="21" />
							<instance name="guide_ability_lvl" id="22" />
							<instance name="guide_ability_lvl" id="23" />
							<instance name="guide_ability_lvl" id="24" />
							<instance name="guide_ability_lvl" id="25" />		
						</panel>
					</panel>	
					
					<panel noclick="1" y="0" name="guide_thinking_panel" onevent1="SetVisible(0);" onevent2="SetVisible(1);" visible="0" color="0 0 0 0" height="40%" width="40%" valign="center" align="center"
						watch="GuideInfoFormStatus GuideListFormStatus"
						ontrigger="SetVisible(param0 == 1);"
					>
						<frame width="-1.6h" align="center" noclick="true" texture="/ui/frames/rounded_bg_white.tga" borderthickness="6" color="black"/>
						<frame width="-1.6h" align="center" noclick="true" texture="/ui/frames/roundframe.tga" color=".3 .3 .3 1" borderthickness="6"/>					
						<label width="-10.0h" height="100%" y="1h" align="center" textalign="center" textvalign="center" wrap="1" font="dyn_10" color="white" shadow="1" content="Retrieving..." noclick="1"
							onshow="Call('guide_thinking_panel_retry', 'SetVisible(0); SleepWidget(0, \'\'); SleepWidget(1500, \'SetVisible(1);\');'); Call('guide_thinking_panel_cancel', 'SetVisible(0); SleepWidget(0, \'\'); SleepWidget(1500, \'SetVisible(1);\');');"
						/>
						<instance valign="center" y="4.9h"
							name="button2" x="-6.5h" button_name="guide_thinking_panel_retry"
							width="12.0h" height="2.5h"
							align="center"
							label="main_stats_retry"
							font="dyn_10"
							onclick=" CallEvent('guide_thinking_panel', 1); Set(guide_useCache, 0); Set(_guideFlag_loadFailure, 0); Set(guide_newRound, 1); Trigger('GuideHeroName', HeroName);"
						/>			
						<instance
							valign="center" name="button2" y="4.9h" x="15.5h" button_name="guide_thinking_panel_cancel"
							label="general_cancel"
							onclick="CallEvent('guide_thinking_panel', 1);	CallEvent('shopGuideError', 1); "
							enabled="true"
							width="12.0h" height="2.5h"
							font="dyn_10"
						/>					
						<animatedimage y="-5h" x="0h" width="5.5h" height="5.5h" valign="center" align="center" texture="/ui/elements/throb/throb.tga" noclick="true" loop="1" fps="30" onshow="StartAnim(1);" visible="1"  />				
					</panel>
					
				</panel>

				<!-- Space to get the guide errors filled out -->
				<panel noclick="1"
					y="6.8h"
					align="right"
					x="-0.25h"
					width="-1h"
					height="-2h"
					float="right" padding="1.0h"
					visible="true"
					onload="
						CreateString('_guideErrorString', '');
					"
					name="heroGuideErrorDisplay"
					onevent0="
						If(
							!IsVisibleSelf(),
							SetVisible(1)
						);
						
					"
					onevent1="
						If(
							IsVisibleSelf(),
							SetVisible(0)
						);
					"
					
					watch="GuideListFormStatus GuideInfoFormStatus"
					ontrigger="if(param0 == 3, Split(Call('guide_error_popup_label', 'SetText(Translate(\'mstore_error_connect\'));'), CallEvent('shopGuideError', 0)));"					
					
				>
				
					<!-- Error popup and background-darking panel -->
					<panel color="0 0 0 0.75"
						name="shopGuideError"
						visible="false"
						onevent0="FadeIn(150 * _shopFlag_animSpeedMult);"
						onevent1="FadeOut(150 * _shopFlag_animSpeedMult);"
						onshow="CallEvent('guide_thinking_panel', 1);"
					>
						<panel color="0 0 0 0.5" grow="true" regrow="true" width="35h" align="center" valign="center">
							<frame color="invisible" bordercolor="#455166" borderthickness="1" noclick="1" />
							<panel grow="true" regrow="true" width="100%" float="bottom">
								<instance name="header_bar" width="100%" height="2.8h" lbl="mstore_error_generic" lbl_font="dyn_11" show_close="1" onclick="CallEvent('shopGuideError', 1);" />
								<panel height="0.5h"/>

								<panel width="100%" grow="true" regrow="true">
									<panel align="center" width="-1h" grow="true" regrow="true" color="black">
										<frame color="invisible" bordercolor="#455166" borderthickness="1" noclick="1" />
										<panel float="bottom" width="100%" grow="true" regrow="true">
											<panel height="0.5h"/>
											<panel grow="true" regrow="true" width="100%">
												<label name="guide_error_popup_label" fity="true" font="dyn_10" color="white" wrap="true" width="-1h" align="center"
													watch="GuideMasterQuery"
													ontrigger="
														SetWatch(1, param0 # 'Status');
														SetWatch(2, param0 # 'Result');
													"
													ontrigger1="
														If(
															param == 3,
															DoEvent(9)
														);
													"
													ontrigger2="
														If(
															!StringEmpty(param0),
															Set('_guideErrorString', '')
														);
														
														If(
															!StringEmpty(param0),
															ExplodeTrigger('buildGuideErrorString', param0, '|')
														);
														
														If(
															!StringEmpty(param0),
															Split(
																SetText(FormatStringNewLine(_guideErrorString)),
																CallEvent('shopGuideError', 0)
															)
														);
													"
													watch3="buildGuideErrorString"
													ontrigger3="
														Set(
															'_guideErrorString', _guideErrorString #
															If(
																!StringEmpty(_guideErrorString),
																'\\n',
																''
															) #
															Translate(param1)
														)
													"
													onevent9="
														SetText(Translate('mstore_error_connect'));
														CallEvent('shopGuideError', 0);
													"
												/>
											</panel>
											<panel height="0.5h"/>
											<panel height="2.5h">
												<panel align="center" grow="true" height="100%" float="right" padding="1h">

													<instance
														name="button2"
														label="general_retry"
														onclick="
															Set(guide_newRound, 1);
															Trigger('GuideHeroName', HeroName);															
															CallEvent('shopGuideError', 1);
														"
														enabled="true"
														width="7h"
													/>
													<instance
														name="button2"
														label="game_guide_label_getFeatured"
														onclick="
															Trigger('GuideLoadFeatured');
															CallEvent('shopGuideError', 1);
														"
														enabled="true"
														width="14h"
													/>

												</panel>
											</panel>	
											<panel height="0.75h"/>
											<!--
											<panel height="2.5h">
												<panel align="center" grow="true" height="100%" float="right" padding="1h">
													<instance
														name="button2"
														label="general_cancel"
														onclick="
															CallEvent('shopGuideError', 1);
														"
														enabled="true"
														width="8h"
													/>
												</panel>												
												
											</panel>
											<panel height="0.75h"/>
											-->
										</panel>
									</panel>
								</panel>
								
								<panel height="0.5h"/>
							</panel>
						</panel>
					</panel>
				</panel>



































































				
				<!-- Upper Item catcher width="40h" height="36.8h" -->
				<panel
					x="1.6h" y="6.8h"
					width="35h" height="33.8h"
					color="red"
					texture="/ui/common/new_shop_interface/sellback_drop.tga"
					watch="ItemCursorVisible PlayerCanShop"
					ontrigger="SetVisible(ItemCursorVisible and PlayerCanShop); RefreshCursor();"
					rendermode="overlay"					
					onmouseover="
						SetColor('1 1 1 1');
						Call(
							'shop_body_background',
							'
								SetColor(\'0.65 0.91 1 \' # (0.2 + (shopAlphaValue * 0.008)));
							'
						);
						"
					onmouseout="
						SetColor('invisible');						
						Call(
							'shop_body_background',
							'
								SetColor(\'1 1 1 \' # (shopAlphaValue / 100));
							'
						);
					"
					onclick="Sell();"
					onrightclick="Sell();"
				/>
				<!--	<instance 	name="listboxQueue" id="1" onshow="AddTemplateListItemWithSort('labelItem', 0, 0, 'id', 0, 'text', 'label0');"
								x="1.5h" y="1.8h" width="32.0h" height="4.4h"
					/>
					<instance 	name="listboxQueue" id="1" onshow="AddTemplateListItemWithSort('labelItem', 0, 0, 'id', 1, 'text', 'label1');"
								x="1.5h" y="6.7h" width="32.0h" height="4.4h"
					/>
				
					Simple View Checkbox
					This could stand to be a combobox or something later for changing views 
				<panel x="1.5h" y="1.8h" width="16.0h" height="3.4h" color="0 0 0 .55" noclick="true" visible="false"
					name="shopSimpleViewCheckbox"
					onevent0="
						FadeIn(200 * _shopFlag_animSpeedMult);
					"
					onevent1="
						FadeOut(200 * _shopFlag_animSpeedMult);
					"
					onevent2="
						SetVisible(true);
					"
					onevent3="
						SetVisible(false);
					"
				>
					<frame borderthickness="0.7h" texture="/ui/common/new_shop_interface/simple_border.tga" noclick="true"/>				
					
					<instance
						name="Noptions_checkbox"
						checkbox_name="simpleViewCheckbox"
						onevent0="
							SetButtonState(_shopFlag_itemStyle);		## Obviously this won't work with the default states if additional views are added ##
						"
						x="1.0h"
						width="15.0h"
						align="center" valign="center"					
						font="dyn_10" label="game_shop_label_shopview"
						tip_id="shop_simple_view"
						cvar=""
						onclick="
							Set('_shopFlag_itemStyle', this);
							Cmd('setsave _shopFlag_itemStyle ' # _shopFlag_itemStyle);
							Trigger('SetShopDisplay', _lastActiveShop);
						"
						interactive="false"
					/>

				</panel>
				-->
				<!-- Store Header Info  -->
				<panel name="header_store"  x="36.3h" y="5.8h" width="1.8h" height="1.8h" color="invisible" noclick="true" visible="false"
					onevent0="
						FadeIn(200 * _shopFlag_animSpeedMult);
					"
					onevent1="
						FadeOut(200 * _shopFlag_animSpeedMult);
					"
					onevent2="
						SetVisible(true);
					"
					onevent3="
						SetVisible(false);
					"
				>
					<!-- Close Store -->
					<instance name="shop_btn_closex" width="1.8h" height="1.8h" align="right" valign="center" onclick="CloseShop();" />
				</panel>
				
				<!-- Guide Header Info -->
				<panel name="header_guide" x="1.7h" y="6.8h" width="43.5h" height="3.40h" color="0 0 0 .55" noclick="true" visible="true"
				onevent0="
						FadeIn(200 * _shopFlag_animSpeedMult);
					"
					onevent1="
						FadeOut(200 * _shopFlag_animSpeedMult);
					"
					onevent2="
						SetVisible(true);
					"
					onevent3="
						SetVisible(false);
					"
				>
					<frame borderthickness="0.7h" texture="/ui/common/new_shop_interface/simple_border.tga"  noclick="true"/>			
					
					<!-- Guide Selection -->
					<instance name="guidelist_combobox" populate=""
						onload=""
						onselect="If(this gt 0, Set(guide_selectedGuide, this)); If(!guide_auto_selection and !guide_usingLocal, Trigger('GuideLoadGuide'));"
					/>
					<!-- Close Guide/Store -->
					<instance name="shop_btn_closex" width="1.8h" height="1.8h" x="-1.0h" align="right" valign="center" onclick="CloseShop();" />
				</panel>

			</panel>
		

		</panel>
		
	</panel>
	
	<!-- Buy All -->	
	<panel width="30h" grow="true" color="0 0 0 0.5" align="center" valign="center" name="purchase_components_popup" visible="false" cangrab="true"
		onload="
			CreateString('_lastSelectedItemEntity', '');
			CreateInt('_recipeRemainingCost', 0);
		"
		onevent0="
			If(
				shop_confirm_buyall,
				DoEvent(2),
				PurchaseRemainingComponents(_lastSelectedItemEntity)
			);
		"
		onevent2="
			GroupCall('buyall_list_items', 'SetVisible(false);');
			Set('_recipeRemainingCost', 0);
			TriggerRemainingComponents(_lastSelectedItemEntity);
			FadeIn(150);
		"
		onevent1="FadeOut(250);"
		regrow="true"
	>		
		<frame width="107%" height="105%" align="center" valign="center" texture="/ui/frames/squareglow.tga" borderthickness="2.0h" color="0 0 0 .75" noclick="true"/>
		<frame color="0 0 0 .8" bordercolor="#455166" borderthickness="1" noclick="1" />		
		<panel float="bottom" grow="true" width="100%" noclick="true" regrow="true">
			<instance name="header_bar" show_close="true" height="2.5h" lbl="game_shop_label_buyremaining" onclick="CallEvent('purchase_components_popup', 1);"
				watch="RemainingComponentsUpgrade"
				ontrigger="
					If(
						param,
						SetText(Translate('game_shop_label_upgrade')),
						SetText(Translate('game_shop_label_buyremaining'))
					);
				"
			/>			
			<panel height="0.5h"/>			
			<panel grow="true" width="100%" regrow="true">
				<panel width="-1h" align="center" grow="true" regrow="true">				
					<frame texture="/ui/frames/tooltip_bg.tga" color="#2c4b6c" noclick="1"/>
					<frame color="invisible" bordercolor="#455166" borderthickness="1" noclick="1" />					
					<panel width="-1h" align="center" grow="true" float="bottom" padding="0.6h" regrow="true">					
						
						<panel y="0.5h" grow="true" width="100%" noclick="true" regrow="true">
							<label fity="true" wrap="true" width="-0.6h" align="center" font="dyn_10" content="game_shop_label_buycomponents_desc" shadow="true" color="white"
								watch="RemainingComponentsUpgrade"
								ontrigger="
									If(
										param0,
										SetText(Translate('game_shop_label_buyupgrade_desc')),
										SetText(Translate('game_shop_label_buycomponents_desc'))
									);
								"
							/>
						</panel>
						
						<!-- Completed Item Details -->
						<panel grow="true" width="100%" noclick="true">						
							<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.5h" color="#002e45" blockinput="false" noclick="true"/>
							<frame texture="/ui/frames/roundframe.tga" color="#00acff" borderthickness="0.5h" blockinput="false" noclick="true"/>							
							<panel y="0.4h" grow="true" width="-1.0h" align="center" float="bottom" padding="0.4h" noclick="true">
								<!-- Title -->
								<panel height="2.0h" noclick="true">
									<frame texture="/ui/frames/rounded_bg_white.tga" borderthickness="0.3h" style="recipe_header" noclick="true"/>
									<frame texture="/ui/frames/roundframe.tga" color="0 0 0 1" borderthickness="0.3h" noclick="true"/>
									<label y="-0.1h" height="100%" width="-0.8h" align="center" textvalign="center" textalign="left" font="dyn_10" color="1 1 1 1" shadow="true" watch="shopBuyRemainingInfo" ontrigger="SetText(param0);" noclick="true"/>
								</panel>
								<panel grow="true" width="100%" noclick="true">								
									<!-- Icon -->
									<panel width="4.6h" height="4.6h" valign="center"
										onmouseover="
											TriggerItemTooltip(
												'shopGlobalItemTooltipUpdate',
												_lastSelectedItemEntity,
												false
											);
											Trigger('shopGlobalItemTooltipIcon', GetEntityIconPath(_lastSelectedItemEntity));
											ShowWidget('shopGlobalItemTooltip');
										"
										onmouseout="
											HideWidget('shopGlobalItemTooltip');
										"
										onhide="
											HideWidget('shopGlobalItemTooltip');
										"
									>
										<image texture="/ui/common/empty_pack.tga" noclick="true" watch="shopBuyRemainingInfo" ontrigger="SetTexture(param2);" />
										<frame borderthickness="1" bordercolor=".2 .2 .2 1" color="invisible" noclick="true" />
									</panel>									
									<!-- Description -->
									<label fity="true" align="right" width="-5.2h" wrap="true" font="dyn_9" color="1 1 1 1" shadow="true" watch="shopBuyRemainingInfo" ontrigger="SetText(param1);" noclick="true"/>								
								</panel>								
								<panel width="100%" height="0.1h" noclick="true" />							
							</panel>						
						</panel>
						<!-- Items -->
						<panel width="100%" float="bottom" padding="0.5h" noclick="true" grow="true" regrow="true" growinvis="false">
							<instance name="buyall_list_item" index="0"/>
							<instance name="buyall_list_item" index="1"/>
							<instance name="buyall_list_item" index="2"/>
							<instance name="buyall_list_item" index="3"/>
							<instance name="buyall_list_item" index="4"/>
							<instance name="buyall_list_item" index="5"/>
							<instance name="buyall_list_item" index="6"/>
							<instance name="buyall_list_item" index="7"/>
							<instance name="buyall_list_item" index="8"/>
							<instance name="buyall_list_item" index="9"/>
							<instance name="buyall_list_item" index="10"/>
							<instance name="buyall_list_item" index="11"/>
							<instance name="buyall_list_item" index="12"/>
							<instance name="buyall_list_item" index="13"/>
							<instance name="buyall_list_item" index="14"/>
							<instance name="buyall_list_item" index="15"/>
							<instance name="buyall_list_item" index="16"/>
							<instance name="buyall_list_item" index="17"/>
							<instance name="buyall_list_item" index="18"/>
							<instance name="buyall_list_item" index="19"/>
						</panel>						
						<!-- Total Cost -->
						<panel height="4.4h" width="100%" >
							<panel y="0.5h" height="1" color=".2 .2 .2 1" noclick="true" />							
							<panel y="0.5h" noclick="true">
								<!-- Name -->
								<label x="5.0h" height="100%" textvalign="center" font="dyn_10" color="1 1 1 1" shadow="true" content="game_shop_label_buycomponents_total" noclick="true"/>
								<!-- Cost -->
								<image texture="/ui/fe2/store/gold_coins.tga" x="-0.5h" width="1.6h" height="1.6h" valign="center" align="right" />
								<label x="-3.0h" height="100%" textalign="right" textvalign="center" font="dyn_10" color="1 1 0 1" shadow="true" noclick="true" name="recipeRemainingCostTotal" onevent="SetText(_recipeRemainingCost);"/>
							</panel>							
						</panel>						
						<panel width="100%" height="2.5h">
							<panel align="center" height="100%" grow="true" float="right" padding="1h">
								<instance name="button2" width="10h" onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav');" label="general_ok"
									onclick="
										PurchaseRemainingComponents(_lastSelectedItemEntity);
										CallEvent('purchase_components_popup', 1);
									"
								/>
								<instance name="button2" width="10h" onmouseover="PlaySound('/shared/sounds/ui/button_over_02.wav');" onclick="CallEvent('purchase_components_popup', 1);" label="general_cancel" />
							</panel>
						</panel>
						
						<!-- Don't Axe Me -->
						<panel height="2.4h" noclick="true">
							<instance
								name="Noptions_checkbox"				
								width="22.0h"
								align="center" valign="center"					
								font="dyn_10" label="game_shop_label_buyremaining_dontaxe"
								tip_id="shop_buyremaining_dontaxe"
								cvar="shop_confirm_buyall"
								interactive="false"
							/>
						</panel>
						
						<panel height="0.1h" noclick="true" />
					</panel>					
				</panel>
			</panel>			
			<panel height="0.5h"/>			
		</panel>
		
		
	</panel>	
	
<!--	<instance name="menu_items_quickslot" id="loosePanel" />
	<instance
				name="movf_frame"			
				id="loosePanel"
				textid="LoosePanel -ComSho"
				visible="true"
				resizable="true" 
	/>		 -->

	<instance name="shop" />
</interface>